/*! For license information please see 872.f17f191475f1bffc07d4.js.LICENSE.txt */
(self.webpackChunk_jupyterlite_pyodide_kernel_extension=self.webpackChunk_jupyterlite_pyodide_kernel_extension||[]).push([[872,620],{620:(e,t,n)=>{"use strict";n.d(t,{G:()=>Y,U:()=>G});var s=Object.create,i=Object.defineProperty,r=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,a=Object.getPrototypeOf,l=Object.prototype.hasOwnProperty,h=(e,t)=>()=>(e&&(t=e(e=0)),t),u=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),d=u(((e,t)=>{var s,i;s=e,i=function(e){function t(e,t){let n=0;for(let s of e)if(!1===t(s,n++))return!1;return!0}var n;e.ArrayExt=void 0,function(e){function t(e,t,n=0,s=-1){let i,r=e.length;if(0===r)return-1;n=n<0?Math.max(0,n+r):Math.min(n,r-1),i=(s=s<0?Math.max(0,s+r):Math.min(s,r-1))<n?s+1+(r-n):s-n+1;for(let s=0;s<i;++s){let i=(n+s)%r;if(e[i]===t)return i}return-1}function n(e,t,n=-1,s=0){let i,r=e.length;if(0===r)return-1;i=(n=n<0?Math.max(0,n+r):Math.min(n,r-1))<(s=s<0?Math.max(0,s+r):Math.min(s,r-1))?n+1+(r-s):n-s+1;for(let s=0;s<i;++s){let i=(n-s+r)%r;if(e[i]===t)return i}return-1}function s(e,t,n=0,s=-1){let i,r=e.length;if(0===r)return-1;n=n<0?Math.max(0,n+r):Math.min(n,r-1),i=(s=s<0?Math.max(0,s+r):Math.min(s,r-1))<n?s+1+(r-n):s-n+1;for(let s=0;s<i;++s){let i=(n+s)%r;if(t(e[i],i))return i}return-1}function i(e,t,n=-1,s=0){let i,r=e.length;if(0===r)return-1;i=(n=n<0?Math.max(0,n+r):Math.min(n,r-1))<(s=s<0?Math.max(0,s+r):Math.min(s,r-1))?n+1+(r-s):n-s+1;for(let s=0;s<i;++s){let i=(n-s+r)%r;if(t(e[i],i))return i}return-1}function r(e,t=0,n=-1){let s=e.length;if(!(s<=1))for(t=t<0?Math.max(0,t+s):Math.min(t,s-1),n=n<0?Math.max(0,n+s):Math.min(n,s-1);t<n;){let s=e[t],i=e[n];e[t++]=i,e[n--]=s}}function o(e,t){let n=e.length;if(t<0&&(t+=n),t<0||t>=n)return;let s=e[t];for(let s=t+1;s<n;++s)e[s-1]=e[s];return e.length=n-1,s}e.firstIndexOf=t,e.lastIndexOf=n,e.findFirstIndex=s,e.findLastIndex=i,e.findFirstValue=function(e,t,n=0,i=-1){let r=s(e,t,n,i);return-1!==r?e[r]:void 0},e.findLastValue=function(e,t,n=-1,s=0){let r=i(e,t,n,s);return-1!==r?e[r]:void 0},e.lowerBound=function(e,t,n,s=0,i=-1){let r=e.length;if(0===r)return 0;let o=s=s<0?Math.max(0,s+r):Math.min(s,r-1),a=(i=i<0?Math.max(0,i+r):Math.min(i,r-1))-s+1;for(;a>0;){let s=a>>1,i=o+s;n(e[i],t)<0?(o=i+1,a-=s+1):a=s}return o},e.upperBound=function(e,t,n,s=0,i=-1){let r=e.length;if(0===r)return 0;let o=s=s<0?Math.max(0,s+r):Math.min(s,r-1),a=(i=i<0?Math.max(0,i+r):Math.min(i,r-1))-s+1;for(;a>0;){let s=a>>1,i=o+s;n(e[i],t)>0?a=s:(o=i+1,a-=s+1)}return o},e.shallowEqual=function(e,t,n){if(e===t)return!0;if(e.length!==t.length)return!1;for(let s=0,i=e.length;s<i;++s)if(n?!n(e[s],t[s]):e[s]!==t[s])return!1;return!0},e.slice=function(e,t={}){let{start:n,stop:s,step:i}=t;if(void 0===i&&(i=1),0===i)throw new Error("Slice `step` cannot be zero.");let r,o=e.length;void 0===n?n=i<0?o-1:0:n<0?n=Math.max(n+o,i<0?-1:0):n>=o&&(n=i<0?o-1:o),void 0===s?s=i<0?-1:o:s<0?s=Math.max(s+o,i<0?-1:0):s>=o&&(s=i<0?o-1:o),r=i<0&&s>=n||i>0&&n>=s?0:i<0?Math.floor((s-n+1)/i+1):Math.floor((s-n-1)/i+1);let a=[];for(let t=0;t<r;++t)a[t]=e[n+t*i];return a},e.move=function(e,t,n){let s=e.length;if(s<=1||(t=t<0?Math.max(0,t+s):Math.min(t,s-1))===(n=n<0?Math.max(0,n+s):Math.min(n,s-1)))return;let i=e[t],r=t<n?1:-1;for(let s=t;s!==n;s+=r)e[s]=e[s+r];e[n]=i},e.reverse=r,e.rotate=function(e,t,n=0,s=-1){let i=e.length;if(i<=1||(n=n<0?Math.max(0,n+i):Math.min(n,i-1))>=(s=s<0?Math.max(0,s+i):Math.min(s,i-1)))return;let o=s-n+1;if(t>0?t%=o:t<0&&(t=(t%o+o)%o),0===t)return;let a=n+t;r(e,n,a-1),r(e,a,s),r(e,n,s)},e.fill=function(e,t,n=0,s=-1){let i,r=e.length;if(0!==r){n=n<0?Math.max(0,n+r):Math.min(n,r-1),i=(s=s<0?Math.max(0,s+r):Math.min(s,r-1))<n?s+1+(r-n):s-n+1;for(let s=0;s<i;++s)e[(n+s)%r]=t}},e.insert=function(e,t,n){let s=e.length;t=t<0?Math.max(0,t+s):Math.min(t,s);for(let n=s;n>t;--n)e[n]=e[n-1];e[t]=n},e.removeAt=o,e.removeFirstOf=function(e,n,s=0,i=-1){let r=t(e,n,s,i);return-1!==r&&o(e,r),r},e.removeLastOf=function(e,t,s=-1,i=0){let r=n(e,t,s,i);return-1!==r&&o(e,r),r},e.removeAllOf=function(e,t,n=0,s=-1){let i=e.length;if(0===i)return 0;n=n<0?Math.max(0,n+i):Math.min(n,i-1),s=s<0?Math.max(0,s+i):Math.min(s,i-1);let r=0;for(let o=0;o<i;++o)n<=s&&o>=n&&o<=s&&e[o]===t||s<n&&(o<=s||o>=n)&&e[o]===t?r++:r>0&&(e[o-r]=e[o]);return r>0&&(e.length=i-r),r},e.removeFirstWhere=function(e,t,n=0,i=-1){let r,a=s(e,t,n,i);return-1!==a&&(r=o(e,a)),{index:a,value:r}},e.removeLastWhere=function(e,t,n=-1,s=0){let r,a=i(e,t,n,s);return-1!==a&&(r=o(e,a)),{index:a,value:r}},e.removeAllWhere=function(e,t,n=0,s=-1){let i=e.length;if(0===i)return 0;n=n<0?Math.max(0,n+i):Math.min(n,i-1),s=s<0?Math.max(0,s+i):Math.min(s,i-1);let r=0;for(let o=0;o<i;++o)n<=s&&o>=n&&o<=s&&t(e[o],o)||s<n&&(o<=s||o>=n)&&t(e[o],o)?r++:r>0&&(e[o-r]=e[o]);return r>0&&(e.length=i-r),r}}(e.ArrayExt||(e.ArrayExt={})),(n||(n={})).rangeLength=function(e,t,n){return 0===n?1/0:e>t&&n>0||e<t&&n<0?0:Math.ceil((t-e)/n)},e.StringExt=void 0,function(e){function t(e,t,n=0){let s=new Array(t.length);for(let i=0,r=n,o=t.length;i<o;++i,++r){if(r=e.indexOf(t[i],r),-1===r)return null;s[i]=r}return s}e.findIndices=t,e.matchSumOfSquares=function(e,n,s=0){let i=t(e,n,s);if(!i)return null;let r=0;for(let e=0,t=i.length;e<t;++e){let t=i[e]-s;r+=t*t}return{score:r,indices:i}},e.matchSumOfDeltas=function(e,n,s=0){let i=t(e,n,s);if(!i)return null;let r=0,o=s-1;for(let e=0,t=i.length;e<t;++e){let t=i[e];r+=t-o-1,o=t}return{score:r,indices:i}},e.highlight=function(e,t,n){let s=[],i=0,r=0,o=t.length;for(;i<o;){let a=t[i],l=t[i];for(;++i<o&&t[i]===l+1;)l++;r<a&&s.push(e.slice(r,a)),a<l+1&&s.push(n(e.slice(a,l+1))),r=l+1}return r<e.length&&s.push(e.slice(r)),s},e.cmp=function(e,t){return e<t?-1:e>t?1:0}}(e.StringExt||(e.StringExt={})),e.chain=function*(...e){for(let t of e)yield*t},e.each=function(e,t){let n=0;for(let s of e)if(!1===t(s,n++))return},e.empty=function*(){},e.enumerate=function*(e,t=0){for(let n of e)yield[t++,n]},e.every=t,e.filter=function*(e,t){let n=0;for(let s of e)t(s,n++)&&(yield s)},e.find=function(e,t){let n=0;for(let s of e)if(t(s,n++))return s},e.findIndex=function(e,t){let n=0;for(let s of e)if(t(s,n++))return n-1;return-1},e.map=function*(e,t){let n=0;for(let s of e)yield t(s,n++)},e.max=function(e,t){let n;for(let s of e)void 0!==n?t(s,n)>0&&(n=s):n=s;return n},e.min=function(e,t){let n;for(let s of e)void 0!==n?t(s,n)<0&&(n=s):n=s;return n},e.minmax=function(e,t){let n,s,i=!0;for(let r of e)i?(n=r,s=r,i=!1):t(r,n)<0?n=r:t(r,s)>0&&(s=r);return i?void 0:[n,s]},e.once=function*(e){yield e},e.range=function*(e,t,s){void 0===t?(t=e,e=0,s=1):void 0===s&&(s=1);let i=n.rangeLength(e,t,s);for(let t=0;t<i;t++)yield e+s*t},e.reduce=function(e,t,n){let s=e[Symbol.iterator](),i=0,r=s.next();if(r.done&&void 0===n)throw new TypeError("Reduce of empty iterable with no initial value.");if(r.done)return n;let o,a,l=s.next();if(l.done&&void 0===n)return r.value;if(l.done)return t(n,r.value,i++);for(o=t(void 0===n?r.value:t(n,r.value,i++),l.value,i++);!(a=s.next()).done;)o=t(o,a.value,i++);return o},e.repeat=function*(e,t){for(;0<t--;)yield e},e.retro=function*(e){if("function"==typeof e.retro)yield*e.retro();else for(let t=e.length-1;t>-1;t--)yield e[t]},e.some=function(e,t){let n=0;for(let s of e)if(t(s,n++))return!0;return!1},e.stride=function*(e,t){let n=0;for(let s of e)n++%t==0&&(yield s)},e.take=function*(e,t){if(t<1)return;let n,s=e[Symbol.iterator]();for(;0<t--&&!(n=s.next()).done;)yield n.value},e.toArray=function(e){return Array.from(e)},e.toObject=function(e){let t={};for(let[n,s]of e)t[n]=s;return t},e.topologicSort=function(e){let t=[],n=new Set,s=new Map;for(let t of e)i(t);for(let[e]of s)r(e);return t;function i(e){let[t,n]=e,i=s.get(n);i?i.push(t):s.set(n,[t])}function r(e){if(n.has(e))return;n.add(e);let i=s.get(e);if(i)for(let e of i)r(e);t.push(e)}},e.zip=function*(...e){let n=e.map((e=>e[Symbol.iterator]())),s=n.map((e=>e.next()));for(;t(s,(e=>!e.done));s=n.map((e=>e.next())))yield s.map((e=>e.value))}},"object"==typeof e&&void 0!==t?i(e):"function"==typeof define&&n.amdO?define(["exports"],i):i((s="undefined"!=typeof globalThis?globalThis:s||self).lumino_algorithm={})})),c=u(((e,t)=>{var s,i;s=e,i=function(e,t){var n;function s(e){let t=0;for(let n=0,s=e.length;n<s;++n)n%4==0&&(t=4294967295*Math.random()>>>0),e[n]=255&t,t>>>=8}e.JSONExt=void 0,function(e){function t(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e}function n(e){return Array.isArray(e)}e.emptyObject=Object.freeze({}),e.emptyArray=Object.freeze([]),e.isPrimitive=t,e.isArray=n,e.isObject=function(e){return!t(e)&&!n(e)},e.deepEqual=function e(s,i){if(s===i)return!0;if(t(s)||t(i))return!1;let r=n(s),o=n(i);return r===o&&(r&&o?function(t,n){if(t===n)return!0;if(t.length!==n.length)return!1;for(let s=0,i=t.length;s<i;++s)if(!e(t[s],n[s]))return!1;return!0}(s,i):function(t,n){if(t===n)return!0;for(let e in t)if(void 0!==t[e]&&!(e in n))return!1;for(let e in n)if(void 0!==n[e]&&!(e in t))return!1;for(let s in t){let i=t[s],r=n[s];if(!(void 0===i&&void 0===r||void 0!==i&&void 0!==r&&e(i,r)))return!1}return!0}(s,i))},e.deepCopy=function e(s){return t(s)?s:n(s)?function(t){let n=new Array(t.length);for(let s=0,i=t.length;s<i;++s)n[s]=e(t[s]);return n}(s):function(t){let n={};for(let s in t){let i=t[s];void 0!==i&&(n[s]=e(i))}return n}(s)}}(e.JSONExt||(e.JSONExt={})),function(e){class n{constructor(e){var t,n,s,i;this._activated=!1,this._promise=null,this._service=null,this.id=e.id,this.description=null!==(t=e.description)&&void 0!==t?t:"",this.activate=e.activate,this.deactivate=null!==(n=e.deactivate)&&void 0!==n?n:null,this.provides=null!==(s=e.provides)&&void 0!==s?s:null,this.autoStart=null!==(i=e.autoStart)&&void 0!==i&&i,this.requires=e.requires?e.requires.slice():[],this.optional=e.optional?e.optional.slice():[]}get activated(){return this._activated}set activated(e){this._activated=e}get service(){return this._service}set service(e){this._service=e}get promise(){return this._promise}set promise(e){this._promise=e}}e.createPluginData=function(e){return new n(e)},e.ensureNoCycle=function(e,t,n){let s=[...e.requires,...e.optional],i=s=>{if(s===e.provides)return!0;let o=n.get(s);if(!o)return!1;let a=t.get(o),l=[...a.requires,...a.optional];return 0!==l.length&&(r.push(o),!!l.some(i)||(r.pop(),!1))};if(!e.provides||0===s.length)return;let r=[e.id];if(s.some(i))throw new ReferenceError(`Cycle detected: ${r.join(" -> ")}.`)},e.findDependents=function(e,n,s){let i=new Array,r=e=>{let t=n.get(e),r=[...t.requires,...t.optional];i.push(...r.reduce(((t,n)=>{let i=s.get(n);return i&&t.push([e,i]),t}),[]))};for(let e of n.keys())r(e);let o=i.filter((t=>t[1]===e)),a=0;for(;o.length>a;){let e=o.length,t=new Set(o.map((e=>e[0])));for(let e of t)i.filter((t=>t[1]===e)).forEach((e=>{o.includes(e)||o.push(e)}));a=e}let l=t.topologicSort(o),h=l.findIndex((t=>t===e));return-1===h?[e]:l.slice(0,h+1)},e.collectStartupPlugins=function(e,t){let n=new Set;for(let t of e.keys())!0===e.get(t).autoStart&&n.add(t);if(t.startPlugins)for(let e of t.startPlugins)n.add(e);if(t.ignorePlugins)for(let e of t.ignorePlugins)n.delete(e);return Array.from(n)}}(n||(n={})),e.Random=void 0,(e.Random||(e.Random={})).getRandomValues=(()=>{let e="undefined"!=typeof window&&(window.crypto||window.msCrypto)||null;return e&&"function"==typeof e.getRandomValues?function(t){return e.getRandomValues(t)}:s})(),e.UUID=void 0,(e.UUID||(e.UUID={})).uuid4=function(e){let t=new Uint8Array(16),n=new Array(256);for(let e=0;e<16;++e)n[e]="0"+e.toString(16);for(let e=16;e<256;++e)n[e]=e.toString(16);return function(){return e(t),t[6]=64|15&t[6],t[8]=128|63&t[8],n[t[0]]+n[t[1]]+n[t[2]]+n[t[3]]+"-"+n[t[4]]+n[t[5]]+"-"+n[t[6]]+n[t[7]]+"-"+n[t[8]]+n[t[9]]+"-"+n[t[10]]+n[t[11]]+n[t[12]]+n[t[13]]+n[t[14]]+n[t[15]]}}(e.Random.getRandomValues),e.MimeData=class{constructor(){this._types=[],this._values=[]}types(){return this._types.slice()}hasData(e){return-1!==this._types.indexOf(e)}getData(e){let t=this._types.indexOf(e);return-1!==t?this._values[t]:void 0}setData(e,t){this.clearData(e),this._types.push(e),this._values.push(t)}clearData(e){let t=this._types.indexOf(e);-1!==t&&(this._types.splice(t,1),this._values.splice(t,1))}clear(){this._types.length=0,this._values.length=0}},e.PluginRegistry=class{constructor(e={}){this._application=null,this._validatePlugin=()=>!0,this._plugins=new Map,this._services=new Map,e.validatePlugin&&(console.info("Plugins may be rejected by the custom validation plugin method."),this._validatePlugin=e.validatePlugin)}get application(){return this._application}set application(e){if(null!==this._application)throw Error("PluginRegistry.application is already set. It cannot be overridden.");this._application=e}get deferredPlugins(){return Array.from(this._plugins).filter((([e,t])=>"defer"===t.autoStart)).map((([e,t])=>e))}getPluginDescription(e){var t,n;return null!==(n=null===(t=this._plugins.get(e))||void 0===t?void 0:t.description)&&void 0!==n?n:""}hasPlugin(e){return this._plugins.has(e)}isPluginActivated(e){var t,n;return null!==(n=null===(t=this._plugins.get(e))||void 0===t?void 0:t.activated)&&void 0!==n&&n}listPlugins(){return Array.from(this._plugins.keys())}registerPlugin(e){if(this._plugins.has(e.id))throw new TypeError(`Plugin '${e.id}' is already registered.`);if(!this._validatePlugin(e))throw new Error(`Plugin '${e.id}' is not valid.`);let t=n.createPluginData(e);n.ensureNoCycle(t,this._plugins,this._services),t.provides&&this._services.set(t.provides,t.id),this._plugins.set(t.id,t)}registerPlugins(e){for(let t of e)this.registerPlugin(t)}deregisterPlugin(e,t){let n=this._plugins.get(e);if(n){if(n.activated&&!t)throw new Error(`Plugin '${e}' is still active.`);this._plugins.delete(e)}}async activatePlugin(e){let t=this._plugins.get(e);if(!t)throw new ReferenceError(`Plugin '${e}' is not registered.`);if(t.activated)return;if(t.promise)return t.promise;let n=t.requires.map((e=>this.resolveRequiredService(e))),s=t.optional.map((e=>this.resolveOptionalService(e)));return t.promise=Promise.all([...n,...s]).then((e=>t.activate.apply(void 0,[this.application,...e]))).then((e=>{t.service=e,t.activated=!0,t.promise=null})).catch((e=>{throw t.promise=null,e})),t.promise}async activatePlugins(e,t={}){switch(e){case"defer":{let e=this.deferredPlugins.filter((e=>this._plugins.get(e).autoStart)).map((e=>this.activatePlugin(e)));await Promise.all(e);break}case"startUp":{let e=n.collectStartupPlugins(this._plugins,t).map((async e=>{try{return await this.activatePlugin(e)}catch(t){console.error(`Plugin '${e}' failed to activate.`,t)}}));await Promise.all(e);break}}}async deactivatePlugin(e){let t=this._plugins.get(e);if(!t)throw new ReferenceError(`Plugin '${e}' is not registered.`);if(!t.activated)return[];if(!t.deactivate)throw new TypeError(`Plugin '${e}'#deactivate() method missing`);let s=n.findDependents(e,this._plugins,this._services),i=s.map((e=>this._plugins.get(e)));for(let t of i)if(!t.deactivate)throw new TypeError(`Plugin ${t.id}#deactivate() method missing (depends on ${e})`);for(let e of i){let t=[...e.requires,...e.optional].map((e=>{let t=this._services.get(e);return t?this._plugins.get(t).service:null}));await e.deactivate(this.application,...t),e.service=null,e.activated=!1}return s.pop(),s}async resolveRequiredService(e){let t=this._services.get(e);if(!t)throw new TypeError(`No provider for: ${e.name}.`);let n=this._plugins.get(t);return n.activated||await this.activatePlugin(t),n.service}async resolveOptionalService(e){let t=this._services.get(e);if(!t)return null;let n=this._plugins.get(t);if(!n.activated)try{await this.activatePlugin(t)}catch(e){return console.error(e),null}return n.service}},e.PromiseDelegate=class{constructor(){this.promise=new Promise(((e,t)=>{this._resolve=e,this._reject=t}))}resolve(e){(0,this._resolve)(e)}reject(e){(0,this._reject)(e)}},e.Token=class{constructor(e,t){this.name=e,this.description=null!=t?t:"",this._tokenStructuralPropertyT=null}}},"object"==typeof e&&void 0!==t?i(e,d()):"function"==typeof define&&n.amdO?define(["exports","@lumino/algorithm"],i):i((s="undefined"!=typeof globalThis?globalThis:s||self).lumino_coreutils={},s.lumino_algorithm)})),p=h((()=>{})),_={};((e,t)=>{for(var n in t)i(e,n,{get:t[n],enumerable:!0})})(_,{BLOCK_SIZE:()=>g,ContentsAPI:()=>P,DRIVE_SEPARATOR:()=>m,DriveFS:()=>C,DriveFSEmscriptenNodeOps:()=>S,DriveFSEmscriptenStreamOps:()=>b,ServiceWorkerContentsAPI:()=>k});var f,m,g,v,y,w,b,S,P,k,C,M=h((()=>{var e,t,n;e=c(),n=null!=e?s(a(e)):{},f=((e,t,n,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let n of o(t))!l.call(e,n)&&void 0!==n&&i(e,n,{get:()=>t[n],enumerable:!(s=r(t,n))||s.enumerable});return e})(!t&&e&&e.__esModule?n:i(n,"default",{value:e,enumerable:!0}),e),p(),m=":",g=4096,v=new TextEncoder,y=new TextDecoder("utf-8"),w={0:!1,1:!0,2:!0,64:!0,65:!0,66:!0,129:!0,193:!0,514:!0,577:!0,578:!0,705:!0,706:!0,1024:!0,1025:!0,1026:!0,1089:!0,1090:!0,1153:!0,1154:!0,1217:!0,1218:!0,4096:!0,4098:!0},b=class{constructor(e){this.fs=e}open(e){var t;let n=this.fs.realPath(e.node);if(this.fs.FS.isFile(e.node.mode))try{let t=this.fs.API.get(n);e.file=t}catch{let s=null!==(t=e.flags)&&void 0!==t?t:e.shared.flags,i="string"==typeof s?parseInt(s,10):s;i&=8191;let r=!0;if(i in w&&(r=w[i]),!r)throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.ENOENT);{e.node=this.fs.node_ops.mknod(e.node.parent,e.node.name,e.node.mode,0);let t=this.fs.API.get(n);e.file=t}}}close(e){var t;if(!this.fs.FS.isFile(e.node.mode)||!e.file)return;let n=this.fs.realPath(e.node),s=null!==(t=e.flags)&&void 0!==t?t:e.shared.flags,i="string"==typeof s?parseInt(s,10):s;i&=8191;let r=!0;i in w&&(r=w[i]),r&&this.fs.API.put(n,e.file),e.file=void 0}read(e,t,n,s,i){if(s<=0||void 0===e.file||i>=(e.file.data.length||0))return 0;let r=Math.min(e.file.data.length-i,s);return t.set(e.file.data.subarray(i,i+r),n),r}write(e,t,n,s,i){var r;if(s<=0||void 0===e.file)return 0;let o=Date.now();if(e.node.timestamp=o,e.node.atime=o,e.node.mtime=o,e.node.ctime=o,i+s>((null===(r=e.file)||void 0===r?void 0:r.data.length)||0)){let t=e.file.data?e.file.data:new Uint8Array;e.file.data=new Uint8Array(i+s),e.file.data.set(t)}return e.file.data.set(t.subarray(n,n+s),i),s}llseek(e,t,n){var s;let i=t;if(1===n)i+=null!==(s=e.position)&&void 0!==s?s:e.shared.position;else if(2===n&&this.fs.FS.isFile(e.node.mode)){if(void 0===e.file)throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EPERM);i+=e.file.data.length}if(i<0)throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EINVAL);return i}},S=class{constructor(e){this.node=e=>"node"in e?e.node:e,this.getattr=e=>{let t=this.node(e);return{...this.fs.API.getattr(this.fs.realPath(t)),mode:t.mode,ino:t.id}},this.setattr=(e,t)=>{let n=this.node(e);for(let[e,s]of Object.entries(t))switch(e){case"mode":n.mode=s;break;case"timestamp":n.timestamp=s;break;case"atime":n.atime=s;break;case"mtime":n.mtime=s;break;case"ctime":n.ctime=s;break;case"size":{let e=s,t=this.fs.realPath(n);if(this.fs.FS.isFile(n.mode)&&e>=0){let n;try{n=this.fs.API.get(t)}catch{break}let s=n.data?n.data:new Uint8Array;e!==s.length&&(e<s.length?n.data=n.data.slice(0,e):(n.data=new Uint8Array(e),n.data.set(s)),this.fs.API.put(t,n))}else console.warn("setattr size of",e,"on",n,"not yet implemented");break}case"dontFollow":break;default:console.warn("setattr",e,"of",s,"on",n,"not yet implemented")}},this.lookup=(e,t)=>{let n=this.node(e),s=this.fs.PATH.join2(this.fs.realPath(n),t),i=this.fs.API.lookup(s);if(!i.ok)throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.ENOENT);return this.fs.createNode(n,t,i.mode,0)},this.mknod=(e,t,n,s)=>{let i=this.node(e),r=this.fs.PATH.join2(this.fs.realPath(i),t);return this.fs.API.mknod(r,n),this.fs.createNode(i,t,n,s)},this.rename=(e,t,n)=>{let s=this.node(e),i=this.node(t);this.fs.API.rename(s.parent?this.fs.PATH.join2(this.fs.realPath(s.parent),s.name):s.name,this.fs.PATH.join2(this.fs.realPath(i),n)),s.name=n,s.parent=i},this.unlink=(e,t)=>this.fs.API.rmdir(this.fs.PATH.join2(this.fs.realPath(this.node(e)),t)),this.rmdir=(e,t)=>this.fs.API.rmdir(this.fs.PATH.join2(this.fs.realPath(this.node(e)),t)),this.readdir=e=>this.fs.API.readdir(this.fs.realPath(this.node(e))),this.symlink=(e,t,n)=>{throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EPERM)},this.readlink=e=>{throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EINVAL)},this.fs=e}},P=class{constructor(e){this._driveName=e.driveName,this._mountpoint=e.mountpoint,this.FS=e.FS,this.ERRNO_CODES=e.ERRNO_CODES}lookup(e){return this.request({method:"lookup",path:this.normalizePath(e)})}getmode(e){return this.request({method:"getmode",path:this.normalizePath(e)})}mknod(e,t){return this.request({method:"mknod",path:this.normalizePath(e),data:{mode:t}})}rename(e,t){return this.request({method:"rename",path:this.normalizePath(e),data:{newPath:this.normalizePath(t)}})}readdir(e){let t=this.request({method:"readdir",path:this.normalizePath(e)});return t.push("."),t.push(".."),t}rmdir(e){return this.request({method:"rmdir",path:this.normalizePath(e)})}get(e){let t=this.request({method:"get",path:this.normalizePath(e)});if(!t)throw new this.FS.ErrnoError(this.ERRNO_CODES.ENOENT);let n=t.content,s=t.format;switch(s){case"json":case"text":return{data:v.encode(n),format:s};case"base64":{let e=atob(n),t=e.length,i=new Uint8Array(t);for(let n=0;n<t;n++)i[n]=e.charCodeAt(n);return{data:i,format:s}}default:throw new this.FS.ErrnoError(this.ERRNO_CODES.ENOENT)}}put(e,t){switch(t.format){case"json":case"text":return this.request({method:"put",path:this.normalizePath(e),data:{format:t.format,data:y.decode(t.data)}});case"base64":{let n="";for(let e=0;e<t.data.byteLength;e++)n+=String.fromCharCode(t.data[e]);return this.request({method:"put",path:this.normalizePath(e),data:{format:t.format,data:btoa(n)}})}}}getattr(e){let t=this.request({method:"getattr",path:this.normalizePath(e)}),n=new Date(0);return t.atime=t.atime?new Date(t.atime):n,t.mtime=t.mtime?new Date(t.mtime):n,t.ctime=t.ctime?new Date(t.ctime):n,t.size=t.size||0,t}normalizePath(e){return e.startsWith(this._mountpoint)&&(e=e.slice(this._mountpoint.length)),this._driveName&&(e=`${this._driveName}${m}${e}`),e}},k=class extends P{constructor(e){super(e),this._baseUrl=e.baseUrl,this._browsingContextId=e.browsingContextId||""}request(e){let t=new XMLHttpRequest;t.open("POST",encodeURI(this.endpoint),!1);let n=f.UUID.uuid4(),s={data:{...e,requestId:n},browsingContextId:this._browsingContextId,requestId:n};try{t.send(JSON.stringify(s))}catch(e){console.error(e)}if(t.status>=400)throw new this.FS.ErrnoError(this.ERRNO_CODES.EINVAL);return JSON.parse(t.responseText)}get endpoint(){return`${this._baseUrl}api/drive`}},C=class{constructor(e){this.FS=e.FS,this.PATH=e.PATH,this.ERRNO_CODES=e.ERRNO_CODES,this.API=this.createAPI(e),this.driveName=e.driveName,this.node_ops=new S(this),this.stream_ops=new b(this)}createAPI(e){if(!e.browsingContextId||!e.baseUrl)throw new Error("Cannot create service-worker API without current browsingContextId");return new k(e)}mount(e){return this.createNode(null,e.mountpoint,16895,0)}createNode(e,t,n,s){let i=this.FS;if(!i.isDir(n)&&!i.isFile(n))throw new i.ErrnoError(this.ERRNO_CODES.EINVAL);let r=i.createNode(e,t,n,s);return r.node_ops=this.node_ops,r.stream_ops=this.stream_ops,r}getMode(e){return this.API.getmode(e)}realPath(e){let t=[],n=e;for(t.push(n.name);n.parent!==n;)n=n.parent,t.push(n.name);return t.reverse(),this.PATH.join.apply(null,t)}}})),R="function",E="64e10b34-2bf7-4616-9668-f99de5aa046e",{isArray:O}=Array,{SharedArrayBuffer:I,window:x}=globalThis,{notify:D,wait:j,waitAsync:A}=Atomics,T=null;A||(A=e=>({value:new Promise((t=>{let n=new Worker("data:application/javascript,onmessage%3D(%7Bdata%3Ab%7D)%3D%3E(Atomics.wait(b%2C0)%2CpostMessage(0))");n.onmessage=t,n.postMessage(e)}))}));try{new I(4)}catch{I=ArrayBuffer;let e=new WeakMap;if(x){let t=new Map,{prototype:{postMessage:n}}=Worker,s=e=>{var n;let s=null==(n=e.data)?void 0:n[E];if(!O(s)){e.stopImmediatePropagation();let{id:n,sb:i}=s;t.get(n)(i)}};T=function(t,...i){let r=null==t?void 0:t[E];if(O(r)){let[t,n]=r;e.set(n,t),this.addEventListener("message",s)}return n.call(this,t,...i)},A=n=>({value:new Promise((s=>{t.set(e.get(n),s)})).then((s=>{t.delete(e.get(n)),e.delete(n);for(let e=0;e<s.length;e++)n[e]=s[e];return"ok"}))})}else{let t=(e,t)=>({[E]:{id:e,sb:t}});D=n=>{postMessage(t(e.get(n),n))},addEventListener("message",(t=>{var n;let s=null==(n=t.data)?void 0:n[E];if(O(s)){let[t,n]=s;e.set(n,t)}}))}}var{Int32Array:U,Map:N,Uint16Array:F}=globalThis,{BYTES_PER_ELEMENT:L}=U,{BYTES_PER_ELEMENT:q}=F,K=new WeakSet,W=new WeakMap,$={value:{then:e=>e()}},z=0,H=(e,{parse:t=JSON.parse,stringify:n=JSON.stringify,transform:s,interrupt:i}=JSON)=>{if(!W.has(e)){let r=T||e.postMessage,o=(t,...n)=>r.call(e,{[E]:n},{transfer:t}),a=typeof i===R?i:null==i?void 0:i.handler,l=(null==i?void 0:i.delay)||42,h=new TextDecoder("utf-16"),u=(e,t)=>e?A(t,0):(a?((e,t,n)=>{for(;"timed-out"===j(e,0,0,t);)n()})(t,l,a):j(t,0),$),d=!1;W.set(e,new Proxy(new N,{has:(e,t)=>"string"==typeof t&&!t.startsWith("_"),get:(n,i)=>"then"===i?null:(...n)=>{let r=z++,a=new U(new I(2*L)),l=[];K.has(n.at(-1)||l)&&K.delete(l=n.pop()),o(l,r,a,i,s?n.map(s):n);let c=e!==globalThis,p=0;return d&&c&&(p=setTimeout(console.warn,1e3,`ðŸ’€ðŸ”’ - Possible deadlock if proxy.${i}(...args) is awaited`)),u(c,a).value.then((()=>{clearTimeout(p);let e=a[1];if(!e)return;let n=q*e;return a=new U(new I(n+n%L)),o([],r,a),u(c,a).value.then((()=>t(h.decode(new F(a.buffer).slice(0,e)))))}))},set(t,i,r){let o=typeof r;if(o!==R)throw new Error(`Unable to assign ${i} as ${o}`);if(!t.size){let i=new N;e.addEventListener("message",(async e=>{var r;let o=null==(r=e.data)?void 0:r[E];if(O(o)){e.stopImmediatePropagation();let r,[a,l,...h]=o;if(h.length){let[e,o]=h;if(t.has(e)){d=!0;try{let r=await t.get(e)(...o);if(void 0!==r){let e=n(s?s(r):r);i.set(a,e),l[1]=e.length}}catch(e){r=e}finally{d=!1}}else r=new Error(`Unsupported action: ${e}`);l[0]=1}else{let e=i.get(a);i.delete(a);for(let t=new F(l.buffer),n=0;n<e.length;n++)t[n]=e.charCodeAt(n)}if(D(l,0),r)throw r}}))}return!!t.set(i,r)}}))}return W.get(e)};H.transfer=(...e)=>(K.add(e),e);var B=H;M();var V=class{constructor(){this._options=null,this._initializer=null,this._pyodide=null,this._localPath="",this._driveName="",this._driveFS=null,this._sendWorkerMessage=()=>{},this._logMessage=()=>{},this._initialized=new Promise(((e,t)=>{this._initializer={resolve:e,reject:t}}))}async initialize(e){var t;if(this._options=e,e.location.includes(":")){let t=e.location.split(":");this._driveName=t[0],this._localPath=t[1]}else this._driveName="",this._localPath=e.location;await this.initRuntime(e),await this.initFilesystem(e),await this.initPackageManager(e),await this.initKernel(e),await this.initGlobals(e),null==(t=this._initializer)||t.resolve()}async initRuntime(e){let t,{pyodideUrl:s,indexUrl:i}=e;s.endsWith(".mjs")?t=(await n(476)(s)).loadPyodide:(importScripts(s),t=self.loadPyodide),this._pyodide=await t({indexURL:i,stdout:e=>{console.log(e),this._logMessage({type:"text",level:"info",data:e})},stderr:e=>{console.error(e),this._logMessage({type:"text",level:"critical",data:e})},...e.loadPyodideOptions}),this._pyodide._api.on_fatal=async e=>{let t="";t="Exit"===e.name?"Pyodide has exited and can no longer be used.":`Pyodide has suffered a fatal error. Please report this to the Pyodide maintainers.\nThe cause of the error was: ${e.name}\n${e.message}\nStack trace:\n${e.stack}`,this._logMessage({type:"text",level:"critical",data:t})}}async initPackageManager(e){if(!this._options)throw new Error("Uninitialized");let{pipliteWheelUrl:t,disablePyPIFallback:n,pipliteUrls:s,loadPyodideOptions:i}=this._options,r=(i||{}).packages||[];r.includes("micropip")||await this._pyodide.loadPackage(["micropip"]),r.includes("piplite")||await this._pyodide.runPythonAsync(`\n      import micropip\n      await micropip.install('${t}', keep_going=True)\n    `),await this._pyodide.runPythonAsync(`\n      import piplite.piplite\n      piplite.piplite._PIPLITE_DISABLE_PYPI = ${n?"True":"False"}\n      piplite.piplite._PIPLITE_URLS = ${JSON.stringify(s)}\n    `)}async initKernel(e){let t=(e.loadPyodideOptions||{}).packages||[],n=["sqlite3","ipykernel","comm","pyodide_kernel","jedi","ipython"],s=[];for(let e of n)t.includes(e)||s.push(`await piplite.install('${e}', keep_going=True)`);s.push("import pyodide_kernel"),e.mountDrive&&this._localPath&&s.push("import os",`os.chdir("${this._localPath}")`),await this._pyodide.runPythonAsync(s.join("\n"))}async initGlobals(e){let{globals:t}=this._pyodide;this._kernel=t.get("pyodide_kernel").kernel_instance.copy(),this._stdout_stream=t.get("pyodide_kernel").stdout_stream.copy(),this._stderr_stream=t.get("pyodide_kernel").stderr_stream.copy(),this._interpreter=this._kernel.interpreter.copy(),this._interpreter.send_comm=this.sendComm.bind(this)}async initFilesystem(e){if(e.mountDrive){let t="/drive",{FS:n,PATH:s,ERRNO_CODES:i}=this._pyodide,{baseUrl:r}=e,{DriveFS:o}=await Promise.resolve().then((()=>(M(),_))),a=new o({FS:n,PATH:s,ERRNO_CODES:i,baseUrl:r,driveName:this._driveName,mountpoint:t,browsingContextId:this._browsingContextId});n.mkdirTree(t),n.mount(a,{},t),n.chdir(t),this._driveFS=a}}mapToObject(e){let t=e instanceof Array?[]:{},n=e instanceof Map?e.entries():Object.entries(e);for(let[e,s]of n)t[e]=s instanceof Map||s instanceof Array?this.mapToObject(s):s;return t}formatResult(e){if(!(e instanceof this._pyodide.ffi.PyProxy))return e;let t=e.toJs();return this.mapToObject(t)}registerWorkerMessageCallback(e){this._sendWorkerMessage=e}registerLogMessageCallback(e){this._logMessage=e}async setup(e){await this._initialized,this._kernel._parent_header=this._pyodide.toPy(e)}async execute(e,t){await this.setup(t);let n=(e,t)=>{let n={name:this.formatResult(e),text:this.formatResult(t)};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:n,type:"stream"})};this._stdout_stream.publish_stream_callback=n,this._stderr_stream.publish_stream_callback=n,this._interpreter.display_pub.clear_output_callback=e=>{let t={wait:this.formatResult(e)};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:t,type:"clear_output"})},this._interpreter.display_pub.display_data_callback=(e,t,n)=>{let s={data:this.formatResult(e),metadata:this.formatResult(t),transient:this.formatResult(n)};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:s,type:"display_data"})},this._interpreter.display_pub.update_display_data_callback=(e,t,n)=>{let s={data:this.formatResult(e),metadata:this.formatResult(t),transient:this.formatResult(n)};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:s,type:"update_display_data"})},this._interpreter.displayhook.publish_execution_result=(e,t,n)=>{let s={execution_count:e,data:this.formatResult(t),metadata:this.formatResult(n)};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:s,type:"execute_result"})},this._interpreter.input=this.input.bind(this),this._interpreter.getpass=this.getpass.bind(this);let s=await this._kernel.run(e.code),i=this.formatResult(s);return"error"===i.status&&((e,t,n)=>{let s={ename:e,evalue:t,traceback:n};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:s,type:"execute_error"})})(i.ename,i.evalue,i.traceback),i}async complete(e,t){await this.setup(t);let n=this._kernel.complete(e.code,e.cursor_pos);return this.formatResult(n)}async inspect(e,t){await this.setup(t);let n=this._kernel.inspect(e.code,e.cursor_pos,e.detail_level);return this.formatResult(n)}async isComplete(e,t){await this.setup(t);let n=this._kernel.is_complete(e.code);return this.formatResult(n)}async commInfo(e,t){await this.setup(t);let n=this._kernel.comm_info(e.target_name);return{comms:this.formatResult(n),status:"ok"}}async commOpen(e,t){await this.setup(t);let n=this._kernel.comm_manager.comm_open(this._pyodide.toPy(null),this._pyodide.toPy(null),this._pyodide.toPy(e));return this.formatResult(n)}async commMsg(e,t){await this.setup(t);let n=this._kernel.comm_manager.comm_msg(this._pyodide.toPy(null),this._pyodide.toPy(null),this._pyodide.toPy(e));return this.formatResult(n)}async commClose(e,t){await this.setup(t);let n=this._kernel.comm_manager.comm_close(this._pyodide.toPy(null),this._pyodide.toPy(null),this._pyodide.toPy(e));return this.formatResult(n)}async inputReply(e,t){}getpass(e){return e=void 0===e?"":e,this.sendInputRequest(e,!0)}input(e){return e=void 0===e?"":e,this.sendInputRequest(e,!1)}async sendComm(e,t,n,s,i){this._sendWorkerMessage({type:e,content:this.formatResult(t),metadata:this.formatResult(n),ident:this.formatResult(s),buffers:this.formatResult(i),parentHeader:this.formatResult(this._kernel._parent_header).header})}},J=B(self),G=class extends P{request(e){return J.processDriveRequest(e)}},Z=class extends C{createAPI(e){return new G(e)}},Y=class extends V{async initFilesystem(e){if(e.mountDrive){let t="/drive",{FS:n,PATH:s,ERRNO_CODES:i}=this._pyodide,{baseUrl:r}=e,o=new Z({FS:n,PATH:s,ERRNO_CODES:i,baseUrl:r,driveName:this._driveName,mountpoint:t});n.mkdirTree(t),n.mount(o,{},t),n.chdir(t),this._driveFS=o}}sendInputRequest(e,t){return J.processStdinRequest({prompt:e,password:t})}},X=new Y,Q=J.processWorkerMessage.bind(J);X.registerWorkerMessageCallback(Q);var ee=J.processLogMessage.bind(J);X.registerLogMessageCallback(ee),J.initialize=X.initialize.bind(X),J.execute=X.execute.bind(X),J.complete=X.complete.bind(X),J.inspect=X.inspect.bind(X),J.isComplete=X.isComplete.bind(X),J.commInfo=X.commInfo.bind(X),J.commOpen=X.commOpen.bind(X),J.commMsg=X.commMsg.bind(X),J.commClose=X.commClose.bind(X),J.inputReply=X.inputReply.bind(X)},352:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{a:()=>nr});var process=__webpack_require__(664),Ho=Object.create,Bn=Object.defineProperty,Jo=Object.getOwnPropertyDescriptor,Go=Object.getOwnPropertyNames,Xo=Object.getPrototypeOf,Yo=Object.prototype.hasOwnProperty,sr=(e,t)=>()=>(e&&(t=e(e=0)),t),R=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Qo=(e,t)=>{for(var n in t)Bn(e,n,{get:t[n],enumerable:!0})},Zo=(e,t,n,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let i of Go(t))!Yo.call(e,i)&&i!==n&&Bn(e,i,{get:()=>t[i],enumerable:!(s=Jo(t,i))||s.enumerable});return e},Wn=(e,t,n)=>(n=null!=e?Ho(Xo(e)):{},Zo(!t&&e&&e.__esModule?n:Bn(n,"default",{value:e,enumerable:!0}),e)),Jn=R(((e,t)=>{var n,s;n=e,s=function(e){function t(e,t){let n=0;for(let s of e)if(!1===t(s,n++))return!1;return!0}var n;e.ArrayExt=void 0,function(e){function t(e,t,n=0,s=-1){let i,r=e.length;if(0===r)return-1;n=n<0?Math.max(0,n+r):Math.min(n,r-1),i=(s=s<0?Math.max(0,s+r):Math.min(s,r-1))<n?s+1+(r-n):s-n+1;for(let s=0;s<i;++s){let i=(n+s)%r;if(e[i]===t)return i}return-1}function n(e,t,n=-1,s=0){let i,r=e.length;if(0===r)return-1;i=(n=n<0?Math.max(0,n+r):Math.min(n,r-1))<(s=s<0?Math.max(0,s+r):Math.min(s,r-1))?n+1+(r-s):n-s+1;for(let s=0;s<i;++s){let i=(n-s+r)%r;if(e[i]===t)return i}return-1}function s(e,t,n=0,s=-1){let i,r=e.length;if(0===r)return-1;n=n<0?Math.max(0,n+r):Math.min(n,r-1),i=(s=s<0?Math.max(0,s+r):Math.min(s,r-1))<n?s+1+(r-n):s-n+1;for(let s=0;s<i;++s){let i=(n+s)%r;if(t(e[i],i))return i}return-1}function i(e,t,n=-1,s=0){let i,r=e.length;if(0===r)return-1;i=(n=n<0?Math.max(0,n+r):Math.min(n,r-1))<(s=s<0?Math.max(0,s+r):Math.min(s,r-1))?n+1+(r-s):n-s+1;for(let s=0;s<i;++s){let i=(n-s+r)%r;if(t(e[i],i))return i}return-1}function r(e,t=0,n=-1){let s=e.length;if(!(s<=1))for(t=t<0?Math.max(0,t+s):Math.min(t,s-1),n=n<0?Math.max(0,n+s):Math.min(n,s-1);t<n;){let s=e[t],i=e[n];e[t++]=i,e[n--]=s}}function o(e,t){let n=e.length;if(t<0&&(t+=n),t<0||t>=n)return;let s=e[t];for(let s=t+1;s<n;++s)e[s-1]=e[s];return e.length=n-1,s}e.firstIndexOf=t,e.lastIndexOf=n,e.findFirstIndex=s,e.findLastIndex=i,e.findFirstValue=function(e,t,n=0,i=-1){let r=s(e,t,n,i);return-1!==r?e[r]:void 0},e.findLastValue=function(e,t,n=-1,s=0){let r=i(e,t,n,s);return-1!==r?e[r]:void 0},e.lowerBound=function(e,t,n,s=0,i=-1){let r=e.length;if(0===r)return 0;let o=s=s<0?Math.max(0,s+r):Math.min(s,r-1),a=(i=i<0?Math.max(0,i+r):Math.min(i,r-1))-s+1;for(;a>0;){let s=a>>1,i=o+s;n(e[i],t)<0?(o=i+1,a-=s+1):a=s}return o},e.upperBound=function(e,t,n,s=0,i=-1){let r=e.length;if(0===r)return 0;let o=s=s<0?Math.max(0,s+r):Math.min(s,r-1),a=(i=i<0?Math.max(0,i+r):Math.min(i,r-1))-s+1;for(;a>0;){let s=a>>1,i=o+s;n(e[i],t)>0?a=s:(o=i+1,a-=s+1)}return o},e.shallowEqual=function(e,t,n){if(e===t)return!0;if(e.length!==t.length)return!1;for(let s=0,i=e.length;s<i;++s)if(n?!n(e[s],t[s]):e[s]!==t[s])return!1;return!0},e.slice=function(e,t={}){let{start:n,stop:s,step:i}=t;if(void 0===i&&(i=1),0===i)throw new Error("Slice `step` cannot be zero.");let r,o=e.length;void 0===n?n=i<0?o-1:0:n<0?n=Math.max(n+o,i<0?-1:0):n>=o&&(n=i<0?o-1:o),void 0===s?s=i<0?-1:o:s<0?s=Math.max(s+o,i<0?-1:0):s>=o&&(s=i<0?o-1:o),r=i<0&&s>=n||i>0&&n>=s?0:i<0?Math.floor((s-n+1)/i+1):Math.floor((s-n-1)/i+1);let a=[];for(let t=0;t<r;++t)a[t]=e[n+t*i];return a},e.move=function(e,t,n){let s=e.length;if(s<=1||(t=t<0?Math.max(0,t+s):Math.min(t,s-1))===(n=n<0?Math.max(0,n+s):Math.min(n,s-1)))return;let i=e[t],r=t<n?1:-1;for(let s=t;s!==n;s+=r)e[s]=e[s+r];e[n]=i},e.reverse=r,e.rotate=function(e,t,n=0,s=-1){let i=e.length;if(i<=1||(n=n<0?Math.max(0,n+i):Math.min(n,i-1))>=(s=s<0?Math.max(0,s+i):Math.min(s,i-1)))return;let o=s-n+1;if(t>0?t%=o:t<0&&(t=(t%o+o)%o),0===t)return;let a=n+t;r(e,n,a-1),r(e,a,s),r(e,n,s)},e.fill=function(e,t,n=0,s=-1){let i,r=e.length;if(0!==r){n=n<0?Math.max(0,n+r):Math.min(n,r-1),i=(s=s<0?Math.max(0,s+r):Math.min(s,r-1))<n?s+1+(r-n):s-n+1;for(let s=0;s<i;++s)e[(n+s)%r]=t}},e.insert=function(e,t,n){let s=e.length;t=t<0?Math.max(0,t+s):Math.min(t,s);for(let n=s;n>t;--n)e[n]=e[n-1];e[t]=n},e.removeAt=o,e.removeFirstOf=function(e,n,s=0,i=-1){let r=t(e,n,s,i);return-1!==r&&o(e,r),r},e.removeLastOf=function(e,t,s=-1,i=0){let r=n(e,t,s,i);return-1!==r&&o(e,r),r},e.removeAllOf=function(e,t,n=0,s=-1){let i=e.length;if(0===i)return 0;n=n<0?Math.max(0,n+i):Math.min(n,i-1),s=s<0?Math.max(0,s+i):Math.min(s,i-1);let r=0;for(let o=0;o<i;++o)n<=s&&o>=n&&o<=s&&e[o]===t||s<n&&(o<=s||o>=n)&&e[o]===t?r++:r>0&&(e[o-r]=e[o]);return r>0&&(e.length=i-r),r},e.removeFirstWhere=function(e,t,n=0,i=-1){let r,a=s(e,t,n,i);return-1!==a&&(r=o(e,a)),{index:a,value:r}},e.removeLastWhere=function(e,t,n=-1,s=0){let r,a=i(e,t,n,s);return-1!==a&&(r=o(e,a)),{index:a,value:r}},e.removeAllWhere=function(e,t,n=0,s=-1){let i=e.length;if(0===i)return 0;n=n<0?Math.max(0,n+i):Math.min(n,i-1),s=s<0?Math.max(0,s+i):Math.min(s,i-1);let r=0;for(let o=0;o<i;++o)n<=s&&o>=n&&o<=s&&t(e[o],o)||s<n&&(o<=s||o>=n)&&t(e[o],o)?r++:r>0&&(e[o-r]=e[o]);return r>0&&(e.length=i-r),r}}(e.ArrayExt||(e.ArrayExt={})),(n||(n={})).rangeLength=function(e,t,n){return 0===n?1/0:e>t&&n>0||e<t&&n<0?0:Math.ceil((t-e)/n)},e.StringExt=void 0,function(e){function t(e,t,n=0){let s=new Array(t.length);for(let i=0,r=n,o=t.length;i<o;++i,++r){if(r=e.indexOf(t[i],r),-1===r)return null;s[i]=r}return s}e.findIndices=t,e.matchSumOfSquares=function(e,n,s=0){let i=t(e,n,s);if(!i)return null;let r=0;for(let e=0,t=i.length;e<t;++e){let t=i[e]-s;r+=t*t}return{score:r,indices:i}},e.matchSumOfDeltas=function(e,n,s=0){let i=t(e,n,s);if(!i)return null;let r=0,o=s-1;for(let e=0,t=i.length;e<t;++e){let t=i[e];r+=t-o-1,o=t}return{score:r,indices:i}},e.highlight=function(e,t,n){let s=[],i=0,r=0,o=t.length;for(;i<o;){let a=t[i],l=t[i];for(;++i<o&&t[i]===l+1;)l++;r<a&&s.push(e.slice(r,a)),a<l+1&&s.push(n(e.slice(a,l+1))),r=l+1}return r<e.length&&s.push(e.slice(r)),s},e.cmp=function(e,t){return e<t?-1:e>t?1:0}}(e.StringExt||(e.StringExt={})),e.chain=function*(...e){for(let t of e)yield*t},e.each=function(e,t){let n=0;for(let s of e)if(!1===t(s,n++))return},e.empty=function*(){},e.enumerate=function*(e,t=0){for(let n of e)yield[t++,n]},e.every=t,e.filter=function*(e,t){let n=0;for(let s of e)t(s,n++)&&(yield s)},e.find=function(e,t){let n=0;for(let s of e)if(t(s,n++))return s},e.findIndex=function(e,t){let n=0;for(let s of e)if(t(s,n++))return n-1;return-1},e.map=function*(e,t){let n=0;for(let s of e)yield t(s,n++)},e.max=function(e,t){let n;for(let s of e)void 0!==n?t(s,n)>0&&(n=s):n=s;return n},e.min=function(e,t){let n;for(let s of e)void 0!==n?t(s,n)<0&&(n=s):n=s;return n},e.minmax=function(e,t){let n,s,i=!0;for(let r of e)i?(n=r,s=r,i=!1):t(r,n)<0?n=r:t(r,s)>0&&(s=r);return i?void 0:[n,s]},e.once=function*(e){yield e},e.range=function*(e,t,s){void 0===t?(t=e,e=0,s=1):void 0===s&&(s=1);let i=n.rangeLength(e,t,s);for(let t=0;t<i;t++)yield e+s*t},e.reduce=function(e,t,n){let s=e[Symbol.iterator](),i=0,r=s.next();if(r.done&&void 0===n)throw new TypeError("Reduce of empty iterable with no initial value.");if(r.done)return n;let o,a,l=s.next();if(l.done&&void 0===n)return r.value;if(l.done)return t(n,r.value,i++);for(o=t(void 0===n?r.value:t(n,r.value,i++),l.value,i++);!(a=s.next()).done;)o=t(o,a.value,i++);return o},e.repeat=function*(e,t){for(;0<t--;)yield e},e.retro=function*(e){if("function"==typeof e.retro)yield*e.retro();else for(let t=e.length-1;t>-1;t--)yield e[t]},e.some=function(e,t){let n=0;for(let s of e)if(t(s,n++))return!0;return!1},e.stride=function*(e,t){let n=0;for(let s of e)n++%t==0&&(yield s)},e.take=function*(e,t){if(t<1)return;let n,s=e[Symbol.iterator]();for(;0<t--&&!(n=s.next()).done;)yield n.value},e.toArray=function(e){return Array.from(e)},e.toObject=function(e){let t={};for(let[n,s]of e)t[n]=s;return t},e.topologicSort=function(e){let t=[],n=new Set,s=new Map;for(let t of e)i(t);for(let[e]of s)r(e);return t;function i(e){let[t,n]=e,i=s.get(n);i?i.push(t):s.set(n,[t])}function r(e){if(n.has(e))return;n.add(e);let i=s.get(e);if(i)for(let e of i)r(e);t.push(e)}},e.zip=function*(...e){let n=e.map((e=>e[Symbol.iterator]())),s=n.map((e=>e.next()));for(;t(s,(e=>!e.done));s=n.map((e=>e.next())))yield s.map((e=>e.value))}},"object"==typeof e&&void 0!==t?s(e):"function"==typeof define&&__webpack_require__.amdO?define(["exports"],s):s((n="undefined"!=typeof globalThis?globalThis:n||self).lumino_algorithm={})})),Z=R(((e,t)=>{var n,s;n=e,s=function(e,t){var n;function s(e){let t=0;for(let n=0,s=e.length;n<s;++n)n%4==0&&(t=4294967295*Math.random()>>>0),e[n]=255&t,t>>>=8}e.JSONExt=void 0,function(e){function t(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e}function n(e){return Array.isArray(e)}e.emptyObject=Object.freeze({}),e.emptyArray=Object.freeze([]),e.isPrimitive=t,e.isArray=n,e.isObject=function(e){return!t(e)&&!n(e)},e.deepEqual=function e(s,i){if(s===i)return!0;if(t(s)||t(i))return!1;let r=n(s),o=n(i);return r===o&&(r&&o?function(t,n){if(t===n)return!0;if(t.length!==n.length)return!1;for(let s=0,i=t.length;s<i;++s)if(!e(t[s],n[s]))return!1;return!0}(s,i):function(t,n){if(t===n)return!0;for(let e in t)if(void 0!==t[e]&&!(e in n))return!1;for(let e in n)if(void 0!==n[e]&&!(e in t))return!1;for(let s in t){let i=t[s],r=n[s];if(!(void 0===i&&void 0===r||void 0!==i&&void 0!==r&&e(i,r)))return!1}return!0}(s,i))},e.deepCopy=function e(s){return t(s)?s:n(s)?function(t){let n=new Array(t.length);for(let s=0,i=t.length;s<i;++s)n[s]=e(t[s]);return n}(s):function(t){let n={};for(let s in t){let i=t[s];void 0!==i&&(n[s]=e(i))}return n}(s)}}(e.JSONExt||(e.JSONExt={})),function(e){class n{constructor(e){var t,n,s,i;this._activated=!1,this._promise=null,this._service=null,this.id=e.id,this.description=null!==(t=e.description)&&void 0!==t?t:"",this.activate=e.activate,this.deactivate=null!==(n=e.deactivate)&&void 0!==n?n:null,this.provides=null!==(s=e.provides)&&void 0!==s?s:null,this.autoStart=null!==(i=e.autoStart)&&void 0!==i&&i,this.requires=e.requires?e.requires.slice():[],this.optional=e.optional?e.optional.slice():[]}get activated(){return this._activated}set activated(e){this._activated=e}get service(){return this._service}set service(e){this._service=e}get promise(){return this._promise}set promise(e){this._promise=e}}e.createPluginData=function(e){return new n(e)},e.ensureNoCycle=function(e,t,n){let s=[...e.requires,...e.optional],i=s=>{if(s===e.provides)return!0;let o=n.get(s);if(!o)return!1;let a=t.get(o),l=[...a.requires,...a.optional];return 0!==l.length&&(r.push(o),!!l.some(i)||(r.pop(),!1))};if(!e.provides||0===s.length)return;let r=[e.id];if(s.some(i))throw new ReferenceError(`Cycle detected: ${r.join(" -> ")}.`)},e.findDependents=function(e,n,s){let i=new Array,r=e=>{let t=n.get(e),r=[...t.requires,...t.optional];i.push(...r.reduce(((t,n)=>{let i=s.get(n);return i&&t.push([e,i]),t}),[]))};for(let e of n.keys())r(e);let o=i.filter((t=>t[1]===e)),a=0;for(;o.length>a;){let e=o.length,t=new Set(o.map((e=>e[0])));for(let e of t)i.filter((t=>t[1]===e)).forEach((e=>{o.includes(e)||o.push(e)}));a=e}let l=t.topologicSort(o),h=l.findIndex((t=>t===e));return-1===h?[e]:l.slice(0,h+1)},e.collectStartupPlugins=function(e,t){let n=new Set;for(let t of e.keys())!0===e.get(t).autoStart&&n.add(t);if(t.startPlugins)for(let e of t.startPlugins)n.add(e);if(t.ignorePlugins)for(let e of t.ignorePlugins)n.delete(e);return Array.from(n)}}(n||(n={})),e.Random=void 0,(e.Random||(e.Random={})).getRandomValues=(()=>{let e="undefined"!=typeof window&&(window.crypto||window.msCrypto)||null;return e&&"function"==typeof e.getRandomValues?function(t){return e.getRandomValues(t)}:s})(),e.UUID=void 0,(e.UUID||(e.UUID={})).uuid4=function(e){let t=new Uint8Array(16),n=new Array(256);for(let e=0;e<16;++e)n[e]="0"+e.toString(16);for(let e=16;e<256;++e)n[e]=e.toString(16);return function(){return e(t),t[6]=64|15&t[6],t[8]=128|63&t[8],n[t[0]]+n[t[1]]+n[t[2]]+n[t[3]]+"-"+n[t[4]]+n[t[5]]+"-"+n[t[6]]+n[t[7]]+"-"+n[t[8]]+n[t[9]]+"-"+n[t[10]]+n[t[11]]+n[t[12]]+n[t[13]]+n[t[14]]+n[t[15]]}}(e.Random.getRandomValues),e.MimeData=class{constructor(){this._types=[],this._values=[]}types(){return this._types.slice()}hasData(e){return-1!==this._types.indexOf(e)}getData(e){let t=this._types.indexOf(e);return-1!==t?this._values[t]:void 0}setData(e,t){this.clearData(e),this._types.push(e),this._values.push(t)}clearData(e){let t=this._types.indexOf(e);-1!==t&&(this._types.splice(t,1),this._values.splice(t,1))}clear(){this._types.length=0,this._values.length=0}},e.PluginRegistry=class{constructor(e={}){this._application=null,this._validatePlugin=()=>!0,this._plugins=new Map,this._services=new Map,e.validatePlugin&&(console.info("Plugins may be rejected by the custom validation plugin method."),this._validatePlugin=e.validatePlugin)}get application(){return this._application}set application(e){if(null!==this._application)throw Error("PluginRegistry.application is already set. It cannot be overridden.");this._application=e}get deferredPlugins(){return Array.from(this._plugins).filter((([e,t])=>"defer"===t.autoStart)).map((([e,t])=>e))}getPluginDescription(e){var t,n;return null!==(n=null===(t=this._plugins.get(e))||void 0===t?void 0:t.description)&&void 0!==n?n:""}hasPlugin(e){return this._plugins.has(e)}isPluginActivated(e){var t,n;return null!==(n=null===(t=this._plugins.get(e))||void 0===t?void 0:t.activated)&&void 0!==n&&n}listPlugins(){return Array.from(this._plugins.keys())}registerPlugin(e){if(this._plugins.has(e.id))throw new TypeError(`Plugin '${e.id}' is already registered.`);if(!this._validatePlugin(e))throw new Error(`Plugin '${e.id}' is not valid.`);let t=n.createPluginData(e);n.ensureNoCycle(t,this._plugins,this._services),t.provides&&this._services.set(t.provides,t.id),this._plugins.set(t.id,t)}registerPlugins(e){for(let t of e)this.registerPlugin(t)}deregisterPlugin(e,t){let n=this._plugins.get(e);if(n){if(n.activated&&!t)throw new Error(`Plugin '${e}' is still active.`);this._plugins.delete(e)}}async activatePlugin(e){let t=this._plugins.get(e);if(!t)throw new ReferenceError(`Plugin '${e}' is not registered.`);if(t.activated)return;if(t.promise)return t.promise;let n=t.requires.map((e=>this.resolveRequiredService(e))),s=t.optional.map((e=>this.resolveOptionalService(e)));return t.promise=Promise.all([...n,...s]).then((e=>t.activate.apply(void 0,[this.application,...e]))).then((e=>{t.service=e,t.activated=!0,t.promise=null})).catch((e=>{throw t.promise=null,e})),t.promise}async activatePlugins(e,t={}){switch(e){case"defer":{let e=this.deferredPlugins.filter((e=>this._plugins.get(e).autoStart)).map((e=>this.activatePlugin(e)));await Promise.all(e);break}case"startUp":{let e=n.collectStartupPlugins(this._plugins,t).map((async e=>{try{return await this.activatePlugin(e)}catch(t){console.error(`Plugin '${e}' failed to activate.`,t)}}));await Promise.all(e);break}}}async deactivatePlugin(e){let t=this._plugins.get(e);if(!t)throw new ReferenceError(`Plugin '${e}' is not registered.`);if(!t.activated)return[];if(!t.deactivate)throw new TypeError(`Plugin '${e}'#deactivate() method missing`);let s=n.findDependents(e,this._plugins,this._services),i=s.map((e=>this._plugins.get(e)));for(let t of i)if(!t.deactivate)throw new TypeError(`Plugin ${t.id}#deactivate() method missing (depends on ${e})`);for(let e of i){let t=[...e.requires,...e.optional].map((e=>{let t=this._services.get(e);return t?this._plugins.get(t).service:null}));await e.deactivate(this.application,...t),e.service=null,e.activated=!1}return s.pop(),s}async resolveRequiredService(e){let t=this._services.get(e);if(!t)throw new TypeError(`No provider for: ${e.name}.`);let n=this._plugins.get(t);return n.activated||await this.activatePlugin(t),n.service}async resolveOptionalService(e){let t=this._services.get(e);if(!t)return null;let n=this._plugins.get(t);if(!n.activated)try{await this.activatePlugin(t)}catch(e){return console.error(e),null}return n.service}},e.PromiseDelegate=class{constructor(){this.promise=new Promise(((e,t)=>{this._resolve=e,this._reject=t}))}resolve(e){(0,this._resolve)(e)}reject(e){(0,this._reject)(e)}},e.Token=class{constructor(e,t){this.name=e,this.description=null!=t?t:"",this._tokenStructuralPropertyT=null}}},"object"==typeof e&&void 0!==t?s(e,Jn()):"function"==typeof define&&__webpack_require__.amdO?define(["exports","@lumino/algorithm"],s):s((n="undefined"!=typeof globalThis?globalThis:n||self).lumino_coreutils={},n.lumino_algorithm)})),ee=R(((e,t)=>{var n,s;n=e,s=function(e,t,n){class s{constructor(e){this.sender=e}connect(e,t){return r.connect(this,e,t)}disconnect(e,t){return r.disconnect(this,e,t)}emit(e){r.emit(this,e)}}var i,r;(i=s||(s={})).disconnectBetween=function(e,t){r.disconnectBetween(e,t)},i.disconnectSender=function(e){r.disconnectSender(e)},i.disconnectReceiver=function(e){r.disconnectReceiver(e)},i.disconnectAll=function(e){r.disconnectAll(e)},i.clearData=function(e){r.disconnectAll(e)},i.getExceptionHandler=function(){return r.exceptionHandler},i.setExceptionHandler=function(e){let t=r.exceptionHandler;return r.exceptionHandler=e,t};class o extends s{constructor(){super(...arguments),this._pending=new n.PromiseDelegate}async*[Symbol.asyncIterator](){let e=this._pending;for(;;)try{let{args:t,next:n}=await e.promise;e=n,yield t}catch{return}}emit(e){let t=this._pending,s=this._pending=new n.PromiseDelegate;t.resolve({args:e,next:s}),super.emit(e)}stop(){this._pending.promise.catch((()=>{})),this._pending.reject("stop"),this._pending=new n.PromiseDelegate}}(function(e){function n(e){let t=i.get(e);if(t&&0!==t.length){for(let e of t){if(!e.signal)continue;let t=e.thisArg||e.slot;e.signal=null,u(r.get(t))}u(t)}}function s(e){let t=r.get(e);if(t&&0!==t.length){for(let e of t){if(!e.signal)continue;let t=e.signal.sender;e.signal=null,u(i.get(t))}u(t)}}e.exceptionHandler=e=>{console.error(e)},e.connect=function(e,t,n){n=n||void 0;let s=i.get(e.sender);if(s||(s=[],i.set(e.sender,s)),l(s,e,t,n))return!1;let o=n||t,a=r.get(o);a||(a=[],r.set(o,a));let h={signal:e,slot:t,thisArg:n};return s.push(h),a.push(h),!0},e.disconnect=function(e,t,n){n=n||void 0;let s=i.get(e.sender);if(!s||0===s.length)return!1;let o=l(s,e,t,n);if(!o)return!1;let a=n||t,h=r.get(a);return o.signal=null,u(s),u(h),!0},e.disconnectBetween=function(e,t){let n=i.get(e);if(!n||0===n.length)return;let s=r.get(t);if(s&&0!==s.length){for(let t of s)t.signal&&t.signal.sender===e&&(t.signal=null);u(n),u(s)}},e.disconnectSender=n,e.disconnectReceiver=s,e.disconnectAll=function(e){n(e),s(e)},e.emit=function(e,t){let n=i.get(e.sender);if(n&&0!==n.length)for(let s=0,i=n.length;s<i;++s){let i=n[s];i.signal===e&&h(i,t)}};let i=new WeakMap,r=new WeakMap,o=new Set,a="function"==typeof requestAnimationFrame?requestAnimationFrame:setImmediate;function l(e,n,s,i){return t.find(e,(e=>e.signal===n&&e.slot===s&&e.thisArg===i))}function h(t,n){let{signal:s,slot:i,thisArg:r}=t;try{i.call(r,s.sender,n)}catch(t){e.exceptionHandler(t)}}function u(e){0===o.size&&a(d),o.add(e)}function d(){o.forEach(c),o.clear()}function c(e){t.ArrayExt.removeAllWhere(e,p)}function p(e){return null===e.signal}})(r||(r={})),e.Signal=s,e.Stream=o},"object"==typeof e&&void 0!==t?s(e,Jn(),Z()):"function"==typeof define&&__webpack_require__.amdO?define(["exports","@lumino/algorithm","@lumino/coreutils"],s):s((n="undefined"!=typeof globalThis?globalThis:n||self).lumino_signaling={},n.lumino_algorithm,n.lumino_coreutils)})),pr=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ActivityMonitor=void 0;var t=ee();e.ActivityMonitor=class{constructor(e){this._timer=-1,this._timeout=-1,this._isDisposed=!1,this._activityStopped=new t.Signal(this),e.signal.connect(this._onSignalFired,this),this._timeout=e.timeout||1e3}get activityStopped(){return this._activityStopped}get timeout(){return this._timeout}set timeout(e){this._timeout=e}get isDisposed(){return this._isDisposed}dispose(){this._isDisposed||(this._isDisposed=!0,t.Signal.clearData(this))}_onSignalFired(e,t){clearTimeout(this._timer),this._sender=e,this._args=t,this._timer=setTimeout((()=>{this._activityStopped.emit({sender:this._sender,args:this._args})}),this._timeout)}}})),mr=R((e=>{Object.defineProperty(e,"__esModule",{value:!0})})),vr=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.LruCache=void 0,e.LruCache=class{constructor(e={}){this._map=new Map,this._maxSize=(null==e?void 0:e.maxSize)||128}get size(){return this._map.size}clear(){this._map.clear()}get(e){let t=this._map.get(e)||null;return null!=t&&(this._map.delete(e),this._map.set(e,t)),t}set(e,t){this._map.size>=this._maxSize&&this._map.delete(this._map.keys().next().value),this._map.set(e,t)}}})),wr=R((e=>{var t;Object.defineProperty(e,"__esModule",{value:!0}),e.MarkdownCodeBlocks=void 0,function(e){e.CODE_BLOCK_MARKER="```";let t=[".markdown",".mdown",".mkdn",".md",".mkd",".mdwn",".mdtxt",".mdtext",".text",".txt",".Rmd"];class n{constructor(e){this.startLine=e,this.code="",this.endLine=-1}}e.MarkdownCodeBlock=n,e.isMarkdown=function(e){return t.indexOf(e)>-1},e.findMarkdownCodeBlocks=function(t){if(!t||""===t)return[];let s=t.split("\n"),i=[],r=null;for(let t=0;t<s.length;t++){let o=s[t],a=0===o.indexOf(e.CODE_BLOCK_MARKER),l=null!=r;if(a||l)if(l)r&&(a?(r.endLine=t-1,i.push(r),r=null):r.code+=o+"\n");else{r=new n(t);let s=o.indexOf(e.CODE_BLOCK_MARKER),a=o.lastIndexOf(e.CODE_BLOCK_MARKER);s!==a&&(r.code=o.substring(s+e.CODE_BLOCK_MARKER.length,a),r.endLine=t,i.push(r),r=null)}}return i}}(t||(e.MarkdownCodeBlocks=t={}))})),Pr=R(((e,t)=>{function n(e){return!("number"!=typeof e&&!/^0x[0-9a-f]+$/i.test(e))||/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(e)}function s(e,t){return"constructor"===t&&"function"==typeof e[t]||"__proto__"===t}t.exports=function(e,t){t||(t={});var i={bools:{},strings:{},unknownFn:null};"function"==typeof t.unknown&&(i.unknownFn=t.unknown),"boolean"==typeof t.boolean&&t.boolean?i.allBools=!0:[].concat(t.boolean).filter(Boolean).forEach((function(e){i.bools[e]=!0}));var r={};function o(e){return r[e].some((function(e){return i.bools[e]}))}Object.keys(t.alias||{}).forEach((function(e){r[e]=[].concat(t.alias[e]),r[e].forEach((function(t){r[t]=[e].concat(r[e].filter((function(e){return t!==e})))}))})),[].concat(t.string).filter(Boolean).forEach((function(e){i.strings[e]=!0,r[e]&&[].concat(r[e]).forEach((function(e){i.strings[e]=!0}))}));var a=t.default||{},l={_:[]};function h(e,t,n){for(var r=e,o=0;o<t.length-1;o++){var a=t[o];if(s(r,a))return;void 0===r[a]&&(r[a]={}),(r[a]===Object.prototype||r[a]===Number.prototype||r[a]===String.prototype)&&(r[a]={}),r[a]===Array.prototype&&(r[a]=[]),r=r[a]}var l=t[t.length-1];s(r,l)||((r===Object.prototype||r===Number.prototype||r===String.prototype)&&(r={}),r===Array.prototype&&(r=[]),void 0===r[l]||i.bools[l]||"boolean"==typeof r[l]?r[l]=n:Array.isArray(r[l])?r[l].push(n):r[l]=[r[l],n])}function u(e,t,s){if(!s||!i.unknownFn||function(e,t){return i.allBools&&/^--[^=]+$/.test(t)||i.strings[e]||i.bools[e]||r[e]}(e,s)||!1!==i.unknownFn(s)){var o=!i.strings[e]&&n(t)?Number(t):t;h(l,e.split("."),o),(r[e]||[]).forEach((function(e){h(l,e.split("."),o)}))}}Object.keys(i.bools).forEach((function(e){u(e,void 0!==a[e]&&a[e])}));var d=[];-1!==e.indexOf("--")&&(d=e.slice(e.indexOf("--")+1),e=e.slice(0,e.indexOf("--")));for(var c=0;c<e.length;c++){var p,_,f=e[c];if(/^--.+=/.test(f)){var m=f.match(/^--([^=]+)=([\s\S]*)$/);p=m[1];var g=m[2];i.bools[p]&&(g="false"!==g),u(p,g,f)}else if(/^--no-.+/.test(f))u(p=f.match(/^--no-(.+)/)[1],!1,f);else if(/^--.+/.test(f))p=f.match(/^--(.+)/)[1],void 0===(_=e[c+1])||/^(-|--)[^-]/.test(_)||i.bools[p]||i.allBools||r[p]&&o(p)?/^(true|false)$/.test(_)?(u(p,"true"===_,f),c+=1):u(p,!i.strings[p]||"",f):(u(p,_,f),c+=1);else if(/^-[^-]+/.test(f)){for(var v=f.slice(1,-1).split(""),y=!1,w=0;w<v.length;w++)if("-"!==(_=f.slice(w+2))){if(/[A-Za-z]/.test(v[w])&&"="===_[0]){u(v[w],_.slice(1),f),y=!0;break}if(/[A-Za-z]/.test(v[w])&&/-?\d+(\.\d*)?(e-?\d+)?$/.test(_)){u(v[w],_,f),y=!0;break}if(v[w+1]&&v[w+1].match(/\W/)){u(v[w],f.slice(w+2),f),y=!0;break}u(v[w],!i.strings[v[w]]||"",f)}else u(v[w],_,f);p=f.slice(-1)[0],!y&&"-"!==p&&(!e[c+1]||/^(-|--)[^-]/.test(e[c+1])||i.bools[p]||r[p]&&o(p)?e[c+1]&&/^(true|false)$/.test(e[c+1])?(u(p,"true"===e[c+1],f),c+=1):u(p,!i.strings[p]||"",f):(u(p,e[c+1],f),c+=1))}else if((!i.unknownFn||!1!==i.unknownFn(f))&&l._.push(i.strings._||!n(f)?f:Number(f)),t.stopEarly){l._.push.apply(l._,e.slice(c+1));break}}return Object.keys(a).forEach((function(e){(function(e,t){var n=e;return t.slice(0,-1).forEach((function(e){n=n[e]||{}})),t[t.length-1]in n})(l,e.split("."))||(h(l,e.split("."),a[e]),(r[e]||[]).forEach((function(t){h(l,t.split("."),a[e])})))})),t["--"]?l["--"]=d.slice():d.forEach((function(e){l._.push(e)})),l}})),Bt=R(((e,t)=>{function n(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function s(e,t){for(var n,s="",i=0,r=-1,o=0,a=0;a<=e.length;++a){if(a<e.length)n=e.charCodeAt(a);else{if(47===n)break;n=47}if(47===n){if(r!==a-1&&1!==o)if(r!==a-1&&2===o){if(s.length<2||2!==i||46!==s.charCodeAt(s.length-1)||46!==s.charCodeAt(s.length-2))if(s.length>2){var l=s.lastIndexOf("/");if(l!==s.length-1){-1===l?(s="",i=0):i=(s=s.slice(0,l)).length-1-s.lastIndexOf("/"),r=a,o=0;continue}}else if(2===s.length||1===s.length){s="",i=0,r=a,o=0;continue}t&&(s.length>0?s+="/..":s="..",i=2)}else s.length>0?s+="/"+e.slice(r+1,a):s=e.slice(r+1,a),i=a-r-1;r=a,o=0}else 46===n&&-1!==o?++o:o=-1}return s}var i={resolve:function(){for(var e,t="",i=!1,r=arguments.length-1;r>=-1&&!i;r--){var o;r>=0?o=arguments[r]:(void 0===e&&(e=process.cwd()),o=e),n(o),0!==o.length&&(t=o+"/"+t,i=47===o.charCodeAt(0))}return t=s(t,!i),i?t.length>0?"/"+t:"/":t.length>0?t:"."},normalize:function(e){if(n(e),0===e.length)return".";var t=47===e.charCodeAt(0),i=47===e.charCodeAt(e.length-1);return 0===(e=s(e,!t)).length&&!t&&(e="."),e.length>0&&i&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return n(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,t=0;t<arguments.length;++t){var s=arguments[t];n(s),s.length>0&&(void 0===e?e=s:e+="/"+s)}return void 0===e?".":i.normalize(e)},relative:function(e,t){if(n(e),n(t),e===t||(e=i.resolve(e))===(t=i.resolve(t)))return"";for(var s=1;s<e.length&&47===e.charCodeAt(s);++s);for(var r=e.length,o=r-s,a=1;a<t.length&&47===t.charCodeAt(a);++a);for(var l=t.length-a,h=o<l?o:l,u=-1,d=0;d<=h;++d){if(d===h){if(l>h){if(47===t.charCodeAt(a+d))return t.slice(a+d+1);if(0===d)return t.slice(a+d)}else o>h&&(47===e.charCodeAt(s+d)?u=d:0===d&&(u=0));break}var c=e.charCodeAt(s+d);if(c!==t.charCodeAt(a+d))break;47===c&&(u=d)}var p="";for(d=s+u+1;d<=r;++d)(d===r||47===e.charCodeAt(d))&&(0===p.length?p+="..":p+="/..");return p.length>0?p+t.slice(a+u):(a+=u,47===t.charCodeAt(a)&&++a,t.slice(a))},_makeLong:function(e){return e},dirname:function(e){if(n(e),0===e.length)return".";for(var t=e.charCodeAt(0),s=47===t,i=-1,r=!0,o=e.length-1;o>=1;--o)if(47===(t=e.charCodeAt(o))){if(!r){i=o;break}}else r=!1;return-1===i?s?"/":".":s&&1===i?"//":e.slice(0,i)},basename:function(e,t){if(void 0!==t&&"string"!=typeof t)throw new TypeError('"ext" argument must be a string');n(e);var s,i=0,r=-1,o=!0;if(void 0!==t&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var a=t.length-1,l=-1;for(s=e.length-1;s>=0;--s){var h=e.charCodeAt(s);if(47===h){if(!o){i=s+1;break}}else-1===l&&(o=!1,l=s+1),a>=0&&(h===t.charCodeAt(a)?-1==--a&&(r=s):(a=-1,r=l))}return i===r?r=l:-1===r&&(r=e.length),e.slice(i,r)}for(s=e.length-1;s>=0;--s)if(47===e.charCodeAt(s)){if(!o){i=s+1;break}}else-1===r&&(o=!1,r=s+1);return-1===r?"":e.slice(i,r)},extname:function(e){n(e);for(var t=-1,s=0,i=-1,r=!0,o=0,a=e.length-1;a>=0;--a){var l=e.charCodeAt(a);if(47!==l)-1===i&&(r=!1,i=a+1),46===l?-1===t?t=a:1!==o&&(o=1):-1!==t&&(o=-1);else if(!r){s=a+1;break}}return-1===t||-1===i||0===o||1===o&&t===i-1&&t===s+1?"":e.slice(t,i)},format:function(e){if(null===e||"object"!=typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,t){var n=t.dir||t.root,s=t.base||(t.name||"")+(t.ext||"");return n?n===t.root?n+s:n+"/"+s:s}(0,e)},parse:function(e){n(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return t;var s,i=e.charCodeAt(0),r=47===i;r?(t.root="/",s=1):s=0;for(var o=-1,a=0,l=-1,h=!0,u=e.length-1,d=0;u>=s;--u)if(47!==(i=e.charCodeAt(u)))-1===l&&(h=!1,l=u+1),46===i?-1===o?o=u:1!==d&&(d=1):-1!==o&&(d=-1);else if(!h){a=u+1;break}return-1===o||-1===l||0===d||1===d&&o===l-1&&o===a+1?-1!==l&&(t.base=t.name=0===a&&r?e.slice(1,l):e.slice(a,l)):(0===a&&r?(t.name=e.slice(1,o),t.base=e.slice(1,l)):(t.name=e.slice(a,o),t.base=e.slice(a,l)),t.ext=e.slice(o,l)),a>0?t.dir=e.slice(0,a-1):r&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};i.posix=i,t.exports=i})),Rr=R(((e,t)=>{t.exports=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e}})),Dr=R((e=>{var t=Object.prototype.hasOwnProperty;function n(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch{return null}}function s(e){try{return encodeURIComponent(e)}catch{return null}}e.stringify=function(e,n){n=n||"";var i,r,o=[];for(r in"string"!=typeof n&&(n="?"),e)if(t.call(e,r)){if(!(i=e[r])&&(null==i||isNaN(i))&&(i=""),r=s(r),i=s(i),null===r||null===i)continue;o.push(r+"="+i)}return o.length?n+o.join("&"):""},e.parse=function(e){for(var t,s=/([^=?#&]+)=?([^&]*)/g,i={};t=s.exec(e);){var r=n(t[1]),o=n(t[2]);null===r||null===o||r in i||(i[r]=o)}return i}})),xr=R(((e,t)=>{var n=Rr(),s=Dr(),i=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,r=/[\n\r\t]/g,o=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,a=/:\d+$/,l=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,h=/^[a-zA-Z]:/;function u(e){return(e||"").toString().replace(i,"")}var d=[["#","hash"],["?","query"],function(e,t){return _(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],c={hash:1,query:1};function p(e){var t,n=("undefined"!=typeof window?window:void 0!==__webpack_require__.g?__webpack_require__.g:"undefined"!=typeof self?self:{}).location||{},s={},i=typeof(e=e||n);if("blob:"===e.protocol)s=new m(unescape(e.pathname),{});else if("string"===i)for(t in s=new m(e,{}),c)delete s[t];else if("object"===i){for(t in e)t in c||(s[t]=e[t]);void 0===s.slashes&&(s.slashes=o.test(e.href))}return s}function _(e){return"file:"===e||"ftp:"===e||"http:"===e||"https:"===e||"ws:"===e||"wss:"===e}function f(e,t){e=(e=u(e)).replace(r,""),t=t||{};var n,s=l.exec(e),i=s[1]?s[1].toLowerCase():"",o=!!s[2],a=!!s[3],h=0;return o?a?(n=s[2]+s[3]+s[4],h=s[2].length+s[3].length):(n=s[2]+s[4],h=s[2].length):a?(n=s[3]+s[4],h=s[3].length):n=s[4],"file:"===i?h>=2&&(n=n.slice(2)):_(i)?n=s[4]:i?o&&(n=n.slice(2)):h>=2&&_(t.protocol)&&(n=s[4]),{protocol:i,slashes:o||_(i),slashesCount:h,rest:n}}function m(e,t,i){if(e=(e=u(e)).replace(r,""),!(this instanceof m))return new m(e,t,i);var o,a,l,c,g,v,y=d.slice(),w=typeof t,b=this,S=0;for("object"!==w&&"string"!==w&&(i=t,t=null),i&&"function"!=typeof i&&(i=s.parse),o=!(a=f(e||"",t=p(t))).protocol&&!a.slashes,b.slashes=a.slashes||o&&t.slashes,b.protocol=a.protocol||t.protocol||"",e=a.rest,("file:"===a.protocol&&(2!==a.slashesCount||h.test(e))||!a.slashes&&(a.protocol||a.slashesCount<2||!_(b.protocol)))&&(y[3]=[/(.*)/,"pathname"]);S<y.length;S++)"function"!=typeof(c=y[S])?(l=c[0],v=c[1],l!=l?b[v]=e:"string"==typeof l?~(g="@"===l?e.lastIndexOf(l):e.indexOf(l))&&("number"==typeof c[2]?(b[v]=e.slice(0,g),e=e.slice(g+c[2])):(b[v]=e.slice(g),e=e.slice(0,g))):(g=l.exec(e))&&(b[v]=g[1],e=e.slice(0,g.index)),b[v]=b[v]||o&&c[3]&&t[v]||"",c[4]&&(b[v]=b[v].toLowerCase())):e=c(e,b);i&&(b.query=i(b.query)),o&&t.slashes&&"/"!==b.pathname.charAt(0)&&(""!==b.pathname||""!==t.pathname)&&(b.pathname=function(e,t){if(""===e)return t;for(var n=(t||"/").split("/").slice(0,-1).concat(e.split("/")),s=n.length,i=n[s-1],r=!1,o=0;s--;)"."===n[s]?n.splice(s,1):".."===n[s]?(n.splice(s,1),o++):o&&(0===s&&(r=!0),n.splice(s,1),o--);return r&&n.unshift(""),("."===i||".."===i)&&n.push(""),n.join("/")}(b.pathname,t.pathname)),"/"!==b.pathname.charAt(0)&&_(b.protocol)&&(b.pathname="/"+b.pathname),n(b.port,b.protocol)||(b.host=b.hostname,b.port=""),b.username=b.password="",b.auth&&(~(g=b.auth.indexOf(":"))?(b.username=b.auth.slice(0,g),b.username=encodeURIComponent(decodeURIComponent(b.username)),b.password=b.auth.slice(g+1),b.password=encodeURIComponent(decodeURIComponent(b.password))):b.username=encodeURIComponent(decodeURIComponent(b.auth)),b.auth=b.password?b.username+":"+b.password:b.username),b.origin="file:"!==b.protocol&&_(b.protocol)&&b.host?b.protocol+"//"+b.host:"null",b.href=b.toString()}m.prototype={set:function(e,t,i){var r=this;switch(e){case"query":"string"==typeof t&&t.length&&(t=(i||s.parse)(t)),r[e]=t;break;case"port":r[e]=t,n(t,r.protocol)?t&&(r.host=r.hostname+":"+t):(r.host=r.hostname,r[e]="");break;case"hostname":r[e]=t,r.port&&(t+=":"+r.port),r.host=t;break;case"host":r[e]=t,a.test(t)?(t=t.split(":"),r.port=t.pop(),r.hostname=t.join(":")):(r.hostname=t,r.port="");break;case"protocol":r.protocol=t.toLowerCase(),r.slashes=!i;break;case"pathname":case"hash":if(t){var o="pathname"===e?"/":"#";r[e]=t.charAt(0)!==o?o+t:t}else r[e]=t;break;case"username":case"password":r[e]=encodeURIComponent(t);break;case"auth":var l=t.indexOf(":");~l?(r.username=t.slice(0,l),r.username=encodeURIComponent(decodeURIComponent(r.username)),r.password=t.slice(l+1),r.password=encodeURIComponent(decodeURIComponent(r.password))):r.username=encodeURIComponent(decodeURIComponent(t))}for(var h=0;h<d.length;h++){var u=d[h];u[4]&&(r[u[1]]=r[u[1]].toLowerCase())}return r.auth=r.password?r.username+":"+r.password:r.username,r.origin="file:"!==r.protocol&&_(r.protocol)&&r.host?r.protocol+"//"+r.host:"null",r.href=r.toString(),r},toString:function(e){(!e||"function"!=typeof e)&&(e=s.stringify);var t,n=this,i=n.host,r=n.protocol;r&&":"!==r.charAt(r.length-1)&&(r+=":");var o=r+(n.protocol&&n.slashes||_(n.protocol)?"//":"");return n.username?(o+=n.username,n.password&&(o+=":"+n.password),o+="@"):n.password?(o+=":"+n.password,o+="@"):"file:"!==n.protocol&&_(n.protocol)&&!i&&"/"!==n.pathname&&(o+="@"),(":"===i[i.length-1]||a.test(n.hostname)&&!n.port)&&(i+=":"),o+=i+n.pathname,(t="object"==typeof n.query?e(n.query):n.query)&&(o+="?"!==t.charAt(0)?"?"+t:t),n.hash&&(o+=n.hash),o}},m.extractProtocol=f,m.location=p,m.trimLeft=u,m.qs=s,t.exports=m})),es=R((e=>{var t=e&&e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:!0}),e.URLExt=void 0;var n,s=Bt(),i=t(xr());!function(e){function t(e){if("undefined"!=typeof document&&document){let t=document.createElement("a");return t.href=e,t}return(0,i.default)(e)}function n(...e){let t=(0,i.default)(e[0],{}),n=""===t.protocol&&t.slashes;n&&(t=(0,i.default)(e[0],"https:"+e[0]));let r=`${n?"":t.protocol}${t.slashes?"//":""}${t.auth}${t.auth?"@":""}${t.host}`,o=s.posix.join(`${r&&"/"!==t.pathname[0]?"/":""}${t.pathname}`,...e.slice(1));return`${r}${"."===o?"":o}`}e.parse=t,e.getHostName=function(e){return(0,i.default)(e).hostname},e.normalize=function(e){return e&&t(e).toString()},e.join=n,e.encodeParts=function(e){return n(...e.split("/").map(encodeURIComponent))},e.objectToQueryString=function(e){let t=Object.keys(e).filter((e=>e.length>0));return t.length?"?"+t.map((t=>{let n=encodeURIComponent(String(e[t]));return t+(n?"="+n:"")})).join("&"):""},e.queryStringToObject=function(e){return e.replace(/^\?/,"").split("&").reduce(((e,t)=>{let[n,s]=t.split("=");return n.length>0&&(e[n]=decodeURIComponent(s||"")),e}),{})},e.isLocal=function(e,n=!1){let{protocol:s}=t(e);return(!s||0!==e.toLowerCase().indexOf(s))&&(n?0!==e.indexOf("//"):0!==e.indexOf("/"))}}(n||(e.URLExt=n={}))})),Kr=R(((exports,module)=>{var __importDefault=exports&&exports.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.PageConfig=void 0;var coreutils_1=Z(),minimist_1=__importDefault(Pr()),url_1=es(),PageConfig;(function(PageConfig){function getOption(name){if(configData)return configData[name]||getBodyData(name);configData=Object.create(null);let found=!1;if("undefined"!=typeof document&&document){let e=document.getElementById("jupyter-config-data");e&&(configData=JSON.parse(e.textContent||""),found=!0)}if(!found&&void 0!==process&&process.argv)try{let cli=(0,minimist_1.default)(process.argv.slice(2)),path=Bt(),fullPath="";"jupyter-config-data"in cli?fullPath=path.resolve(cli["jupyter-config-data"]):"JUPYTER_CONFIG_DATA"in process.env&&(fullPath=path.resolve(process.env.JUPYTER_CONFIG_DATA)),fullPath&&(configData=eval("require")(fullPath))}catch(e){console.error(e)}if(coreutils_1.JSONExt.isObject(configData))for(let e in configData)"string"!=typeof configData[e]&&(configData[e]=JSON.stringify(configData[e]));else configData=Object.create(null);return configData[name]||getBodyData(name)}function setOption(e,t){let n=getOption(e);return configData[e]=t,n}function getBaseUrl(){return url_1.URLExt.normalize(getOption("baseUrl")||"/")}function getTreeUrl(){return url_1.URLExt.join(getBaseUrl(),getOption("treeUrl"))}function getShareUrl(){return url_1.URLExt.normalize(getOption("shareUrl")||getBaseUrl())}function getTreeShareUrl(){return url_1.URLExt.normalize(url_1.URLExt.join(getShareUrl(),getOption("treeUrl")))}function getUrl(e){var t,n,s,i;let r=e.toShare?getShareUrl():getBaseUrl(),o=null!==(t=e.mode)&&void 0!==t?t:getOption("mode"),a=null!==(n=e.workspace)&&void 0!==n?n:getOption("workspace"),l="single-document"===o?"doc":"lab";r=url_1.URLExt.join(r,l),a!==PageConfig.defaultWorkspace&&(r=url_1.URLExt.join(r,"workspaces",encodeURIComponent(null!==(s=getOption("workspace"))&&void 0!==s?s:PageConfig.defaultWorkspace)));let h=null!==(i=e.treePath)&&void 0!==i?i:getOption("treePath");return h&&(r=url_1.URLExt.join(r,"tree",url_1.URLExt.encodeParts(h))),r}function getWsUrl(e){let t=getOption("wsUrl");if(!t){if(0!==(e=e?url_1.URLExt.normalize(e):getBaseUrl()).indexOf("http"))return"";t="ws"+e.slice(4)}return url_1.URLExt.normalize(t)}function getNBConvertURL({path:e,format:t,download:n}){let s=url_1.URLExt.encodeParts(e),i=url_1.URLExt.join(getBaseUrl(),"nbconvert",t,s);return n?i+"?download=true":i}function getToken(){return getOption("token")||getBodyData("jupyterApiToken")}function getNotebookVersion(){let e=getOption("notebookVersion");return""===e?[0,0,0]:JSON.parse(e)}PageConfig.getOption=getOption,PageConfig.setOption=setOption,PageConfig.getBaseUrl=getBaseUrl,PageConfig.getTreeUrl=getTreeUrl,PageConfig.getShareUrl=getShareUrl,PageConfig.getTreeShareUrl=getTreeShareUrl,PageConfig.getUrl=getUrl,PageConfig.defaultWorkspace="default",PageConfig.getWsUrl=getWsUrl,PageConfig.getNBConvertURL=getNBConvertURL,PageConfig.getToken=getToken,PageConfig.getNotebookVersion=getNotebookVersion;let configData=null,Extension;function getBodyData(e){if("undefined"==typeof document||!document.body)return"";let t=document.body.dataset[e];return void 0===t?"":decodeURIComponent(t)}!function(e){function t(e){try{let t=getOption(e);if(t)return JSON.parse(t)}catch(t){console.warn(`Unable to parse ${e}.`,t)}return[]}e.deferred=t("deferredExtensions"),e.disabled=t("disabledExtensions"),e.isDeferred=function(t){let n=t.indexOf(":"),s="";return-1!==n&&(s=t.slice(0,n)),e.deferred.some((e=>e===t||s&&e===s))},e.isDisabled=function(t){let n=t.indexOf(":"),s="";return-1!==n&&(s=t.slice(0,n)),e.disabled.some((e=>e===t||s&&e===s))}}(Extension=PageConfig.Extension||(PageConfig.Extension={}))})(PageConfig||(exports.PageConfig=PageConfig={}))})),Vr=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PathExt=void 0;var t,n=Bt();!function(e){function t(e){return 0===e.indexOf("/")&&(e=e.slice(1)),e}e.join=function(...e){let s=n.posix.join(...e);return"."===s?"":t(s)},e.joinWithLeadingSlash=function(...e){let t=n.posix.join(...e);return"."===t?"":t},e.basename=function(e,t){return n.posix.basename(e,t)},e.dirname=function(e){let s=t(n.posix.dirname(e));return"."===s?"":s},e.extname=function(e){return n.posix.extname(e)},e.normalize=function(e){return""===e?"":t(n.posix.normalize(e))},e.resolve=function(...e){return t(n.posix.resolve(...e))},e.relative=function(e,s){return t(n.posix.relative(e,s))},e.normalizeExtension=function(e){return e.length>0&&0!==e.indexOf(".")&&(e=`.${e}`),e},e.removeSlash=t}(t||(e.PathExt=t={}))})),Br=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.signalToPromise=function(e,n){let s=new t.PromiseDelegate;function i(){e.disconnect(r)}function r(e,t){i(),s.resolve([e,t])}return e.connect(r),(null!=n?n:0)>0&&setTimeout((()=>{i(),s.reject(`Signal not emitted within ${n} ms.`)}),n),s.promise};var t=Z()})),$r=R((e=>{var t,n;Object.defineProperty(e,"__esModule",{value:!0}),e.Text=void 0,(n=t||(e.Text=t={})).jsIndexToCharIndex=function(e,t){return e},n.charIndexToJsIndex=function(e,t){return e},n.camelCase=function(e,t=!1){return e.replace(/^(\w)|[\s-_:]+(\w)/g,(function(e,n,s){return s?s.toUpperCase():t?n.toUpperCase():n.toLowerCase()}))},n.titleCase=function(e){return(e||"").toLowerCase().split(" ").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" ")}})),Jr=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Time=void 0;var t,n,s=[{name:"years",milliseconds:31536e6},{name:"months",milliseconds:2592e6},{name:"days",milliseconds:864e5},{name:"hours",milliseconds:36e5},{name:"minutes",milliseconds:6e4},{name:"seconds",milliseconds:1e3}];(n=t||(e.Time=t={})).formatHuman=function(e,t="long"){let n=document.documentElement.lang||"en",i=new Intl.RelativeTimeFormat(n,{numeric:"auto",style:t}),r=new Date(e).getTime()-Date.now();for(let e of s){let t=Math.ceil(r/e.milliseconds);if(0!==t)return i.format(t,e.name)}return i.format(0,"seconds")},n.format=function(e){let t=document.documentElement.lang||"en";return new Intl.DateTimeFormat(t,{dateStyle:"short",timeStyle:"short"}).format(new Date(e))}})),te=R((e=>{var t=e&&e.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),n=e&&e.__exportStar||function(e,n){for(var s in e)"default"!==s&&!Object.prototype.hasOwnProperty.call(n,s)&&t(n,e,s)};Object.defineProperty(e,"__esModule",{value:!0}),n(pr(),e),n(mr(),e),n(vr(),e),n(wr(),e),n(Kr(),e),n(Vr(),e),n(Br(),e),n($r(),e),n(Jr(),e),n(es(),e)})),Ze=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.supportedKernelWebSocketProtocols=void 0,e.createMessage=function(e){var t,s,i,r,o,a;return{buffers:null!==(t=e.buffers)&&void 0!==t?t:[],channel:e.channel,content:e.content,header:{date:(new Date).toISOString(),msg_id:null!==(s=e.msgId)&&void 0!==s?s:n.UUID.uuid4(),msg_type:e.msgType,session:e.session,username:null!==(i=e.username)&&void 0!==i?i:"",subshell_id:null!==(r=e.subshellId)&&void 0!==r?r:null,version:"5.2"},metadata:null!==(o=e.metadata)&&void 0!==o?o:{},parent_header:null!==(a=e.parentHeader)&&void 0!==a?a:{}}},e.isStreamMsg=function(e){return"stream"===e.header.msg_type},e.isDisplayDataMsg=function(e){return"display_data"===e.header.msg_type},e.isUpdateDisplayDataMsg=function(e){return"update_display_data"===e.header.msg_type},e.isExecuteInputMsg=function(e){return"execute_input"===e.header.msg_type},e.isExecuteResultMsg=function(e){return"execute_result"===e.header.msg_type},e.isErrorMsg=function(e){return"error"===e.header.msg_type},e.isStatusMsg=function(e){return"status"===e.header.msg_type},e.isClearOutputMsg=function(e){return"clear_output"===e.header.msg_type},e.isDebugEventMsg=function(e){return"debug_event"===e.header.msg_type},e.isCommOpenMsg=function(e){return"comm_open"===e.header.msg_type},e.isCommCloseMsg=function(e){return"comm_close"===e.header.msg_type},e.isCommMsgMsg=function(e){return"comm_msg"===e.header.msg_type},e.isInfoRequestMsg=function(e){return"kernel_info_request"===e.header.msg_type},e.isExecuteReplyMsg=function(e){return"execute_reply"===e.header.msg_type},e.isDebugRequestMsg=function(e){return"debug_request"===e.header.msg_type},e.isDebugReplyMsg=function(e){return"debug_reply"===e.header.msg_type},e.isInputRequestMsg=function(e){return"input_request"===e.header.msg_type},e.isInputReplyMsg=function(e){return"input_reply"===e.header.msg_type};var t,n=Z();(t||(e.supportedKernelWebSocketProtocols=t={})).v1KernelWebsocketJupyterOrg="v1.kernel.websocket.jupyter.org"})),Yr=R((e=>{var t=e&&e.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),n=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var s={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&t(s,e,i);return n(s,e),s};Object.defineProperty(e,"__esModule",{value:!0}),e.serialize=function(e,t=""){return t===o.supportedKernelWebSocketProtocols.v1KernelWebsocketJupyterOrg?i.serializeV1KernelWebsocketJupyterOrg(e):i.serializeDefault(e)},e.deserialize=function(e,t=""){return t===o.supportedKernelWebSocketProtocols.v1KernelWebsocketJupyterOrg?i.deserializeV1KernelWebsocketJupyterOrg(e):i.deserializeDefault(e)};var i,r,o=s(Ze());(r=i||(i={})).deserializeV1KernelWebsocketJupyterOrg=function(e){let t,n=new DataView(e),s=Number(n.getBigUint64(0,!0)),i=[];for(let e=0;e<s;e++)i.push(Number(n.getBigUint64(8*(e+1),!0)));let r=new TextDecoder("utf8"),o=r.decode(e.slice(i[0],i[1])),a=JSON.parse(r.decode(e.slice(i[1],i[2]))),l=JSON.parse(r.decode(e.slice(i[2],i[3]))),h=JSON.parse(r.decode(e.slice(i[3],i[4]))),u=JSON.parse(r.decode(e.slice(i[4],i[5]))),d=[];for(let t=5;t<i.length-1;t++)d.push(new DataView(e.slice(i[t],i[t+1])));return t={channel:o,header:a,parent_header:l,metadata:h,content:u,buffers:d},t},r.serializeV1KernelWebsocketJupyterOrg=function(e){let t=JSON.stringify(e.header),n=null==e.parent_header?"{}":JSON.stringify(e.parent_header),s=JSON.stringify(e.metadata),i=JSON.stringify(e.content),r=void 0!==e.buffers?e.buffers:[],o=5+r.length+1,a=[];a.push(8*(1+o)),a.push(e.channel.length+a[a.length-1]);let l=new TextEncoder,h=l.encode(e.channel),u=l.encode(t),d=l.encode(n),c=l.encode(s),p=l.encode(i),_=new Uint8Array(h.length+u.length+d.length+c.length+p.length);_.set(h),_.set(u,h.length),_.set(d,h.length+u.length),_.set(c,h.length+u.length+d.length),_.set(p,h.length+u.length+d.length+c.length);for(let e of[u.length,d.length,c.length,p.length])a.push(e+a[a.length-1]);let f=0;for(let e of r){let t=e.byteLength;a.push(t+a[a.length-1]),f+=t}let m=new Uint8Array(8*(1+o)+_.byteLength+f),g=new ArrayBuffer(8),v=new DataView(g);v.setBigUint64(0,BigInt(o),!0),m.set(new Uint8Array(g),0);for(let e=0;e<a.length;e++)v.setBigUint64(0,BigInt(a[e]),!0),m.set(new Uint8Array(g),8*(e+1));m.set(_,a[0]);for(let e=0;e<r.length;e++){let t=r[e];m.set(new Uint8Array(ArrayBuffer.isView(t)?t.buffer:t),a[5+e])}return m.buffer},r.deserializeDefault=function(e){let t;return t="string"==typeof e?JSON.parse(e):function(e){let t=new DataView(e),n=t.getUint32(0),s=[];if(n<2)throw new Error("Invalid incoming Kernel Message");for(let e=1;e<=n;e++)s.push(t.getUint32(4*e));let i=new Uint8Array(e.slice(s[0],s[1])),r=JSON.parse(new TextDecoder("utf8").decode(i));r.buffers=[];for(let t=1;t<n;t++){let n=s[t],i=s[t+1]||e.byteLength;r.buffers.push(new DataView(e.slice(n,i)))}return r}(e),t},r.serializeDefault=function(e){var t;let n;return n=null!==(t=e.buffers)&&void 0!==t&&t.length?function(e){let t=[],n=[],s=new TextEncoder,i=[];void 0!==e.buffers&&(i=e.buffers,delete e.buffers);let r=s.encode(JSON.stringify(e));n.push(r.buffer);for(let e=0;e<i.length;e++){let t=i[e];n.push(ArrayBuffer.isView(t)?t.buffer:t)}let o=n.length;t.push(4*(o+1));for(let e=0;e+1<n.length;e++)t.push(t[t.length-1]+n[e].byteLength);let a=new Uint8Array(t[t.length-1]+n[n.length-1].byteLength),l=new DataView(a.buffer);l.setUint32(0,o);for(let e=0;e<t.length;e++)l.setUint32(4*(e+1),t[e]);for(let e=0;e<n.length;e++)a.set(new Uint8Array(n[e]),t[e]);return a.buffer}(e):JSON.stringify(e),n}})),Qr=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=WebSocket})),he=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ServerConnection=void 0;var t,n,s,i,r=te(),o=Yr();t="undefined"==typeof window?Qr():WebSocket,function(e){e.makeSettings=function(e){return s.makeSettings(e)},e.makeRequest=function(e,t,n){return s.handleRequest(e,t,n)};class t extends Error{static async create(e){try{let n=await e.json(),{message:s,traceback:i}=n;return i&&console.error(i),new t(e,null!=s?s:t._defaultMessage(e),null!=i?i:"")}catch(n){return console.debug(n),new t(e)}}constructor(e,n=t._defaultMessage(e),s=""){super(n),this.response=e,this.traceback=s}static _defaultMessage(e){return`Invalid response: ${e.status} ${e.statusText}`}}e.ResponseError=t;class n extends TypeError{constructor(e){super(e.message),this.stack=e.stack}}e.NetworkError=n}(n||(e.ServerConnection=n={})),(i=s||(s={})).makeSettings=function(e={}){var n;let s=r.PageConfig.getBaseUrl(),i=r.PageConfig.getWsUrl(),a=r.URLExt.normalize(e.baseUrl)||s,l=e.wsUrl;!l&&a===s&&(l=i),!l&&0===a.indexOf("http")&&(l="ws"+a.slice(4)),l=null!=l?l:i;let h,u=r.PageConfig.getOption("appendToken").toLowerCase();return h=""===u?"undefined"==typeof window||void 0!==process&&void 0!==(null===(n=null==process?void 0:process.env)||void 0===n?void 0:n.JEST_WORKER_ID)||r.URLExt.getHostName(s)!==r.URLExt.getHostName(l):"true"===u,{init:{cache:"no-store",credentials:"same-origin"},fetch,Headers,Request,WebSocket:t,token:r.PageConfig.getToken(),appUrl:r.PageConfig.getOption("appUrl"),appendToken:h,serializer:{serialize:o.serialize,deserialize:o.deserialize},...e,baseUrl:a,wsUrl:l}},i.handleRequest=function(e,t,s){var i;if(0!==e.indexOf(s.baseUrl))throw new Error("Can only be used for notebook server requests");"no-store"===(null!==(i=t.cache)&&void 0!==i?i:s.init.cache)&&(e+=(/\?/.test(e)?"&":"?")+(new Date).getTime());let r=new s.Request(e,{...s.init,...t}),o=!1;if(s.token&&(o=!0,r.headers.append("Authorization",`token ${s.token}`)),"undefined"!=typeof document){let e=function(e){let t="";try{t=document.cookie}catch{return}let n=t.match("\\b_xsrf=([^;]*)\\b");return null==n?void 0:n[1]}();void 0!==e&&(o=!0,r.headers.append("X-XSRFToken",e))}return!r.headers.has("Content-Type")&&o&&r.headers.set("Content-Type","application/json"),s.fetch.call(null,r).catch((e=>{throw new n.NetworkError(e)}))}})),$e=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BaseManager=void 0;var t=ee(),n=he();e.BaseManager=class{constructor(e){var s;this._isDisposed=!1,this._disposed=new t.Signal(this),this.serverSettings=null!==(s=e.serverSettings)&&void 0!==s?s:n.ServerConnection.makeSettings()}get disposed(){return this._disposed}get isDisposed(){return this._isDisposed}get isActive(){return!0}dispose(){this.isDisposed||(this._isDisposed=!0,this._disposed.emit(void 0),t.Signal.clearData(this))}}})),ni=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ConfigWithDefaults=e.ConfigSection=e.ConfigSectionManager=void 0;var t,n=te(),s=Ae();e.ConfigSectionManager=class{constructor(e){var t;this.serverSettings=null!==(t=e.serverSettings)&&void 0!==t?t:s.ServerConnection.makeSettings()}async create(e){let t=new i({...e,serverSettings:this.serverSettings});return await t.load(),t}},function(e){let t;e.create=async function(e){if(!t){let t=new i(e);return await t.load(),t}return await t.create(e)},e._setConfigSectionManager=function(e){if(t)throw new Error("ConfigSectionManager already set. If you would like to create a config section, use the `IConfigSectionManager` token in a plugin.");t=e}}(t||(e.ConfigSection=t={}));var i=class{constructor(e){var t;this.serverSettings=null!==(t=e.serverSettings)&&void 0!==t?t:s.ServerConnection.makeSettings(),this._name=e.name}get data(){return this._data}async load(){let e=await s.ServerConnection.makeRequest(this._url,{},this.serverSettings);if(200!==e.status)throw await s.ServerConnection.ResponseError.create(e);this._data=await e.json()}async update(e){this._data={...this._data,...e};let t={method:"PATCH",body:JSON.stringify(e)},n=await s.ServerConnection.makeRequest(this._url,t,this.serverSettings);if(200!==n.status)throw await s.ServerConnection.ResponseError.create(n);return this._data=await n.json(),this._data}get _url(){return n.URLExt.join(this.serverSettings.baseUrl,"api/config",encodeURIComponent(this._name))}};e.ConfigWithDefaults=class{constructor(e){var t,n;this._className="",this._section=e.section,this._defaults=null!==(t=e.defaults)&&void 0!==t?t:{},this._className=null!==(n=e.className)&&void 0!==n?n:""}get(e){let t=this._classData();return e in t?t[e]:this._defaults[e]}set(e,t){let n={};if(n[e]=t,this._className){let e={};return e[this._className]=n,this._section.update(e)}return this._section.update(n)}_classData(){let e=this._section.data;return this._className&&this._className in e?e[this._className]:e}}})),si=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ConnectionStatus=void 0,e.ConnectionStatus=class{constructor(){this.isConnected=!0}}})),nn=R(((e,t)=>{var n,s;n=e,s=function(e,t){class n{constructor(e){this._fn=e}get isDisposed(){return!this._fn}dispose(){if(!this._fn)return;let e=this._fn;this._fn=null,e()}}class s{constructor(){this._isDisposed=!1,this._items=new Set}get isDisposed(){return this._isDisposed}dispose(){this._isDisposed||(this._isDisposed=!0,this._items.forEach((e=>{e.dispose()})),this._items.clear())}contains(e){return this._items.has(e)}add(e){this._items.add(e)}remove(e){this._items.delete(e)}clear(){this._items.clear()}}var i;(i=s||(s={})).from=function(e){let t=new i;for(let n of e)t.add(n);return t};class r extends s{constructor(){super(...arguments),this._disposed=new t.Signal(this)}get disposed(){return this._disposed}dispose(){this.isDisposed||(super.dispose(),this._disposed.emit(void 0),t.Signal.clearData(this))}}(function(e){e.from=function(t){let n=new e;for(let e of t)n.add(e);return n}})(r||(r={})),e.DisposableDelegate=n,e.DisposableSet=s,e.ObservableDisposableDelegate=class extends n{constructor(){super(...arguments),this._disposed=new t.Signal(this)}get disposed(){return this._disposed}dispose(){this.isDisposed||(super.dispose(),this._disposed.emit(void 0),t.Signal.clearData(this))}},e.ObservableDisposableSet=r},"object"==typeof e&&void 0!==t?s(e,ee()):"function"==typeof define&&__webpack_require__.amdO?define(["exports","@lumino/signaling"],s):s((n="undefined"!=typeof globalThis?globalThis:n||self).lumino_disposable={},n.lumino_signaling)})),lt=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.validateProperty=function(e,t,n,s=[]){if(!e.hasOwnProperty(t))throw Error(`Missing property '${t}'`);let i=e[t];if(void 0!==n){let e=!0;switch(n){case"array":e=Array.isArray(i);break;case"object":e=void 0!==i;break;default:e=typeof i===n}if(!e)throw new Error(`Property '${t}' is not of type '${n}'`);if(s.length>0){let e=!0;switch(n){case"string":case"number":case"boolean":e=s.includes(i);break;default:e=s.findIndex((e=>e===i))>=0}if(!e)throw new Error(`Property '${t}' is not one of the valid values ${JSON.stringify(s)}`)}}}})),ii=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.validateContentsModel=function(e){(0,t.validateProperty)(e,"name","string"),(0,t.validateProperty)(e,"path","string"),(0,t.validateProperty)(e,"type","string"),(0,t.validateProperty)(e,"created","string"),(0,t.validateProperty)(e,"last_modified","string"),(0,t.validateProperty)(e,"mimetype","object"),(0,t.validateProperty)(e,"content","object"),(0,t.validateProperty)(e,"format","object")},e.validateCheckpointModel=function(e){(0,t.validateProperty)(e,"id","string"),(0,t.validateProperty)(e,"last_modified","string")};var t=lt()})),ds=R((e=>{var t=e&&e.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),n=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var s={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&t(s,e,i);return n(s,e),s};Object.defineProperty(e,"__esModule",{value:!0}),e.RestContentProvider=e.ContentProviderRegistry=e.Drive=e.ContentsManager=e.Contents=void 0;var i,r,o=te(),a=nn(),l=ee(),h=Ae(),u=s(ii());(r=i||(e.Contents=i={})).validateContentsModel=function(e){u.validateContentsModel(e)},r.validateCheckpointModel=function(e){u.validateCheckpointModel(e)},e.ContentsManager=class{constructor(e={}){var t,n;this._isDisposed=!1,this._additionalDrives=new Map,this._fileChanged=new l.Signal(this);let s=this.serverSettings=null!==(t=e.serverSettings)&&void 0!==t?t:h.ServerConnection.makeSettings();this._defaultDrive=null!==(n=e.defaultDrive)&&void 0!==n?n:new c({serverSettings:s}),this._defaultDrive.fileChanged.connect(this._onFileChanged,this)}get defaultDrive(){return this._defaultDrive}get fileChanged(){return this._fileChanged}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,l.Signal.clearData(this))}addDrive(e){this._additionalDrives.set(e.name,e),e.fileChanged.connect(this._onFileChanged,this)}getSharedModelFactory(e,t){var n,s;let[i]=this._driveForPath(e),r=null===(n=i.contentProviderRegistry)||void 0===n?void 0:n.getProvider(null==t?void 0:t.contentProviderId);return null!=r&&r.sharedModelFactory?r.sharedModelFactory:null!==(s=i.sharedModelFactory)&&void 0!==s?s:null}localPath(e){let t=e.split("/"),n=t[0].split(":");return 1!==n.length&&this._additionalDrives.has(n[0])?o.PathExt.join(n.slice(1).join(":"),...t.slice(1)):o.PathExt.removeSlash(e)}normalize(e){let t=e.split(":");return 1===t.length?o.PathExt.normalize(e):`${t[0]}:${o.PathExt.normalize(t.slice(1).join(":"))}`}resolvePath(e,t){let n=this.driveName(e),s=this.localPath(e),i=o.PathExt.resolve("/",s,t);return n?`${n}:${i}`:i}driveName(e){let t=e.split("/")[0].split(":");return 1===t.length?"":this._additionalDrives.has(t[0])?t[0]:""}get(e,t){let[n,s]=this._driveForPath(e);return n.get(s,t).then((e=>{let t=[];if("directory"===e.type&&e.content){for(let s of e.content)t.push({...s,path:this._toGlobalPath(n,s.path)});return{...e,path:this._toGlobalPath(n,s),content:t,serverPath:e.path}}return{...e,path:this._toGlobalPath(n,s),serverPath:e.path}}))}getDownloadUrl(e){let[t,n]=this._driveForPath(e);return t.getDownloadUrl(n)}newUntitled(e={}){if(e.path){let t=this.normalize(e.path),[n,s]=this._driveForPath(t);return n.newUntitled({...e,path:s}).then((e=>({...e,path:o.PathExt.join(t,e.name),serverPath:e.path})))}return this._defaultDrive.newUntitled(e)}delete(e){let[t,n]=this._driveForPath(e);return t.delete(n)}rename(e,t){let[n,s]=this._driveForPath(e),[i,r]=this._driveForPath(t);if(n!==i)throw Error("ContentsManager: renaming files must occur within a Drive");return n.rename(s,r).then((e=>({...e,path:this._toGlobalPath(n,r),serverPath:e.path})))}save(e,t={}){let n=this.normalize(e),[s,i]=this._driveForPath(e);return s.save(i,{...t,path:i}).then((e=>({...e,path:n,serverPath:e.path})))}copy(e,t){let[n,s]=this._driveForPath(e),[i,r]=this._driveForPath(t);if(n===i)return n.copy(s,r).then((e=>({...e,path:this._toGlobalPath(n,e.path),serverPath:e.path})));throw Error("Copying files between drives is not currently implemented")}createCheckpoint(e){let[t,n]=this._driveForPath(e);return t.createCheckpoint(n)}listCheckpoints(e){let[t,n]=this._driveForPath(e);return t.listCheckpoints(n)}restoreCheckpoint(e,t){let[n,s]=this._driveForPath(e);return n.restoreCheckpoint(s,t)}deleteCheckpoint(e,t){let[n,s]=this._driveForPath(e);return n.deleteCheckpoint(s,t)}_toGlobalPath(e,t){return e===this._defaultDrive?o.PathExt.removeSlash(t):`${e.name}:${o.PathExt.removeSlash(t)}`}_driveForPath(e){let t=this.driveName(e),n=this.localPath(e);return t?[this._additionalDrives.get(t),n]:[this._defaultDrive,n]}_onFileChanged(e,t){var n,s;if(e===this._defaultDrive)this._fileChanged.emit(t);else{let i=null,r=null;!(null===(n=t.newValue)||void 0===n)&&n.path&&(i={...t.newValue,path:this._toGlobalPath(e,t.newValue.path)}),!(null===(s=t.oldValue)||void 0===s)&&s.path&&(r={...t.oldValue,path:this._toGlobalPath(e,t.oldValue.path)}),this._fileChanged.emit({type:t.type,newValue:i,oldValue:r})}}};var d,c=class{constructor(e={}){var t,n,s,i;this._isDisposed=!1,this._fileChanged=new l.Signal(this),this.name=null!==(t=e.name)&&void 0!==t?t:"Default",this._apiEndpoint=null!==(n=e.apiEndpoint)&&void 0!==n?n:"api/contents",this.serverSettings=null!==(s=e.serverSettings)&&void 0!==s?s:h.ServerConnection.makeSettings();let r=null!==(i=e.defaultContentProvider)&&void 0!==i?i:new _({apiEndpoint:this._apiEndpoint,serverSettings:this.serverSettings});this.contentProviderRegistry=new p({defaultProvider:r}),this.contentProviderRegistry.fileChanged.connect(((e,t)=>{this._fileChanged.emit(t)}))}get fileChanged(){return this._fileChanged}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,l.Signal.clearData(this))}async get(e,t){return this.contentProviderRegistry.getProvider(null==t?void 0:t.contentProviderId).get(e,t)}getDownloadUrl(e){let t=this.serverSettings.baseUrl,n=o.URLExt.join(t,"files",o.URLExt.encodeParts(e)),s="";try{s=document.cookie}catch{}let i=s.match("\\b_xsrf=([^;]*)\\b");if(i){let e=new URL(n);e.searchParams.append("_xsrf",i[1]),n=e.toString()}return Promise.resolve(n)}async newUntitled(e={}){var t;let n="{}";e&&(e.ext&&(e.ext=d.normalizeExtension(e.ext)),n=JSON.stringify(e));let s=this.serverSettings,i=this._getUrl(null!==(t=e.path)&&void 0!==t?t:""),r={method:"POST",body:n},o=await h.ServerConnection.makeRequest(i,r,s);if(201!==o.status)throw await h.ServerConnection.ResponseError.create(o);let a=await o.json();return u.validateContentsModel(a),this._fileChanged.emit({type:"new",oldValue:null,newValue:a}),a}async delete(e){let t=this._getUrl(e),n=this.serverSettings,s=await h.ServerConnection.makeRequest(t,{method:"DELETE"},n);if(204!==s.status)throw await h.ServerConnection.ResponseError.create(s);this._fileChanged.emit({type:"delete",oldValue:{path:e},newValue:null})}async rename(e,t){let n=this.serverSettings,s=this._getUrl(e),i={method:"PATCH",body:JSON.stringify({path:t})},r=await h.ServerConnection.makeRequest(s,i,n);if(200!==r.status)throw await h.ServerConnection.ResponseError.create(r);let o=await r.json();return u.validateContentsModel(o),this._fileChanged.emit({type:"rename",oldValue:{path:e},newValue:o}),o}async save(e,t={}){let n=await this.contentProviderRegistry.getProvider(null==t?void 0:t.contentProviderId).save(e,t);return this._fileChanged.emit({type:"save",oldValue:null,newValue:n}),n}async copy(e,t){let n=this.serverSettings,s=this._getUrl(t),i={method:"POST",body:JSON.stringify({copy_from:e})},r=await h.ServerConnection.makeRequest(s,i,n);if(201!==r.status)throw await h.ServerConnection.ResponseError.create(r);let o=await r.json();return u.validateContentsModel(o),this._fileChanged.emit({type:"new",oldValue:null,newValue:o}),o}async createCheckpoint(e){let t=this._getUrl(e,"checkpoints"),n=await h.ServerConnection.makeRequest(t,{method:"POST"},this.serverSettings);if(201!==n.status)throw await h.ServerConnection.ResponseError.create(n);let s=await n.json();return u.validateCheckpointModel(s),s}async listCheckpoints(e){let t=this._getUrl(e,"checkpoints"),n=await h.ServerConnection.makeRequest(t,{},this.serverSettings);if(200!==n.status)throw await h.ServerConnection.ResponseError.create(n);let s=await n.json();if(!Array.isArray(s))throw new Error("Invalid Checkpoint list");for(let e=0;e<s.length;e++)u.validateCheckpointModel(s[e]);return s}async restoreCheckpoint(e,t){let n=this._getUrl(e,"checkpoints",t),s=await h.ServerConnection.makeRequest(n,{method:"POST"},this.serverSettings);if(204!==s.status)throw await h.ServerConnection.ResponseError.create(s)}async deleteCheckpoint(e,t){let n=this._getUrl(e,"checkpoints",t),s=await h.ServerConnection.makeRequest(n,{method:"DELETE"},this.serverSettings);if(204!==s.status)throw await h.ServerConnection.ResponseError.create(s)}_getUrl(...e){let t=e.map((e=>o.URLExt.encodeParts(e))),n=this.serverSettings.baseUrl;return o.URLExt.join(n,this._apiEndpoint,...t)}};e.Drive=c,function(e){e.normalizeExtension=function(e){return e.length>0&&0!==e.indexOf(".")&&(e=`.${e}`),e}}(d||(d={}));var p=class{constructor(e){this._providers=new Map,this._fileChanged=new l.Signal(this),this.register("default",e.defaultProvider),this._defaultProvider=e.defaultProvider}register(e,t){if(this._providers.has(e))throw Error(`Provider with ${e} identifier was already registered on this drive`);this._providers.set(e,t);let n=(e,t)=>{this._fileChanged.emit(t)};return t.fileChanged&&t.fileChanged.connect(n),new a.DisposableDelegate((()=>{t.fileChanged&&t.fileChanged.disconnect(n),this._providers.has(e)&&this._providers.delete(e)}))}getProvider(e){if(!e)return this._defaultProvider;let t=this._providers.get(e);if(!t)throw Error(`Provider ${e} is not registered`);return t}get fileChanged(){return this._fileChanged}};e.ContentProviderRegistry=p;var _=class{constructor(e){this._options=e}async get(e,t){let n=this._getUrl(e);if(t){"notebook"===t.type&&delete t.format;let e=t.content?"1":"0",s=t.hash?"1":"0",i={...t,content:e,hash:s};n+=o.URLExt.objectToQueryString(i)}let s=this._options.serverSettings,i=await h.ServerConnection.makeRequest(n,{},s);if(200!==i.status)throw await h.ServerConnection.ResponseError.create(i);let r=await i.json();return u.validateContentsModel(r),r}async save(e,t={}){let n=this._options.serverSettings,s=this._getUrl(e),i={method:"PUT",body:new File([JSON.stringify(t)],"data.json",{type:"application/json"})},r=await h.ServerConnection.makeRequest(s,i,n);if(200!==r.status&&201!==r.status)throw await h.ServerConnection.ResponseError.create(r);let o=await r.json();return u.validateContentsModel(o),o}_getUrl(...e){let t=e.map((e=>o.URLExt.encodeParts(e))),n=this._options.serverSettings.baseUrl;return o.URLExt.join(n,this._options.apiEndpoint,...t)}};e.RestContentProvider=_})),He=R(((e,t)=>{var n,s;n=e,s=function(e,t,n){class s{constructor(e){var s;this._disposed=new n.Signal(this),this._lingered=0,this._tick=new t.PromiseDelegate,this._ticked=new n.Signal(this),this._factory=e.factory,this._linger=null!==(s=e.linger)&&void 0!==s?s:r.DEFAULT_LINGER,this._standby=e.standby||r.DEFAULT_STANDBY,this._state={...r.DEFAULT_STATE,timestamp:(new Date).getTime()};let i=e.frequency||{},o=Math.max(i.interval||0,i.max||0,r.DEFAULT_FREQUENCY.max);this.frequency={...r.DEFAULT_FREQUENCY,...i,max:o},this.name=e.name||r.DEFAULT_NAME,(!("auto"in e)||e.auto)&&setTimeout((()=>this.start()))}get disposed(){return this._disposed}get frequency(){return this._frequency}set frequency(e){if(this.isDisposed||t.JSONExt.deepEqual(e,this.frequency||{}))return;let{backoff:n,interval:i,max:r}=e;if(i=Math.round(i),r=Math.round(r),"number"==typeof n&&n<1)throw new Error("Poll backoff growth factor must be at least 1");if((i<0||i>r)&&i!==s.NEVER)throw new Error("Poll interval must be between 0 and max");if(r>s.MAX_INTERVAL&&r!==s.NEVER)throw new Error(`Max interval must be less than ${s.MAX_INTERVAL}`);this._frequency={backoff:n,interval:i,max:r}}get isDisposed(){return"disposed"===this.state.phase}get standby(){return this._standby}set standby(e){this.isDisposed||this.standby===e||(this._standby=e)}get state(){return this._state}get tick(){return this._tick.promise}get ticked(){return this._ticked}async*[Symbol.asyncIterator](){for(;!this.isDisposed;)yield this.state,await this.tick.catch((()=>{}))}dispose(){this.isDisposed||(this._state={...r.DISPOSED_STATE,timestamp:(new Date).getTime()},this._tick.promise.catch((e=>{})),this._tick.reject(new Error(`Poll (${this.name}) is disposed.`)),this._disposed.emit(void 0),n.Signal.clearData(this))}refresh(){return this.schedule({cancel:({phase:e})=>"refreshed"===e,interval:s.IMMEDIATE,phase:"refreshed"})}async schedule(e={}){if(this.isDisposed||e.cancel&&e.cancel(this.state))return;let n=this._tick,i=new t.PromiseDelegate,r={interval:this.frequency.interval,payload:null,phase:"standby",timestamp:(new Date).getTime(),...e};this._state=r,this._tick=i,clearTimeout(this._timeout),this._ticked.emit(this.state),n.resolve(this),await n.promise,r.interval!==s.NEVER?this._timeout=setTimeout((()=>{this.isDisposed||this.tick!==i.promise||this._execute()}),r.interval):this._timeout=void 0}start(){return this.schedule({cancel:({phase:e})=>"constructed"!==e&&"standby"!==e&&"stopped"!==e,interval:s.IMMEDIATE,phase:"started"})}stop(){return this.schedule({cancel:({phase:e})=>"stopped"===e,interval:s.NEVER,phase:"stopped"})}get hidden(){return r.hidden}_execute(){let e="function"==typeof this.standby?this.standby():this.standby;if("never"===e?e=!1:"when-hidden"===e&&(this.hidden?e=++this._lingered>this._linger:(this._lingered=0,e=!1)),e)return void this.schedule();let t=this.tick;this._factory(this.state).then((e=>{this.isDisposed||this.tick!==t||this.schedule({payload:e,phase:"rejected"===this.state.phase?"reconnected":"resolved"})})).catch((e=>{this.isDisposed||this.tick!==t||this.schedule({interval:r.sleep(this.frequency,this.state),payload:e,phase:"rejected"})}))}}var i,r;(i=s||(s={})).IMMEDIATE=0,i.MAX_INTERVAL=2147483647,i.NEVER=1/0,function(e){e.DEFAULT_BACKOFF=3,e.DEFAULT_FREQUENCY={backoff:!0,interval:1e3,max:3e4},e.DEFAULT_LINGER=1,e.DEFAULT_NAME="unknown",e.DEFAULT_STANDBY="when-hidden",e.DEFAULT_STATE={interval:s.NEVER,payload:null,phase:"constructed",timestamp:new Date(0).getTime()},e.DISPOSED_STATE={interval:s.NEVER,payload:null,phase:"disposed",timestamp:new Date(0).getTime()},e.sleep=function(t,n){let{backoff:i,interval:r,max:o}=t;if(r===s.NEVER)return r;let a=!0===i?e.DEFAULT_BACKOFF:!1===i?1:i,l=function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}(r,n.interval*a);return Math.min(o,l)},e.hidden="undefined"!=typeof document&&(document.addEventListener("visibilitychange",(()=>{e.hidden="hidden"===document.visibilityState})),document.addEventListener("pagehide",(()=>{e.hidden="hidden"===document.visibilityState})),"hidden"===document.visibilityState)}(r||(r={}));class o{constructor(e,n=500){this.args=void 0,this.payload=null,this.limit=n,this.poll=new s({auto:!1,factory:async()=>{let{args:t}=this;return this.args=void 0,e(...t)},frequency:{backoff:!1,interval:s.NEVER,max:s.NEVER},standby:"never"}),this.payload=new t.PromiseDelegate,this.poll.ticked.connect(((e,n)=>{let{payload:s}=this;return"resolved"===n.phase?(this.payload=new t.PromiseDelegate,void s.resolve(n.payload)):"rejected"===n.phase||"stopped"===n.phase?(this.payload=new t.PromiseDelegate,s.promise.catch((e=>{})),void s.reject(n.payload)):void 0}),this)}get isDisposed(){return null===this.payload}dispose(){this.isDisposed||(this.args=void 0,this.payload=null,this.poll.dispose())}async stop(){return this.poll.stop()}}e.Debouncer=class extends o{invoke(...e){return this.args=e,this.poll.schedule({interval:this.limit,phase:"invoked"}),this.payload.promise}},e.Poll=s,e.RateLimiter=o,e.Throttler=class extends o{constructor(e,t){super(e,"number"==typeof t?t:t&&t.limit),this._trailing=!1,"number"!=typeof t&&t&&"trailing"===t.edge&&(this._trailing=!0),this._interval=this._trailing?this.limit:s.IMMEDIATE}invoke(...e){let t="invoked"!==this.poll.state.phase;return(t||this._trailing)&&(this.args=e),t&&this.poll.schedule({interval:this._interval,phase:"invoked"}),this.payload.promise}}},"object"==typeof e&&void 0!==t?s(e,Z(),ee()):"function"==typeof define&&__webpack_require__.amdO?define(["exports","@lumino/coreutils","@lumino/signaling"],s):s((n="undefined"!=typeof globalThis?globalThis:n||self).lumino_polling={},n.lumino_coreutils,n.lumino_signaling)})),_s=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.EventManager=void 0;var t=te(),n=He(),s=ee(),i=he(),r="api/events";e.EventManager=class{constructor(e={}){var t,r;this._socket=null,this.serverSettings=null!==(t=e.serverSettings)&&void 0!==t?t:i.ServerConnection.makeSettings(),this._poll=new n.Poll({factory:()=>this._subscribe(),standby:null!==(r=e.standby)&&void 0!==r?r:"when-hidden"}),this._stream=new s.Stream(this),this._poll.start()}get isDisposed(){return this._poll.isDisposed}get stream(){return this._stream}dispose(){if(this.isDisposed)return;this._poll.dispose();let e=this._socket;e&&(this._socket=null,e.onopen=()=>{},e.onerror=()=>{},e.onmessage=()=>{},e.onclose=()=>{},e.close()),s.Signal.clearData(this),this._stream.stop()}async emit(e){let{serverSettings:n}=this,{baseUrl:s}=n,{makeRequest:o,ResponseError:a}=i.ServerConnection,l=t.URLExt.join(s,r),h={body:JSON.stringify(e),method:"POST"},u=await o(l,h,n);if(204!==u.status)throw new a(u)}_subscribe(){return new Promise(((e,n)=>{if(this.isDisposed)return;let{appendToken:s,token:i,WebSocket:o,wsUrl:a}=this.serverSettings,l=t.URLExt.join(a,r,"subscribe");s&&""!==i&&(l+=`?token=${encodeURIComponent(i)}`);let h=this._socket=new o(l),u=this._stream;h.onclose=()=>n(new Error("EventManager socket closed")),h.onmessage=e=>e.data&&u.emit(JSON.parse(e.data))}))}}})),ps=R((e=>{var t=e&&e.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),n=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var s={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&t(s,e,i);return n(s,e),s};Object.defineProperty(e,"__esModule",{value:!0}),e.CommHandler=e.CommsOverSubshells=void 0;var i,r,o=Z(),a=nn(),l=s(Ze());(r=i||(e.CommsOverSubshells=i={})).Disabled="disabled",r.PerComm="perComm",r.PerCommTarget="perCommTarget";var h=class e extends a.DisposableDelegate{constructor(e,t,n,s,r){super(s),this._subshellStarted=new o.PromiseDelegate,this._subshellId=null,this._target="",this._id="",this._id=t,this._target=e,this._kernel=n,this._kernel.statusChanged.connect((()=>{"restarting"===this._kernel.status&&this._cleanSubshells()})),this.commsOverSubshells=null!=r?r:i.PerCommTarget}get commId(){return this._id}get targetName(){return this._target}get subshellId(){return this._subshellId}get subshellStarted(){return this._subshellStarted.promise}get commsOverSubshells(){return this._commsOverSubshells}set commsOverSubshells(e){this._commsOverSubshells=e,this._commsOverSubshells===i.Disabled?this._maybeCloseSubshell():this._maybeStartSubshell()}get onClose(){return this._onClose}set onClose(e){this._onClose=e}get onMsg(){return this._onMsg}set onMsg(e){this._onMsg=e}open(e,t,n=[]){if(this.isDisposed||this._kernel.isDisposed)throw new Error("Cannot open");let s=l.createMessage({msgType:"comm_open",channel:"shell",username:this._kernel.username,session:this._kernel.clientId,subshellId:this._subshellId||this._kernel.subshellId,content:{comm_id:this._id,target_name:this._target,data:null!=e?e:{}},metadata:t,buffers:n});return this._kernel.sendShellMessage(s,!1,!0)}send(e,t,n=[],s=!0){if(this.isDisposed||this._kernel.isDisposed)throw new Error("Cannot send");let i=l.createMessage({msgType:"comm_msg",channel:"shell",username:this._kernel.username,session:this._kernel.clientId,subshellId:this._subshellId||this._kernel.subshellId,content:{comm_id:this._id,data:e},metadata:t,buffers:n});return this._kernel.sendShellMessage(i,!1,s)}close(e,t,n=[]){if(this.isDisposed||this._kernel.isDisposed)throw new Error("Cannot close");let s=l.createMessage({msgType:"comm_close",channel:"shell",username:this._kernel.username,session:this._kernel.clientId,subshellId:this._subshellId||this._kernel.subshellId,content:{comm_id:this._id,data:null!=e?e:{}},metadata:t,buffers:n}),i=this._kernel.sendShellMessage(s,!1,!0),r=this._onClose;return r&&r(l.createMessage({msgType:"comm_close",channel:"iopub",username:this._kernel.username,session:this._kernel.clientId,subshellId:this._subshellId||this._kernel.subshellId,content:{comm_id:this._id,data:null!=e?e:{}},metadata:t,buffers:n})),this.dispose(),i}dispose(){this._maybeCloseSubshell(),super.dispose()}_cleanSubshells(){let t=this._kernel.id;e._commTargetSubShellsId.hasOwnProperty(t)&&delete e._commTargetSubShellsId[t]}async _maybeStartSubshell(){if(await this._kernel.info,!this._kernel.supportsSubshells)return;if(this._commsOverSubshells===i.PerComm){let e=await this._kernel.requestCreateSubshell({}).done;return this._subshellId=e.content.subshell_id,void this._subshellStarted.resolve()}let t=this._kernel.id;e._commTargetSubShellsId.hasOwnProperty(t)||(e._commTargetSubShellsId[t]={});let n=e._commTargetSubShellsId[t];n[this._target]?(this._subshellId=await n[this._target],this._subshellStarted.resolve()):(n[this._target]=this._kernel.requestCreateSubshell({}).done.then((e=>(this._subshellId=e.content.subshell_id,this._subshellId))),await n[this._target],this._subshellStarted.resolve())}_maybeCloseSubshell(){this._commsOverSubshells===i.PerComm?(this._subshellId&&"dead"!==this._kernel.status&&this._kernel.requestDeleteSubshell({subshell_id:this._subshellId},!0),this._subshellId=null):this._subshellId=null}};e.CommHandler=h,h._commTargetSubShellsId={}})),fi=R((e=>{Object.defineProperty(e,"__esModule",{value:!0})})),dn=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.validateMessage=function(e){(0,t.validateProperty)(e,"metadata","object"),(0,t.validateProperty)(e,"content","object"),(0,t.validateProperty)(e,"channel","string"),function(e){for(let s=0;s<n.length;s++)(0,t.validateProperty)(e,n[s],"string")}(e.header),"iopub"===e.channel&&function(e){if("iopub"===e.channel){let n=s[e.header.msg_type];if(void 0===n)return;let i=Object.keys(n),r=e.content;for(let e=0;e<i.length;e++){let s=n[i[e]];Array.isArray(s)||(s=[s]),(0,t.validateProperty)(r,i[e],...s)}}}(e)},e.validateModel=i,e.validateModels=function(e){if(!Array.isArray(e))throw new Error("Invalid kernel list");e.forEach((e=>i(e)))};var t=lt(),n=["username","version","session","msg_id","msg_type"],s={stream:{name:"string",text:"string"},display_data:{data:"object",metadata:"object"},execute_input:{code:"string",execution_count:"number"},execute_result:{execution_count:"number",data:"object",metadata:"object"},error:{ename:"string",evalue:"string",traceback:"object"},status:{execution_state:["string",["starting","idle","busy","restarting","dead"]]},clear_output:{wait:"boolean"},comm_open:{comm_id:"string",target_name:"string",data:"object"},comm_msg:{comm_id:"string",data:"object"},comm_close:{comm_id:"string"},shutdown_reply:{restart:"boolean"}};function i(e){(0,t.validateProperty)(e,"name","string"),(0,t.validateProperty)(e,"id","string")}})),_n=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.KernelAPIClient=e.KERNEL_SERVICE_URL=void 0,e.listRunning=i,e.startNew=r,e.restartKernel=o,e.interruptKernel=a,e.shutdownKernel=l,e.getKernelModel=h;var t=he(),n=te(),s=dn();async function i(i=t.ServerConnection.makeSettings()){let r=n.URLExt.join(i.baseUrl,e.KERNEL_SERVICE_URL),o=await t.ServerConnection.makeRequest(r,{},i);if(200!==o.status)throw await t.ServerConnection.ResponseError.create(o);let a=await o.json();return(0,s.validateModels)(a),a}async function r(i={},r=t.ServerConnection.makeSettings()){let o=n.URLExt.join(r.baseUrl,e.KERNEL_SERVICE_URL),a={method:"POST",body:JSON.stringify(i)},l=await t.ServerConnection.makeRequest(o,a,r);if(201!==l.status)throw await t.ServerConnection.ResponseError.create(l);let h=await l.json();return(0,s.validateModel)(h),h}async function o(i,r=t.ServerConnection.makeSettings()){let o=n.URLExt.join(r.baseUrl,e.KERNEL_SERVICE_URL,encodeURIComponent(i),"restart"),a=await t.ServerConnection.makeRequest(o,{method:"POST"},r);if(200!==a.status)throw await t.ServerConnection.ResponseError.create(a);let l=await a.json();(0,s.validateModel)(l)}async function a(s,i=t.ServerConnection.makeSettings()){let r=n.URLExt.join(i.baseUrl,e.KERNEL_SERVICE_URL,encodeURIComponent(s),"interrupt"),o=await t.ServerConnection.makeRequest(r,{method:"POST"},i);if(204!==o.status)throw await t.ServerConnection.ResponseError.create(o)}async function l(s,i=t.ServerConnection.makeSettings()){let r=n.URLExt.join(i.baseUrl,e.KERNEL_SERVICE_URL,encodeURIComponent(s)),o=await t.ServerConnection.makeRequest(r,{method:"DELETE"},i);if(404===o.status){let e=`The kernel "${s}" does not exist on the server`;console.warn(e)}else if(204!==o.status)throw await t.ServerConnection.ResponseError.create(o)}async function h(i,r=t.ServerConnection.makeSettings()){let o=n.URLExt.join(r.baseUrl,e.KERNEL_SERVICE_URL,encodeURIComponent(i)),a=await t.ServerConnection.makeRequest(o,{},r);if(404===a.status)return;if(200!==a.status)throw await t.ServerConnection.ResponseError.create(a);let l=await a.json();return(0,s.validateModel)(l),l}e.KERNEL_SERVICE_URL="api/kernels",e.KernelAPIClient=class{constructor(e={}){var n;this.serverSettings=null!==(n=e.serverSettings)&&void 0!==n?n:t.ServerConnection.makeSettings()}async listRunning(){return i(this.serverSettings)}async getModel(e){return h(e,this.serverSettings)}async startNew(e={}){return r(e,this.serverSettings)}async restart(e){return o(e,this.serverSettings)}async interrupt(e){return a(e,this.serverSettings)}async shutdown(e){return l(e,this.serverSettings)}}})),Ci=R((e=>{var t=e&&e.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),n=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var s={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&t(s,e,i);return n(s,e),s};Object.defineProperty(e,"__esModule",{value:!0}),e.KernelShellFutureHandler=e.KernelControlFutureHandler=e.KernelFutureHandler=void 0;var i,r=Z(),o=nn(),a=s(Ze()),l=class extends o.DisposableDelegate{constructor(e,t,n,s,o){super(e),this._status=0,this._stdin=i.noOp,this._iopub=i.noOp,this._reply=i.noOp,this._done=new r.PromiseDelegate,this._hooks=new i.HookList,this._disposeOnDone=!0,this._msg=t,n||this._setFlag(i.KernelFutureFlag.GotReply),this._disposeOnDone=s,this._kernel=o}get msg(){return this._msg}get done(){return this._done.promise}get onReply(){return this._reply}set onReply(e){this._reply=e}get onIOPub(){return this._iopub}set onIOPub(e){this._iopub=e}get onStdin(){return this._stdin}set onStdin(e){this._stdin=e}registerMessageHook(e){if(this.isDisposed)throw new Error("Kernel future is disposed");this._hooks.add(e)}removeMessageHook(e){this.isDisposed||this._hooks.remove(e)}sendInputReply(e,t){this._kernel.sendInputReply(e,t)}dispose(){this._stdin=i.noOp,this._iopub=i.noOp,this._reply=i.noOp,this._hooks=null,this._testFlag(i.KernelFutureFlag.IsDone)||(this._done.promise.catch((()=>{})),this._done.reject(new Error(`Canceled future for ${this.msg.header.msg_type} message before replies were done`))),super.dispose()}async handleMsg(e){switch(e.channel){case"control":case"shell":e.channel===this.msg.channel&&e.parent_header.msg_id===this.msg.header.msg_id&&await this._handleReply(e);break;case"stdin":await this._handleStdin(e);break;case"iopub":await this._handleIOPub(e)}}async _handleReply(e){let t=this._reply;t&&await t(e),this._replyMsg=e,this._setFlag(i.KernelFutureFlag.GotReply),this._testFlag(i.KernelFutureFlag.GotIdle)&&this._handleDone()}async _handleStdin(e){this._kernel.hasPendingInput=!0;let t=this._stdin;t&&await t(e)}async _handleIOPub(e){let t=await this._hooks.process(e),n=this._iopub;t&&n&&await n(e),a.isStatusMsg(e)&&"idle"===e.content.execution_state&&(this._setFlag(i.KernelFutureFlag.GotIdle),this._testFlag(i.KernelFutureFlag.GotReply)&&this._handleDone())}_handleDone(){this._testFlag(i.KernelFutureFlag.IsDone)||(this._setFlag(i.KernelFutureFlag.IsDone),this._done.resolve(this._replyMsg),this._disposeOnDone&&this.dispose())}_testFlag(e){return 0!=(this._status&e)}_setFlag(e){this._status|=e}};e.KernelFutureHandler=l,e.KernelControlFutureHandler=class extends l{},e.KernelShellFutureHandler=class extends l{},function(e){e.noOp=()=>{};let t,n="function"==typeof requestAnimationFrame?requestAnimationFrame:setImmediate;var s;e.HookList=class{constructor(){this._hooks=[]}add(e){this.remove(e),this._hooks.push(e)}remove(e){let t=this._hooks.indexOf(e);t>=0&&(this._hooks[t]=null,this._scheduleCompact())}async process(e){await this._processing;let t,n=new r.PromiseDelegate;this._processing=n.promise;for(let s=this._hooks.length-1;s>=0;s--){let i=this._hooks[s];if(null!==i){try{t=await i(e)}catch(e){t=!0,console.error(e)}if(!1===t)return n.resolve(void 0),!1}}return n.resolve(void 0),!0}_scheduleCompact(){this._compactScheduled||(this._compactScheduled=!0,n((()=>{this._processing=this._processing.then((()=>{this._compactScheduled=!1,this._compact()}))})))}_compact(){let e=0;for(let t=0,n=this._hooks.length;t<n;t++){let n=this._hooks[t];null===this._hooks[t]?e++:this._hooks[t-e]=n}this._hooks.length-=e}},(s=t=e.KernelFutureFlag||(e.KernelFutureFlag={}))[s.GotReply=1]="GotReply",s[s.GotIdle=2]="GotIdle",s[s.IsDone=4]="IsDone",s[s.DisposeOnDone=8]="DisposeOnDone"}(i||(i={}))})),Mi=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.validateSpecModel=n,e.validateSpecModels=function(e){if(!e.hasOwnProperty("kernelspecs"))throw new Error("No kernelspecs found");let t=Object.keys(e.kernelspecs),s=Object.create(null),i=e.default;for(let i=0;i<t.length;i++){let r=e.kernelspecs[t[i]];try{s[t[i]]=n(r)}catch{console.warn(`Removing errant kernel spec: ${t[i]}`)}}if(t=Object.keys(s),!t.length)throw new Error("No valid kernelspecs found");return(!i||"string"!=typeof i||!(i in s))&&(i=t[0],console.warn(`Default kernel not found, using '${t[0]}'`)),{default:i,kernelspecs:s}};var t=lt();function n(e){let n=e.spec;if(!n)throw new Error("Invalid kernel spec");(0,t.validateProperty)(e,"name","string"),(0,t.validateProperty)(e,"resources","object"),(0,t.validateProperty)(n,"language","string"),(0,t.validateProperty)(n,"display_name","string"),(0,t.validateProperty)(n,"argv","array");let s=null;n.hasOwnProperty("metadata")&&((0,t.validateProperty)(n,"metadata","object"),s=n.metadata);let i=null;return n.hasOwnProperty("env")&&((0,t.validateProperty)(n,"env","object"),i=n.env),{name:e.name,resources:e.resources,language:n.language,display_name:n.display_name,argv:n.argv,metadata:s,env:i}}})),ft=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.KernelSpecAPIClient=void 0,e.getSpecs=r;var t=he(),n=Mi(),s=te(),i="api/kernelspecs";async function r(e=t.ServerConnection.makeSettings()){let r=s.URLExt.join(e.baseUrl,i),o=await t.ServerConnection.makeRequest(r,{},e);if(200!==o.status)throw await t.ServerConnection.ResponseError.create(o);let a=await o.json();return(0,n.validateSpecModels)(a)}e.KernelSpecAPIClient=class{constructor(e={}){var n;this.serverSettings=null!==(n=e.serverSettings)&&void 0!==n?n:t.ServerConnection.makeSettings()}async get(){return r(this.serverSettings)}}})),Ss=R((e=>{var t=e&&e.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),n=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var s={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&t(s,e,i);return n(s,e),s};Object.defineProperty(e,"__esModule",{value:!0}),e.KernelConnection=void 0;var i,r,o=te(),a=Z(),l=ee(),h=Ae(),u=ps(),d=s(Ze()),c=Ci(),p=s(dn()),_=_n(),f=ft(),m=te(),g="_RESTARTING_";e.KernelConnection=class e{constructor(e){var t,n,s,r,u,c,m,g;this._createSocket=(e=!0)=>{this._errorIfDisposed(),this._clearSocket(),this._updateConnectionStatus("connecting");let t=this.serverSettings,n=o.URLExt.join(t.wsUrl,_.KERNEL_SERVICE_URL,encodeURIComponent(this._id)),s=n.replace(/^((?:\w+:)?\/\/)(?:[^@\/]+@)/,"$1");console.debug(`Starting WebSocket: ${s}`);let r=o.URLExt.join(n,"channels?session_id="+encodeURIComponent(this._clientId)),a=t.token;t.appendToken&&""!==a&&(r+=`&token=${encodeURIComponent(a)}`);let l=e?this._supportedProtocols:[];this._ws=new t.WebSocket(r,l),this._ws.binaryType="arraybuffer";let u=!1,d=async e=>{var t,n;if(!this._isDisposed){this._reason="",this._model=void 0;try{let t=await this._kernelAPIClient.getModel(this._id);this._model=t,"dead"===(null==t?void 0:t.execution_state)?this._updateStatus("dead"):this._onWSClose(e)}catch(s){if(s instanceof h.ServerConnection.NetworkError||503===(null===(t=s.response)||void 0===t?void 0:t.status)||424===(null===(n=s.response)||void 0===n?void 0:n.status)){let t=1e3*i.getRandomIntInclusive(10,30);setTimeout(d,t,e)}else this._reason="Kernel died unexpectedly",this._updateStatus("dead")}}},c=async e=>{u||(u=!0,await d(e))};this._ws.onmessage=this._onWSMessage,this._ws.onopen=this._onWSOpen,this._ws.onclose=c,this._ws.onerror=c},this._onWSOpen=e=>{if(""!==this._ws.protocol&&!this._supportedProtocols.includes(this._ws.protocol))throw console.log("Server selected unknown kernel wire protocol:",this._ws.protocol),this._updateStatus("dead"),new Error(`Unknown kernel wire protocol:  ${this._ws.protocol}`);this._selectedProtocol=this._ws.protocol,this._ws.onclose=this._onWSClose,this._ws.onerror=this._onWSClose,this._updateConnectionStatus("connected")},this._onWSMessage=e=>{let t;try{t=this.serverSettings.serializer.deserialize(e.data,this._ws.protocol),p.validateMessage(t)}catch(e){throw e.message=`Kernel message validation error: ${e.message}`,e}this._kernelSession=t.header.session,this._msgChain=this._msgChain.then((()=>this._handleMessage(t))).catch((e=>{e.message.startsWith("Canceled future for ")&&console.error(e)})),this._anyMessage.emit({msg:t,direction:"recv"})},this._onWSClose=e=>{this.isDisposed||this._reconnect()},this._id="",this._name="",this._status="unknown",this._connectionStatus="connecting",this._kernelSession="",this._isDisposed=!1,this._ws=null,this._username="",this._reconnectLimit=7,this._reconnectAttempt=0,this._reconnectTimeout=null,this._supportedProtocols=Object.values(d.supportedKernelWebSocketProtocols),this._selectedProtocol="",this._commsOverSubshells=h.CommsOverSubshells.PerCommTarget,this._futures=new Map,this._comms=new Map,this._targetRegistry=Object.create(null),this._info=new a.PromiseDelegate,this._pendingMessages=[],this._statusChanged=new l.Signal(this),this._connectionStatusChanged=new l.Signal(this),this._disposed=new l.Signal(this),this._iopubMessage=new l.Signal(this),this._anyMessage=new l.Signal(this),this._pendingInput=new l.Signal(this),this._unhandledMessage=new l.Signal(this),this._displayIdToParentIds=new Map,this._msgIdToDisplayIds=new Map,this._msgChain=Promise.resolve(),this._hasPendingInput=!1,this._reason="",this._noOp=()=>{},this._supportsSubshells=!1,this._name=e.model.name,this._id=e.model.id,this.serverSettings=null!==(t=e.serverSettings)&&void 0!==t?t:h.ServerConnection.makeSettings(),this._kernelAPIClient=null!==(n=e.kernelAPIClient)&&void 0!==n?n:new _.KernelAPIClient({serverSettings:this.serverSettings}),this._kernelSpecAPIClient=null!==(s=e.kernelSpecAPIClient)&&void 0!==s?s:new f.KernelSpecAPIClient({serverSettings:this.serverSettings}),this._clientId=null!==(r=e.clientId)&&void 0!==r?r:a.UUID.uuid4(),this._username=null!==(u=e.username)&&void 0!==u?u:"",this.handleComms=null===(c=e.handleComms)||void 0===c||c,this._commsOverSubshells=null!==(m=e.commsOverSubshells)&&void 0!==m?m:h.CommsOverSubshells.PerCommTarget,this._subshellId=null!==(g=e.subshellId)&&void 0!==g?g:null,this._createSocket()}get disposed(){return this._disposed}get commsOverSubshells(){return this._commsOverSubshells}set commsOverSubshells(e){this._commsOverSubshells=e;for(let[t,n]of this._comms)n.commsOverSubshells=e}get statusChanged(){return this._statusChanged}get connectionStatusChanged(){return this._connectionStatusChanged}get iopubMessage(){return this._iopubMessage}get unhandledMessage(){return this._unhandledMessage}get model(){return this._model||{id:this.id,name:this.name,reason:this._reason}}get anyMessage(){return this._anyMessage}get pendingInput(){return this._pendingInput}get id(){return this._id}get name(){return this._name}get username(){return this._username}get clientId(){return this._clientId}get subshellId(){return this._subshellId}set subshellId(e){this._subshellId=e}get status(){return this._status}get connectionStatus(){return this._connectionStatus}get isDisposed(){return this._isDisposed}get info(){return this._info.promise}get spec(){return this._specPromise||(this._specPromise=this._kernelSpecAPIClient.get().then((e=>e.kernelspecs[this._name]))),this._specPromise}get supportsSubshells(){return this._supportsSubshells}clone(t={}){return new e({model:this.model,username:this.username,serverSettings:this.serverSettings,handleComms:!1,kernelAPIClient:this._kernelAPIClient,commsOverSubshells:h.CommsOverSubshells.Disabled,...t})}dispose(){if(this.isDisposed)return;let e=()=>{this._isDisposed=!0,this._disposed.emit(),this._updateConnectionStatus("disconnected"),this._clearKernelState(),this._pendingMessages=[],this._clearSocket(),l.Signal.clearData(this)};null!==this._subshellId?this.requestDeleteSubshell({subshell_id:this._subshellId},!0).onReply=t=>{e()}:e()}sendShellMessage(e,t=!1,n=!0){return this._sendKernelShellControl(c.KernelShellFutureHandler,e,t,n)}sendControlMessage(e,t=!1,n=!0){return this._sendKernelShellControl(c.KernelControlFutureHandler,e,t,n)}_sendKernelShellControl(e,t,n=!1,s=!0){this._sendMessage(t),this._anyMessage.emit({msg:t,direction:"send"});let i=new e((()=>{let e=t.header.msg_id;this._futures.delete(e);let n=this._msgIdToDisplayIds.get(e);n&&(n.forEach((t=>{let n=this._displayIdToParentIds.get(t);if(n){let s=n.indexOf(e);if(-1===s)return;1===n.length?this._displayIdToParentIds.delete(t):(n.splice(s,1),this._displayIdToParentIds.set(t,n))}})),this._msgIdToDisplayIds.delete(e))}),t,n,s,this);return this._futures.set(t.header.msg_id,i),i}_sendMessage(e,t=!0){if("dead"===this.status)throw new Error("Kernel is dead");if((""===this._kernelSession||this._kernelSession===g)&&d.isInfoRequestMsg(e)){if("connected"===this.connectionStatus)return void this._ws.send(this.serverSettings.serializer.serialize(e,this._ws.protocol));throw new Error("Could not send message: status is not connected")}if(t&&this._pendingMessages.length>0)this._pendingMessages.push(e);else if("connected"===this.connectionStatus&&this._kernelSession!==g)this._ws.send(this.serverSettings.serializer.serialize(e,this._ws.protocol));else{if(!t)throw new Error("Could not send message");this._pendingMessages.push(e)}}async interrupt(){if(this.hasPendingInput=!1,"dead"===this.status)throw new Error("Kernel is dead");return this._kernelAPIClient.interrupt(this.id)}async restart(){if("dead"===this.status)throw new Error("Kernel is dead");this._updateStatus("restarting"),this._clearKernelState(),this._kernelSession=g,await this._kernelAPIClient.restart(this.id),await this.reconnect(),this.hasPendingInput=!1}reconnect(){this._errorIfDisposed();let e=new a.PromiseDelegate,t=(n,s)=>{"connected"===s?(e.resolve(),this.connectionStatusChanged.disconnect(t,this)):"disconnected"===s&&(e.reject(new Error("Kernel connection disconnected")),this.connectionStatusChanged.disconnect(t,this))};return this.connectionStatusChanged.connect(t,this),this._reconnectAttempt=0,this._reconnect(),e.promise}async shutdown(){"dead"!==this.status&&await this._kernelAPIClient.shutdown(this.id),this.handleShutdown()}handleShutdown(){this._updateStatus("dead"),this.dispose()}async requestKernelInfo(){let e,t=d.createMessage({msgType:"kernel_info_request",channel:"shell",username:this._username,session:this._clientId,subshellId:this._subshellId,content:{}});try{e=await i.handleShellMessage(this,t)}catch(e){if(this.isDisposed)return;throw e}if(this._errorIfDisposed(),!e)return;if(void 0===e.content.status&&(e.content.status="ok"),"ok"!==e.content.status)return this._info.reject("Kernel info reply errored"),e;this._info.resolve(e.content),this._kernelSession=e.header.session;let n=e.content.supported_features;return this._supportsSubshells=void 0!==n&&n.includes("kernel subshells"),e}requestComplete(e){let t=d.createMessage({msgType:"complete_request",channel:"shell",username:this._username,session:this._clientId,subshellId:this._subshellId,content:e});return i.handleShellMessage(this,t)}requestInspect(e){let t=d.createMessage({msgType:"inspect_request",channel:"shell",username:this._username,session:this._clientId,subshellId:this._subshellId,content:e});return i.handleShellMessage(this,t)}requestHistory(e){let t=d.createMessage({msgType:"history_request",channel:"shell",username:this._username,session:this._clientId,subshellId:this._subshellId,content:e});return i.handleShellMessage(this,t)}requestExecute(e,t=!0,n){let s=d.createMessage({msgType:"execute_request",channel:"shell",username:this._username,session:this._clientId,subshellId:this._subshellId,content:{silent:!1,store_history:!0,user_expressions:{},allow_stdin:!0,stop_on_error:!1,...e},metadata:n});return this.sendShellMessage(s,!0,t)}requestDebug(e,t=!0){let n=d.createMessage({msgType:"debug_request",channel:"control",username:this._username,session:this._clientId,content:e});return this.sendControlMessage(n,!0,t)}requestCreateSubshell(e,t=!0){if(!this.supportsSubshells)throw new Error("Kernel subshells are not supported");let n=d.createMessage({msgType:"create_subshell_request",channel:"control",username:this._username,session:this._clientId,content:e});return this.sendControlMessage(n,!0,t)}requestDeleteSubshell(e,t=!0){if(!this.supportsSubshells)throw new Error("Kernel subshells are not supported");let n=d.createMessage({msgType:"delete_subshell_request",channel:"control",username:this._username,session:this._clientId,content:e});return this.sendControlMessage(n,!0,t)}requestListSubshell(e,t=!0){if(!this.supportsSubshells)throw new Error("Kernel subshells are not supported");let n=d.createMessage({msgType:"list_subshell_request",channel:"control",username:this._username,session:this._clientId,content:e});return this.sendControlMessage(n,!0,t)}requestIsComplete(e){let t=d.createMessage({msgType:"is_complete_request",channel:"shell",username:this._username,session:this._clientId,subshellId:this._subshellId,content:e});return i.handleShellMessage(this,t)}requestCommInfo(e){let t=d.createMessage({msgType:"comm_info_request",channel:"shell",username:this._username,session:this._clientId,subshellId:this._subshellId,content:e});return i.handleShellMessage(this,t)}sendInputReply(e,t){let n=d.createMessage({msgType:"input_reply",channel:"stdin",username:this._username,session:this._clientId,content:e});n.parent_header=t,this._sendMessage(n),this._anyMessage.emit({msg:n,direction:"send"}),this.hasPendingInput=!1}createComm(e,t=a.UUID.uuid4()){if(!this.handleComms)throw new Error("Comms are disabled on this kernel connection");if(this._comms.has(t))throw new Error("Comm is already created");let n=new u.CommHandler(e,t,this,(()=>{this._unregisterComm(t)}),this._commsOverSubshells);return this._comms.set(t,n),n}hasComm(e){return this._comms.has(e)}registerCommTarget(e,t){this.handleComms&&(this._targetRegistry[e]=t)}removeCommTarget(e,t){this.handleComms&&!this.isDisposed&&this._targetRegistry[e]===t&&delete this._targetRegistry[e]}registerMessageHook(e,t){var n;let s=null===(n=this._futures)||void 0===n?void 0:n.get(e);s&&s.registerMessageHook(t)}removeMessageHook(e,t){var n;let s=null===(n=this._futures)||void 0===n?void 0:n.get(e);s&&s.removeMessageHook(t)}removeInputGuard(){this.hasPendingInput=!1}async _handleDisplayId(e,t){var n,s;let i=t.parent_header.msg_id,r=this._displayIdToParentIds.get(e);if(r){let e={header:a.JSONExt.deepCopy(t.header),parent_header:a.JSONExt.deepCopy(t.parent_header),metadata:a.JSONExt.deepCopy(t.metadata),content:a.JSONExt.deepCopy(t.content),channel:t.channel,buffers:t.buffers?t.buffers.slice():[]};e.header.msg_type="update_display_data",await Promise.all(r.map((async t=>{let n=this._futures&&this._futures.get(t);n&&await n.handleMsg(e)})))}if("update_display_data"===t.header.msg_type)return!0;r=null!==(n=this._displayIdToParentIds.get(e))&&void 0!==n?n:[],-1===r.indexOf(i)&&r.push(i),this._displayIdToParentIds.set(e,r);let o=null!==(s=this._msgIdToDisplayIds.get(i))&&void 0!==s?s:[];return-1===o.indexOf(i)&&o.push(i),this._msgIdToDisplayIds.set(i,o),!1}_clearSocket(){null!==this._ws&&(this._ws.onopen=this._noOp,this._ws.onclose=this._noOp,this._ws.onerror=this._noOp,this._ws.onmessage=this._noOp,this._ws.close(),this._ws=null)}_updateStatus(e){this._status===e||"dead"===this._status||(this._status=e,i.logKernelStatus(this),this._statusChanged.emit(e),"dead"===e&&this.dispose())}_sendPending(){for(;"connected"===this.connectionStatus&&this._kernelSession!==g&&this._pendingMessages.length>0;)this._sendMessage(this._pendingMessages[0],!1),this._pendingMessages.shift()}_clearKernelState(){this._kernelSession="",this._pendingMessages=[],this._futures.forEach((e=>{e.dispose()})),this._comms.forEach((e=>{e.dispose()})),this._msgChain=Promise.resolve(),this._futures=new Map,this._comms=new Map,this._displayIdToParentIds.clear(),this._msgIdToDisplayIds.clear()}_assertCurrentMessage(e){if(this._errorIfDisposed(),e.header.session!==this._kernelSession)throw new Error(`Canceling handling of old message: ${e.header.msg_type}`)}async _handleCommOpen(e){this._assertCurrentMessage(e);let t=e.content,n=new u.CommHandler(t.target_name,t.comm_id,this,(()=>{this._unregisterComm(t.comm_id)}),this.commsOverSubshells);this._comms.set(t.comm_id,n);try{await(await i.loadObject(t.target_name,t.target_module,this._targetRegistry))(n,e)}catch(e){throw n.close(),console.error("Exception opening new comm"),e}}async _handleCommClose(e){this._assertCurrentMessage(e);let t=e.content,n=this._comms.get(t.comm_id);if(!n)return void console.error("Comm not found for comm id "+t.comm_id);this._unregisterComm(n.commId);let s=n.onClose;s&&await s(e),n.dispose()}async _handleCommMsg(e){this._assertCurrentMessage(e);let t=e.content,n=this._comms.get(t.comm_id);if(!n)return;let s=n.onMsg;s&&await s(e)}_unregisterComm(e){this._comms.delete(e)}_updateConnectionStatus(e){if(this._connectionStatus!==e){if(this._connectionStatus=e,"connecting"!==e&&(this._reconnectAttempt=0,clearTimeout(this._reconnectTimeout)),"dead"!==this.status)if("connected"===e){let e=this._kernelSession===g,t=this.requestKernelInfo(),n=!1,s=()=>{n||(n=!0,e&&this._kernelSession===g&&(this._kernelSession=""),clearTimeout(i),this._pendingMessages.length>0&&this._sendPending())};t.then(s);let i=setTimeout(s,3e3)}else this._updateStatus("unknown");this._connectionStatusChanged.emit(e)}}async _handleMessage(e){var t,n;let s=!1;if(e.parent_header&&"iopub"===e.channel&&(d.isDisplayDataMsg(e)||d.isUpdateDisplayDataMsg(e)||d.isExecuteResultMsg(e))){let n=(null!==(t=e.content.transient)&&void 0!==t?t:{}).display_id;n&&(s=await this._handleDisplayId(n,e),this._assertCurrentMessage(e))}if(!s&&e.parent_header){let t=e.parent_header,s=null===(n=this._futures)||void 0===n?void 0:n.get(t.msg_id);if(s)await s.handleMsg(e),this._assertCurrentMessage(e);else{let n=t.session===this.clientId;"iopub"!==e.channel&&n&&this._unhandledMessage.emit(e)}}if("iopub"===e.channel){switch(e.header.msg_type){case"status":{let t=m.PageConfig.getOption("untracked_message_types");if(JSON.parse(t||"[]").includes(e.parent_header.msg_type))break;let n=e.content.execution_state;"restarting"===n&&Promise.resolve().then((async()=>{this._updateStatus("autorestarting"),this._clearKernelState(),await this.reconnect()})),this._updateStatus(n);break}case"comm_open":this.handleComms&&await this._handleCommOpen(e);break;case"comm_msg":this.handleComms&&await this._handleCommMsg(e);break;case"comm_close":this.handleComms&&await this._handleCommClose(e)}this.isDisposed||(this._assertCurrentMessage(e),this._iopubMessage.emit(e))}}_reconnect(){if(this._errorIfDisposed(),clearTimeout(this._reconnectTimeout),this._reconnectAttempt<this._reconnectLimit){this._updateConnectionStatus("connecting");let e=i.getRandomIntInclusive(0,1e3*(Math.pow(2,this._reconnectAttempt)-1));console.warn(`Connection lost, reconnecting in ${Math.floor(e/1e3)} seconds.`);let t=""!==this._selectedProtocol;this._reconnectTimeout=setTimeout(this._createSocket,e,t),this._reconnectAttempt+=1}else this._updateConnectionStatus("disconnected");this._clearSocket()}_errorIfDisposed(){if(this.isDisposed)throw new Error("Kernel connection is disposed")}get hasPendingInput(){return this._hasPendingInput}set hasPendingInput(e){this._hasPendingInput=e,this._pendingInput.emit(e)}},(r=i||(i={})).logKernelStatus=function(e){switch(e.status){case"idle":case"busy":case"unknown":return;default:console.debug(`Kernel: ${e.status} (${e.id})`)}},r.handleShellMessage=async function(e,t){return e.sendShellMessage(t,!0).done},r.loadObject=function(e,t,n){return new Promise(((s,i)=>{if(t){if("undefined"==typeof requirejs)throw new Error("requirejs not found");requirejs([t],(n=>{void 0===n[e]?i(new Error(`Object '${e}' not found in module '${t}'`)):s(n[e])}),i)}else null!=n&&n[e]?s(n[e]):i(new Error(`Object '${e}' not found in registry`))}))},r.getRandomIntInclusive=function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}})),Ti=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.KernelManager=void 0;var t,n=He(),s=ee(),i=Ae(),r=$e(),o=_n(),a=Ss(),l=ft(),h=class extends r.BaseManager{constructor(e={}){var t,r,a;super(e),this._commsOverSubshells=i.CommsOverSubshells.PerCommTarget,this._isReady=!1,this._kernelConnections=new Set,this._models=new Map,this._runningChanged=new s.Signal(this),this._connectionFailure=new s.Signal(this),this._kernelAPIClient=null!==(t=e.kernelAPIClient)&&void 0!==t?t:new o.KernelAPIClient({serverSettings:this.serverSettings}),this._kernelSpecAPIClient=null!==(r=e.kernelSpecAPIClient)&&void 0!==r?r:new l.KernelSpecAPIClient({serverSettings:this.serverSettings}),this._pollModels=new n.Poll({auto:!1,factory:()=>this.requestRunning(),frequency:{interval:1e4,backoff:!0,max:3e5},name:"@jupyterlab/services:KernelManager#models",standby:null!==(a=e.standby)&&void 0!==a?a:"when-hidden"}),this._ready=(async()=>{await this._pollModels.start(),await this._pollModels.tick,this._isReady=!0})()}get isReady(){return this._isReady}get ready(){return this._ready}get runningChanged(){return this._runningChanged}get connectionFailure(){return this._connectionFailure}dispose(){this.isDisposed||(this._models.clear(),this._kernelConnections.forEach((e=>e.dispose())),this._pollModels.dispose(),super.dispose())}connectTo(e){var t;let{id:n}=e.model,s=null===(t=e.handleComms)||void 0===t||t;if(void 0===e.handleComms)for(let e of this._kernelConnections)if(e.id===n&&e.handleComms){s=!1;break}e.commsOverSubshells=this._commsOverSubshells;let i=new a.KernelConnection({handleComms:s,...e,serverSettings:this.serverSettings,kernelAPIClient:this._kernelAPIClient,kernelSpecAPIClient:this._kernelSpecAPIClient});return this._onStarted(i),this._models.has(n)||this.refreshRunning().catch((()=>{})),i}running(){return this._models.values()}get runningCount(){return this._models.size}get commsOverSubshells(){return this._commsOverSubshells}set commsOverSubshells(e){this._commsOverSubshells=e;for(let t of this._kernelConnections)t.commsOverSubshells=e}async refreshRunning(){await this._pollModels.refresh(),await this._pollModels.tick}async startNew(e={},t={}){let n=await this._kernelAPIClient.startNew(e);return this.connectTo({...t,model:n})}async shutdown(e){await this._kernelAPIClient.shutdown(e),await this.refreshRunning()}async shutdownAll(){await this.refreshRunning(),await Promise.all([...this._models.keys()].map((e=>this._kernelAPIClient.shutdown(e)))),await this.refreshRunning()}async findById(e){return this._models.has(e)||await this.refreshRunning(),this._models.get(e)}async requestRunning(){var e,t;let n;try{n=await this._kernelAPIClient.listRunning()}catch(n){throw(n instanceof i.ServerConnection.NetworkError||503===(null===(e=n.response)||void 0===e?void 0:e.status)||424===(null===(t=n.response)||void 0===t?void 0:t.status))&&this._connectionFailure.emit(n),n}this.isDisposed||this._models.size===n.length&&n.every((e=>{let t=this._models.get(e.id);return!!t&&t.connections===e.connections&&t.execution_state===e.execution_state&&t.last_activity===e.last_activity&&t.name===e.name&&t.reason===e.reason&&t.traceback===e.traceback}))||(this._models=new Map(n.map((e=>[e.id,e]))),this._kernelConnections.forEach((e=>{this._models.has(e.id)||e.handleShutdown()})),this._runningChanged.emit(n))}_onStarted(e){this._kernelConnections.add(e),e.statusChanged.connect(this._onStatusChanged,this),e.disposed.connect(this._onDisposed,this)}_onDisposed(e){this._kernelConnections.delete(e),this.refreshRunning().catch((()=>{}))}_onStatusChanged(e,t){"dead"===t&&this.refreshRunning().catch((()=>{}))}};e.KernelManager=h,(t=h||(e.KernelManager=h={})).NoopManager=class extends t{constructor(){super(...arguments),this._readyPromise=new Promise((()=>{}))}get isActive(){return!1}get parentReady(){return super.ready}async startNew(e={},t={}){return Promise.reject(new Error("Not implemented in no-op Kernel Manager"))}connectTo(e){throw new Error("Not implemented in no-op Kernel Manager")}async shutdown(e){return Promise.reject(new Error("Not implemented in no-op Kernel Manager"))}get ready(){return this.parentReady.then((()=>this._readyPromise))}async requestRunning(){return Promise.resolve()}}})),Cs=R((e=>{var t=e&&e.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),n=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var s={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&t(s,e,i);return n(s,e),s},i=e&&e.__exportStar||function(e,n){for(var s in e)"default"!==s&&!Object.prototype.hasOwnProperty.call(n,s)&&t(n,e,s)};Object.defineProperty(e,"__esModule",{value:!0}),e.CommsOverSubshells=e.KernelConnection=e.KernelAPI=e.KernelMessage=e.Kernel=void 0;var r=ps();Object.defineProperty(e,"CommsOverSubshells",{enumerable:!0,get:function(){return r.CommsOverSubshells}});var o=s(fi());e.Kernel=o;var a=s(Ze());e.KernelMessage=a;var l=s(_n());e.KernelAPI=l;var h=Ss();Object.defineProperty(e,"KernelConnection",{enumerable:!0,get:function(){return h.KernelConnection}}),i(Ti(),e)})),Ni=R((e=>{Object.defineProperty(e,"__esModule",{value:!0})})),xi=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.KernelSpecManager=void 0;var t=Z(),n=He(),s=ee(),i=$e(),r=ft(),o=class extends i.BaseManager{constructor(e={}){var t,i;super(e),this._isReady=!1,this._connectionFailure=new s.Signal(this),this._specs=null,this._specsChanged=new s.Signal(this),this._kernelSpecAPIClient=null!==(t=e.kernelSpecAPIClient)&&void 0!==t?t:new r.KernelSpecAPIClient({serverSettings:this.serverSettings}),this._ready=Promise.all([this.requestSpecs()]).then((e=>{})).catch((e=>{})).then((()=>{this.isDisposed||(this._isReady=!0)})),this._pollSpecs=new n.Poll({auto:!1,factory:()=>this.requestSpecs(),frequency:{interval:61e3,backoff:!0,max:3e5},name:"@jupyterlab/services:KernelSpecManager#specs",standby:null!==(i=e.standby)&&void 0!==i?i:"when-hidden"}),this.ready.then((()=>{this._pollSpecs.start()}))}get isReady(){return this._isReady}get ready(){return this._ready}get specs(){return this._specs}get specsChanged(){return this._specsChanged}get connectionFailure(){return this._connectionFailure}dispose(){this._pollSpecs.dispose(),super.dispose()}async refreshSpecs(){await this._pollSpecs.refresh(),await this._pollSpecs.tick}async requestSpecs(){let e=await this._kernelSpecAPIClient.get();this.isDisposed||t.JSONExt.deepEqual(e,this._specs)||(this._specs=e,this._specsChanged.emit(e))}};e.KernelSpecManager=o})),Ms=R((e=>{var t=e&&e.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),n=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var s={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&t(s,e,i);return n(s,e),s},i=e&&e.__exportStar||function(e,n){for(var s in e)"default"!==s&&!Object.prototype.hasOwnProperty.call(n,s)&&t(n,e,s)};Object.defineProperty(e,"__esModule",{value:!0}),e.KernelSpecAPI=e.KernelSpec=void 0;var r=s(Ni());e.KernelSpec=r;var o=s(ft());e.KernelSpecAPI=o,i(xi(),e)})),zi=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BuildManager=void 0;var t=te(),n=he();e.BuildManager=class{constructor(e={}){var t;this.serverSettings=null!==(t=e.serverSettings)&&void 0!==t?t:n.ServerConnection.makeSettings()}get isAvailable(){return"true"===t.PageConfig.getOption("buildAvailable").toLowerCase()}get shouldCheck(){return"true"===t.PageConfig.getOption("buildCheck").toLowerCase()}getStatus(){let{_url:e,serverSettings:t}=this;return n.ServerConnection.makeRequest(e,{},t).then((e=>{if(200!==e.status)throw new n.ServerConnection.ResponseError(e);return e.json()})).then((e=>{if("string"!=typeof e.status)throw new Error("Invalid data");if("string"!=typeof e.message)throw new Error("Invalid data");return e}))}build(){let{_url:e,serverSettings:t}=this;return n.ServerConnection.makeRequest(e,{method:"POST"},t).then((e=>{if(400===e.status)throw new n.ServerConnection.ResponseError(e,"Build aborted");if(200!==e.status){let t=`Build failed with ${e.status}.\n\n        If you are experiencing the build failure after installing an extension (or trying to include previously installed extension after updating JupyterLab) please check the extension repository for new installation instructions as many extensions migrated to the prebuilt extensions system which no longer requires rebuilding JupyterLab (but uses a different installation procedure, typically involving a package manager such as 'pip' or 'conda').\n\n        If you specifically intended to install a source extension, please run 'jupyter lab build' on the server for full output.`;throw new n.ServerConnection.ResponseError(e,t)}}))}cancel(){let{_url:e,serverSettings:t}=this;return n.ServerConnection.makeRequest(e,{method:"DELETE"},t).then((e=>{if(204!==e.status)throw new n.ServerConnection.ResponseError(e)}))}get _url(){let{baseUrl:e,appUrl:n}=this.serverSettings;return t.URLExt.join(e,n,"api/build")}}})),Ds=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.NbConvertManager=void 0;var t=te(),n=he(),s=Z();e.NbConvertManager=class{constructor(e={}){var t;this._exportFormats=null,this.serverSettings=null!==(t=e.serverSettings)&&void 0!==t?t:n.ServerConnection.makeSettings()}async fetchExportFormats(){this._requestingFormats=new s.PromiseDelegate,this._exportFormats=null;let e=this.serverSettings.baseUrl,i=t.URLExt.join(e,"api/nbconvert"),{serverSettings:r}=this,o=await n.ServerConnection.makeRequest(i,{},r);if(200!==o.status)throw await n.ServerConnection.ResponseError.create(o);let a=await o.json(),l={};return Object.keys(a).forEach((function(e){let t=a[e].output_mimetype;l[e]={output_mimetype:t}})),this._exportFormats=l,this._requestingFormats.resolve(l),l}async getExportFormats(e=!0){return this._requestingFormats?this._requestingFormats.promise:e||!this._exportFormats?await this.fetchExportFormats():this._exportFormats}async exportAs(e){let{format:n,path:s}=e,{download:i=!1}=e.exporterOptions||{},r=this.serverSettings.baseUrl,o=t.URLExt.encodeParts(s),a=t.URLExt.join(r,"nbconvert",n,o);i&&(a+="?download=true"),null==window||window.open(a,"_blank","noopener")}}})),Bi=R((e=>{Object.defineProperty(e,"__esModule",{value:!0})})),$i=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.validateModel=s,e.updateLegacySessionModel=function(e){void 0===e.path&&void 0!==e.notebook&&(e.path=e.notebook.path,e.type="notebook",e.name="")},e.validateModels=function(e){if(!Array.isArray(e))throw new Error("Invalid session list");e.forEach((e=>s(e)))};var t=dn(),n=lt();function s(e){(0,n.validateProperty)(e,"id","string"),(0,n.validateProperty)(e,"type","string"),(0,n.validateProperty)(e,"name","string"),(0,n.validateProperty)(e,"path","string"),(0,n.validateProperty)(e,"kernel","object"),(0,t.validateModel)(e.kernel)}})),bn=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SessionAPIClient=e.SESSION_SERVICE_URL=void 0,e.listRunning=i,e.getSessionUrl=r,e.shutdownSession=o,e.getSessionModel=a,e.startSession=l,e.updateSession=h;var t=he(),n=te(),s=$i();async function i(i=t.ServerConnection.makeSettings()){let r=n.URLExt.join(i.baseUrl,e.SESSION_SERVICE_URL),o=await t.ServerConnection.makeRequest(r,{},i);if(200!==o.status)throw await t.ServerConnection.ResponseError.create(o);let a=await o.json();if(!Array.isArray(a))throw new Error("Invalid Session list");return a.forEach((e=>{(0,s.updateLegacySessionModel)(e),(0,s.validateModel)(e)})),a}function r(t,s){let i=n.URLExt.join(t,e.SESSION_SERVICE_URL),r=n.URLExt.join(i,s);if(!r.startsWith(i))throw new Error("Can only be used for services requests");return r}async function o(e,n=t.ServerConnection.makeSettings()){var s;let i=r(n.baseUrl,e),o=await t.ServerConnection.makeRequest(i,{method:"DELETE"},n);if(404===o.status){let t=null!==(s=(await o.json()).message)&&void 0!==s?s:`The session "${e}"" does not exist on the server`;console.warn(t)}else{if(410===o.status)throw new t.ServerConnection.ResponseError(o,"The kernel was deleted but the session was not");if(204!==o.status)throw await t.ServerConnection.ResponseError.create(o)}}async function a(e,n=t.ServerConnection.makeSettings()){let i=r(n.baseUrl,e),o=await t.ServerConnection.makeRequest(i,{},n);if(200!==o.status)throw await t.ServerConnection.ResponseError.create(o);let a=await o.json();return(0,s.updateLegacySessionModel)(a),(0,s.validateModel)(a),a}async function l(i,r=t.ServerConnection.makeSettings()){let o=n.URLExt.join(r.baseUrl,e.SESSION_SERVICE_URL),a={method:"POST",body:JSON.stringify(i)},l=await t.ServerConnection.makeRequest(o,a,r);if(201!==l.status)throw await t.ServerConnection.ResponseError.create(l);let h=await l.json();return(0,s.updateLegacySessionModel)(h),(0,s.validateModel)(h),h}async function h(e,n=t.ServerConnection.makeSettings()){let i=r(n.baseUrl,e.id),o={method:"PATCH",body:JSON.stringify(e)},a=await t.ServerConnection.makeRequest(i,o,n);if(200!==a.status)throw await t.ServerConnection.ResponseError.create(a);let l=await a.json();return(0,s.updateLegacySessionModel)(l),(0,s.validateModel)(l),l}e.SESSION_SERVICE_URL="api/sessions",e.SessionAPIClient=class{constructor(e){var n;this.serverSettings=null!==(n=e.serverSettings)&&void 0!==n?n:t.ServerConnection.makeSettings()}async listRunning(){return i(this.serverSettings)}async getModel(e){return a(e,this.serverSettings)}async startNew(e){return l(e,this.serverSettings)}async shutdown(e){return o(e,this.serverSettings)}async update(e){return h(e,this.serverSettings)}}})),Qi=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SessionConnection=void 0;var t=ee(),n=Ae(),s=Z(),i=bn();e.SessionConnection=class{constructor(e){var r,o,a,l,h;this._id="",this._path="",this._name="",this._type="",this._kernel=null,this._isDisposed=!1,this._disposed=new t.Signal(this),this._kernelChanged=new t.Signal(this),this._statusChanged=new t.Signal(this),this._connectionStatusChanged=new t.Signal(this),this._pendingInput=new t.Signal(this),this._iopubMessage=new t.Signal(this),this._unhandledMessage=new t.Signal(this),this._anyMessage=new t.Signal(this),this._propertyChanged=new t.Signal(this),this._id=e.model.id,this._name=e.model.name,this._path=e.model.path,this._type=e.model.type,this._username=null!==(r=e.username)&&void 0!==r?r:"",this._clientId=null!==(o=e.clientId)&&void 0!==o?o:s.UUID.uuid4(),this._connectToKernel=e.connectToKernel,this._kernelConnectionOptions=null!==(a=e.kernelConnectionOptions)&&void 0!==a?a:{},this.serverSettings=null!==(l=e.serverSettings)&&void 0!==l?l:n.ServerConnection.makeSettings(),this._sessionAPIClient=null!==(h=e.sessionAPIClient)&&void 0!==h?h:new i.SessionAPIClient({serverSettings:this.serverSettings}),this.setupKernel(e.model.kernel)}get disposed(){return this._disposed}get kernelChanged(){return this._kernelChanged}get statusChanged(){return this._statusChanged}get connectionStatusChanged(){return this._connectionStatusChanged}get pendingInput(){return this._pendingInput}get iopubMessage(){return this._iopubMessage}get unhandledMessage(){return this._unhandledMessage}get anyMessage(){return this._anyMessage}get propertyChanged(){return this._propertyChanged}get id(){return this._id}get kernel(){return this._kernel}get path(){return this._path}get type(){return this._type}get name(){return this._name}get model(){return{id:this.id,kernel:this.kernel&&{id:this.kernel.id,name:this.kernel.name},path:this._path,type:this._type,name:this._name}}get isDisposed(){return this._isDisposed}update(e){let t=this.model;if(this._path=e.path,this._name=e.name,this._type=e.type,null===this._kernel&&null!==e.kernel||null!==this._kernel&&null===e.kernel||null!==this._kernel&&null!==e.kernel&&this._kernel.id!==e.kernel.id){null!==this._kernel&&this._kernel.dispose();let t=this._kernel||null;this.setupKernel(e.kernel);let n=this._kernel||null;this._kernelChanged.emit({name:"kernel",oldValue:t,newValue:n})}this._handleModelChange(t)}dispose(){if(!this.isDisposed){if(this._isDisposed=!0,this._disposed.emit(),this._kernel){this._kernel.dispose();let e=this._kernel;this._kernel=null;let t=this._kernel;this._kernelChanged.emit({name:"kernel",oldValue:e,newValue:t})}t.Signal.clearData(this)}}async setPath(e){if(this.isDisposed)throw new Error("Session is disposed");await this._patch({path:e})}async setName(e){if(this.isDisposed)throw new Error("Session is disposed");await this._patch({name:e})}async setType(e){if(this.isDisposed)throw new Error("Session is disposed");await this._patch({type:e})}async changeKernel(e){if(this.isDisposed)throw new Error("Session is disposed");return await this._patch({kernel:e}),this.kernel}async shutdown(){if(this.isDisposed)throw new Error("Session is disposed");await this._sessionAPIClient.shutdown(this.id),this.dispose()}setupKernel(e){if(null===e)return void(this._kernel=null);let t=this._connectToKernel({...this._kernelConnectionOptions,model:e,username:this._username,clientId:this._clientId,serverSettings:this.serverSettings});this._kernel=t,t.statusChanged.connect(this.onKernelStatus,this),t.connectionStatusChanged.connect(this.onKernelConnectionStatus,this),t.pendingInput.connect(this.onPendingInput,this),t.unhandledMessage.connect(this.onUnhandledMessage,this),t.iopubMessage.connect(this.onIOPubMessage,this),t.anyMessage.connect(this.onAnyMessage,this)}onKernelStatus(e,t){this._statusChanged.emit(t)}onKernelConnectionStatus(e,t){this._connectionStatusChanged.emit(t)}onPendingInput(e,t){this._pendingInput.emit(t)}onIOPubMessage(e,t){this._iopubMessage.emit(t)}onUnhandledMessage(e,t){this._unhandledMessage.emit(t)}onAnyMessage(e,t){this._anyMessage.emit(t)}async _patch(e){let t=await this._sessionAPIClient.update({...e,id:this._id});return this.update(t),t}_handleModelChange(e){e.name!==this._name&&this._propertyChanged.emit("name"),e.type!==this._type&&this._propertyChanged.emit("type"),e.path!==this._path&&this._propertyChanged.emit("path")}}})),eo=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SessionManager=void 0;var t,n=He(),s=ee(),i=he(),r=$e(),o=Qi(),a=bn(),l=class extends r.BaseManager{constructor(e){var t,i;super(e),this._isReady=!1,this._sessionConnections=new Set,this._models=new Map,this._runningChanged=new s.Signal(this),this._connectionFailure=new s.Signal(this),this._connectToKernel=e=>this._kernelManager.connectTo(e),this._kernelManager=e.kernelManager,this._sessionAPIClient=null!==(t=e.sessionAPIClient)&&void 0!==t?t:new a.SessionAPIClient({serverSettings:e.serverSettings}),this._pollModels=new n.Poll({auto:!1,factory:()=>this.requestRunning(),frequency:{interval:1e4,backoff:!0,max:3e5},name:"@jupyterlab/services:SessionManager#models",standby:null!==(i=e.standby)&&void 0!==i?i:"when-hidden"}),this._ready=(async()=>{await this._pollModels.start(),await this._pollModels.tick,this._kernelManager.isActive&&await this._kernelManager.ready,this._isReady=!0})()}get isReady(){return this._isReady}get ready(){return this._ready}get runningChanged(){return this._runningChanged}get connectionFailure(){return this._connectionFailure}dispose(){this.isDisposed||(this._models.clear(),this._sessionConnections.forEach((e=>e.dispose())),this._pollModels.dispose(),super.dispose())}connectTo(e){let t=new o.SessionConnection({...e,connectToKernel:this._connectToKernel,serverSettings:this.serverSettings,sessionAPIClient:this._sessionAPIClient});return this._onStarted(t),this._models.has(e.model.id)||this.refreshRunning().catch((()=>{})),t}running(){return this._models.values()}async refreshRunning(){await this._pollModels.refresh(),await this._pollModels.tick}async startNew(e,t={}){let n=await this._sessionAPIClient.startNew(e);return await this.refreshRunning(),this.connectTo({...t,model:n})}async shutdown(e){await this._sessionAPIClient.shutdown(e),await this.refreshRunning()}async shutdownAll(){await this.refreshRunning(),await Promise.all([...this._models.keys()].map((e=>this._sessionAPIClient.shutdown(e)))),await this.refreshRunning()}async stopIfNeeded(e){try{let t=(await this._sessionAPIClient.listRunning()).filter((t=>t.path===e));if(1===t.length){let e=t[0].id;await this.shutdown(e)}}catch{}}async findById(e){return this._models.has(e)||await this.refreshRunning(),this._models.get(e)}async findByPath(e){for(let t of this._models.values())if(t.path===e)return t;await this.refreshRunning();for(let t of this._models.values())if(t.path===e)return t}async requestRunning(){var e,t;let n;try{n=await this._sessionAPIClient.listRunning()}catch(n){throw(n instanceof i.ServerConnection.NetworkError||503===(null===(e=n.response)||void 0===e?void 0:e.status)||424===(null===(t=n.response)||void 0===t?void 0:t.status))&&this._connectionFailure.emit(n),n}this.isDisposed||this._models.size===n.length&&n.every((e=>{var t,n,s,i;let r=this._models.get(e.id);return!!r&&(null===(t=r.kernel)||void 0===t?void 0:t.id)===(null===(n=e.kernel)||void 0===n?void 0:n.id)&&(null===(s=r.kernel)||void 0===s?void 0:s.name)===(null===(i=e.kernel)||void 0===i?void 0:i.name)&&r.name===e.name&&r.path===e.path&&r.type===e.type}))||(this._models=new Map(n.map((e=>[e.id,e]))),this._sessionConnections.forEach((e=>{this._models.has(e.id)?e.update(this._models.get(e.id)):e.dispose()})),this._runningChanged.emit(n))}_onStarted(e){this._sessionConnections.add(e),e.disposed.connect(this._onDisposed,this),e.propertyChanged.connect(this._onChanged,this),e.kernelChanged.connect(this._onChanged,this)}_onDisposed(e){this._sessionConnections.delete(e),this.refreshRunning().catch((()=>{}))}_onChanged(){this.refreshRunning().catch((()=>{}))}};e.SessionManager=l,(t=l||(e.SessionManager=l={})).NoopManager=class extends t{constructor(){super(...arguments),this._readyPromise=new Promise((()=>{}))}get isActive(){return!1}get parentReady(){return super.ready}async startNew(e,t={}){return Promise.reject(new Error("Not implemented in no-op Session Manager"))}connectTo(e){throw Error("Not implemented in no-op Session Manager")}get ready(){return this.parentReady.then((()=>this._readyPromise))}async shutdown(e){return Promise.reject(new Error("Not implemented in no-op Session Manager"))}async requestRunning(){return Promise.resolve()}}})),Ts=R((e=>{var t=e&&e.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),n=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var s={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&t(s,e,i);return n(s,e),s},i=e&&e.__exportStar||function(e,n){for(var s in e)"default"!==s&&!Object.prototype.hasOwnProperty.call(n,s)&&t(n,e,s)};Object.defineProperty(e,"__esModule",{value:!0}),e.SessionAPI=e.Session=void 0;var r=s(Bi());e.Session=r;var o=s(bn());e.SessionAPI=o,i(eo(),e)})),so=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DataConnector=void 0,e.DataConnector=class{async list(e){throw new Error("DataConnector#list method has not been implemented.")}async remove(e){throw new Error("DataConnector#remove method has not been implemented.")}async save(e,t){throw new Error("DataConnector#save method has not been implemented.")}}})),io=R((e=>{Object.defineProperty(e,"__esModule",{value:!0})})),ao=R(((e,t)=>{var n,s;n=e,s=function(e){class t{constructor(e){this._pid=n.nextPID(),this.name=e.name,this._create=e.create,this._coerce=e.coerce||null,this._compare=e.compare||null,this._changed=e.changed||null}get(e){let t,s=n.ensureMap(e);return t=this._pid in s?s[this._pid]:s[this._pid]=this._createValue(e),t}set(e,t){let s,i=n.ensureMap(e);s=this._pid in i?i[this._pid]:i[this._pid]=this._createValue(e);let r=this._coerceValue(e,t);this._maybeNotify(e,s,i[this._pid]=r)}coerce(e){let t,s=n.ensureMap(e);t=this._pid in s?s[this._pid]:s[this._pid]=this._createValue(e);let i=this._coerceValue(e,t);this._maybeNotify(e,t,s[this._pid]=i)}_createValue(e){return(0,this._create)(e)}_coerceValue(e,t){let n=this._coerce;return n?n(e,t):t}_compareValue(e,t){let n=this._compare;return n?n(e,t):e===t}_maybeNotify(e,t,n){let s=this._changed;s&&!this._compareValue(t,n)&&s(e,t,n)}}var n,s;(t||(t={})).clearData=function(e){n.ownerData.delete(e)},(s=n||(n={})).ownerData=new WeakMap,s.nextPID=(()=>{let e=0;return()=>`pid-${`${Math.random()}`.slice(2)}-${e++}`})(),s.ensureMap=function(e){let t=s.ownerData.get(e);return t||(t=Object.create(null),s.ownerData.set(e,t),t)},e.AttachedProperty=t},"object"==typeof e&&void 0!==t?s(e):"function"==typeof define&&__webpack_require__.amdO?define(["exports"],s):s((n="undefined"!=typeof globalThis?globalThis:n||self).lumino_properties={})})),co=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.RestorablePool=void 0;var t,n,s=Z(),i=ao(),r=ee();e.RestorablePool=class{constructor(e){this._added=new r.Signal(this),this._current=null,this._currentChanged=new r.Signal(this),this._hasRestored=!1,this._isDisposed=!1,this._objects=new Set,this._restore=null,this._restored=new s.PromiseDelegate,this._updated=new r.Signal(this),this.namespace=e.namespace}get added(){return this._added}get current(){return this._current}set current(e){this._current!==e&&null!==e&&this._objects.has(e)&&(this._current=e,this._currentChanged.emit(this._current))}get currentChanged(){return this._currentChanged}get isDisposed(){return this._isDisposed}get restored(){return this._restored.promise}get size(){return this._objects.size}get updated(){return this._updated}async add(e){var n,s;if(e.isDisposed){let t="A disposed object cannot be added.";throw console.warn(t,e),new Error(t)}if(this._objects.has(e)){let t="This object already exists in the pool.";throw console.warn(t,e),new Error(t)}if(this._objects.add(e),e.disposed.connect(this._onInstanceDisposed,this),!t.injectedProperty.get(e)){if(this._restore){let{connector:i}=this._restore,r=this._restore.name(e);if(r){let o=`${this.namespace}:${r}`,a=null===(s=(n=this._restore).args)||void 0===s?void 0:s.call(n,e);t.nameProperty.set(e,o),await i.save(o,{data:a})}}this._added.emit(e)}}dispose(){this.isDisposed||(this._current=null,this._isDisposed=!0,this._objects.clear(),r.Signal.clearData(this))}find(e){let t=this._objects.values();for(let n of t)if(e(n))return n}forEach(e){this._objects.forEach(e)}filter(e){let t=[];return this.forEach((n=>{e(n)&&t.push(n)})),t}inject(e){return t.injectedProperty.set(e,!0),this.add(e)}has(e){return this._objects.has(e)}async restore(e){if(this._hasRestored)throw new Error("This pool has already been restored.");this._hasRestored=!0;let{command:t,connector:n,registry:s,when:i}=e,r=this.namespace,o=i?[n.list(r)].concat(i):[n.list(r)];this._restore=e;let[a]=await Promise.all(o),l=await Promise.all(a.ids.map((async(e,i)=>{let r=a.values[i],o=r&&r.data;return void 0===o?n.remove(e):s.execute(t,o).catch((()=>n.remove(e)))})));return this._restored.resolve(),l}async save(e){var n,s;let i=t.injectedProperty.get(e);if(!this._restore||!this.has(e)||i)return;let{connector:r}=this._restore,o=this._restore.name(e),a=t.nameProperty.get(e),l=o?`${this.namespace}:${o}`:"";if(a&&a!==l&&await r.remove(a),t.nameProperty.set(e,l),l){let t=null===(s=(n=this._restore).args)||void 0===s?void 0:s.call(n,e);await r.save(l,{data:t})}a!==l&&this._updated.emit(e)}_onInstanceDisposed(e){if(this._objects.delete(e),e===this._current&&(this._current=null,this._currentChanged.emit(this._current)),t.injectedProperty.get(e)||!this._restore)return;let{connector:n}=this._restore,s=t.nameProperty.get(e);s&&n.remove(s)}},(n=t||(t={})).injectedProperty=new i.AttachedProperty({name:"injected",create:()=>!1}),n.nameProperty=new i.AttachedProperty({name:"name",create:()=>""})})),uo=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.StateDB=void 0;var t=ee(),n=class e{constructor(n={}){this._changed=new t.Signal(this);let{connector:s,transform:i}=n;this._connector=s||new e.Connector,this._ready=i?i.then((e=>{let{contents:t,type:n}=e;switch(n){case"cancel":default:return;case"clear":return this._clear();case"merge":return this._merge(t||{});case"overwrite":return this._overwrite(t||{})}})):Promise.resolve(void 0)}get changed(){return this._changed}async clear(){await this._ready,await this._clear()}async fetch(e){return await this._ready,this._fetch(e)}async list(e){return await this._ready,this._list(e)}async remove(e){await this._ready,await this._remove(e),this._changed.emit({id:e,type:"remove"})}async save(e,t){await this._ready,await this._save(e,t),this._changed.emit({id:e,type:"save"})}async toJSON(){await this._ready;let{ids:e,values:t}=await this._list();return t.reduce(((t,n,s)=>(t[e[s]]=n,t)),{})}async _clear(){await Promise.all((await this._list()).ids.map((e=>this._remove(e))))}async _fetch(e){let t=await this._connector.fetch(e);if(t)return JSON.parse(t).v}async _list(e=""){let{ids:t,values:n}=await this._connector.list(e);return{ids:t,values:n.map((e=>JSON.parse(e).v))}}async _merge(e){await Promise.all(Object.keys(e).map((t=>e[t]&&this._save(t,e[t]))))}async _overwrite(e){await this._clear(),await this._merge(e)}async _remove(e){return this._connector.remove(e)}async _save(e,t){return this._connector.save(e,JSON.stringify({v:t}))}};e.StateDB=n,(n||(e.StateDB=n={})).Connector=class{constructor(){this._storage={}}async fetch(e){return this._storage[e]}async list(e=""){return Object.keys(this._storage).reduce(((t,n)=>((""===e||e===n.split(":")[0])&&(t.ids.push(n),t.values.push(this._storage[n])),t)),{ids:[],values:[]})}async remove(e){delete this._storage[e]}async save(e,t){this._storage[e]=t}}})),ho=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.IStateDB=void 0;var t=Z();e.IStateDB=new t.Token("@jupyterlab/coreutils:IStateDB",'A service for the JupyterLab state database.\n  Use this if you want to store data that will persist across page loads.\n  See "state database" for more information.')})),Ns=R((e=>{var t=e&&e.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),n=e&&e.__exportStar||function(e,n){for(var s in e)"default"!==s&&!Object.prototype.hasOwnProperty.call(n,s)&&t(n,e,s)};Object.defineProperty(e,"__esModule",{value:!0}),n(so(),e),n(io(),e),n(co(),e),n(uo(),e),n(ho(),e)})),Fs=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SettingManager=void 0;var t,n=te(),s=Ns(),i=he(),r=class extends s.DataConnector{constructor(e={}){var t;super(),this.serverSettings=null!==(t=e.serverSettings)&&void 0!==t?t:i.ServerConnection.makeSettings()}async fetch(e){if(!e)throw new Error("Plugin `id` parameter is required for settings fetch.");let{serverSettings:n}=this,{baseUrl:s,appUrl:r}=n,{makeRequest:o,ResponseError:a}=i.ServerConnection,l=s+r,h=t.url(l,e),u=await o(h,{},n);if(200!==u.status)throw await a.create(u);return u.json()}async list(e){var n,s,r,o;let{serverSettings:a}=this,{baseUrl:l,appUrl:h}=a,{makeRequest:u,ResponseError:d}=i.ServerConnection,c=l+h,p=t.url(c,"","ids"===e),_=await u(p,{},a);if(200!==_.status)throw new d(_);let f=await _.json(),m=null!==(s=null===(n=null==f?void 0:f.settings)||void 0===n?void 0:n.map((e=>e.id)))&&void 0!==s?s:[],g=[];return e||(g=null!==(o=null===(r=null==f?void 0:f.settings)||void 0===r?void 0:r.map((e=>(e.data={composite:{},user:{}},e))))&&void 0!==o?o:[]),{ids:m,values:g}}async save(e,n){let{serverSettings:s}=this,{baseUrl:r,appUrl:o}=s,{makeRequest:a,ResponseError:l}=i.ServerConnection,h=r+o,u=t.url(h,e),d={body:JSON.stringify({raw:n}),method:"PUT"},c=await a(u,d,s);if(204!==c.status)throw new l(c)}};e.SettingManager=r,(t||(t={})).url=function(e,t,s){let i=s?n.URLExt.objectToQueryString({ids_only:!0}):"",r=n.URLExt.join(e,"api/settings"),o=n.URLExt.join(r,t);if(!o.startsWith(r))throw new Error("Can only be used for workspaces requests");return`${o}${i}`}})),It=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TerminalAPIClient=e.TERMINAL_SERVICE_URL=void 0,e.isAvailable=i,e.startNew=r,e.listRunning=o,e.shutdownTerminal=a;var t,n=te(),s=he();function i(){return"true"===String(n.PageConfig.getOption("terminalsAvailable")).toLowerCase()}async function r(i=s.ServerConnection.makeSettings(),r,o){t.errorIfNotAvailable();let a=n.URLExt.join(i.baseUrl,e.TERMINAL_SERVICE_URL),l={method:"POST",body:JSON.stringify({name:r,cwd:o})},h=await s.ServerConnection.makeRequest(a,l,i);if(200!==h.status)throw await s.ServerConnection.ResponseError.create(h);return await h.json()}async function o(i=s.ServerConnection.makeSettings()){t.errorIfNotAvailable();let r=n.URLExt.join(i.baseUrl,e.TERMINAL_SERVICE_URL),o=await s.ServerConnection.makeRequest(r,{},i);if(200!==o.status)throw await s.ServerConnection.ResponseError.create(o);let a=await o.json();if(!Array.isArray(a))throw new Error("Invalid terminal list");return a}async function a(i,r=s.ServerConnection.makeSettings()){var o;t.errorIfNotAvailable();let a=n.URLExt.join(r.baseUrl,e.TERMINAL_SERVICE_URL),l=n.URLExt.join(a,i);if(!l.startsWith(a))throw new Error("Can only be used for terminal requests");let h=await s.ServerConnection.makeRequest(l,{method:"DELETE"},r);if(404===h.status){let e=null!==(o=(await h.json()).message)&&void 0!==o?o:`The terminal session "${i}"" does not exist on the server`;console.warn(e)}else if(204!==h.status)throw await s.ServerConnection.ResponseError.create(h)}e.TERMINAL_SERVICE_URL="api/terminals",e.TerminalAPIClient=class{constructor(e={}){var t;this.serverSettings=null!==(t=e.serverSettings)&&void 0!==t?t:s.ServerConnection.makeSettings()}get isAvailable(){return i()}async startNew(e={}){let{name:t,cwd:n}=e;return r(this.serverSettings,t,n)}async listRunning(){return o(this.serverSettings)}async shutdown(e){return a(e,this.serverSettings)}},(t||(t={})).errorIfNotAvailable=function(){if(!i())throw new Error("Terminals Unavailable")}})),go=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.isAvailable=void 0;var t=It();Object.defineProperty(e,"isAvailable",{enumerable:!0,get:function(){return t.isAvailable}})})),mo=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TerminalConnection=void 0;var t,n=te(),s=Z(),i=ee(),r=Ae(),o=It();e.TerminalConnection=class e{constructor(e){var t,s;this._createSocket=()=>{this._errorIfDisposed(),this._clearSocket(),this._updateConnectionStatus("connecting");let e=this._name,t=this.serverSettings,s=n.URLExt.join(t.wsUrl,"terminals","websocket",encodeURIComponent(e)),i=t.token;t.appendToken&&""!==i&&(s+=`?token=${encodeURIComponent(i)}`),this._ws=new t.WebSocket(s),this._ws.onmessage=this._onWSMessage,this._ws.onclose=this._onWSClose,this._ws.onerror=this._onWSClose},this._onWSMessage=e=>{if(this._isDisposed)return;let t=JSON.parse(e.data);"disconnect"===t[0]&&this.dispose(),"connecting"!==this._connectionStatus?this._messageReceived.emit({type:t[0],content:t.slice(1)}):"setup"===t[0]&&this._updateConnectionStatus("connected")},this._onWSClose=e=>{console.warn(`Terminal websocket closed: ${e.code}`),this.isDisposed||this._reconnect()},this._connectionStatus="connecting",this._connectionStatusChanged=new i.Signal(this),this._isDisposed=!1,this._disposed=new i.Signal(this),this._messageReceived=new i.Signal(this),this._reconnectTimeout=null,this._ws=null,this._noOp=()=>{},this._reconnectLimit=7,this._reconnectAttempt=0,this._pendingMessages=[],this._name=e.model.name,this.serverSettings=null!==(t=e.serverSettings)&&void 0!==t?t:r.ServerConnection.makeSettings(),this._terminalAPIClient=null!==(s=e.terminalAPIClient)&&void 0!==s?s:new o.TerminalAPIClient({serverSettings:this.serverSettings}),this._createSocket()}get disposed(){return this._disposed}get messageReceived(){return this._messageReceived}get name(){return this._name}get model(){return{name:this._name}}get isDisposed(){return this._isDisposed}dispose(){this._isDisposed||(this._isDisposed=!0,this._disposed.emit(),this._updateConnectionStatus("disconnected"),this._clearSocket(),i.Signal.clearData(this))}send(e){this._sendMessage(e)}_sendMessage(e,t=!0){if(!this._isDisposed&&e.content)if("connected"===this.connectionStatus&&this._ws){let t=[e.type,...e.content];this._ws.send(JSON.stringify(t))}else{if(!t)throw new Error(`Could not send message: ${JSON.stringify(e)}`);this._pendingMessages.push(e)}}_sendPending(){for(;"connected"===this.connectionStatus&&this._pendingMessages.length>0;)this._sendMessage(this._pendingMessages[0],!1),this._pendingMessages.shift()}reconnect(){this._errorIfDisposed();let e=new s.PromiseDelegate,t=(n,s)=>{"connected"===s?(e.resolve(),this.connectionStatusChanged.disconnect(t,this)):"disconnected"===s&&(e.reject(new Error("Terminal connection disconnected")),this.connectionStatusChanged.disconnect(t,this))};return this.connectionStatusChanged.connect(t,this),this._reconnectAttempt=0,this._reconnect(),e.promise}_reconnect(){if(this._errorIfDisposed(),clearTimeout(this._reconnectTimeout),this._reconnectAttempt<this._reconnectLimit){this._updateConnectionStatus("connecting");let e=t.getRandomIntInclusive(0,1e3*(Math.pow(2,this._reconnectAttempt)-1));console.error(`Connection lost, reconnecting in ${Math.floor(e/1e3)} seconds.`),this._reconnectTimeout=setTimeout(this._createSocket,e),this._reconnectAttempt+=1}else this._updateConnectionStatus("disconnected");this._clearSocket()}_clearSocket(){null!==this._ws&&(this._ws.onopen=this._noOp,this._ws.onclose=this._noOp,this._ws.onerror=this._noOp,this._ws.onmessage=this._noOp,this._ws.close(),this._ws=null)}async shutdown(){await this._terminalAPIClient.shutdown(this.name),this.dispose()}clone(){return new e({model:this.model,serverSettings:this.serverSettings,terminalAPIClient:this._terminalAPIClient})}_updateConnectionStatus(e){this._connectionStatus!==e&&(this._connectionStatus=e,"connecting"!==e&&(this._reconnectAttempt=0,clearTimeout(this._reconnectTimeout)),"connected"===e&&this._sendPending(),this._connectionStatusChanged.emit(e))}_errorIfDisposed(){if(this.isDisposed)throw new Error("Terminal connection is disposed")}get connectionStatusChanged(){return this._connectionStatusChanged}get connectionStatus(){return this._connectionStatus}},(t||(t={})).getRandomIntInclusive=function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}})),yo=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TerminalManager=void 0;var t,n=He(),s=ee(),i=Ae(),r=$e(),o=It(),a=mo(),l=class extends r.BaseManager{constructor(e={}){var t,i;if(super(e),this._isReady=!1,this._names=[],this._terminalConnections=new Set,this._runningChanged=new s.Signal(this),this._connectionFailure=new s.Signal(this),this._terminalAPIClient=null!==(t=e.terminalAPIClient)&&void 0!==t?t:new o.TerminalAPIClient({serverSettings:this.serverSettings}),!this.isAvailable())return this._ready=Promise.reject("Terminals unavailable"),void this._ready.catch((e=>{}));let r=this._pollModels=new n.Poll({auto:!1,factory:()=>this.requestRunning(),frequency:{interval:1e4,backoff:!0,max:3e5},name:"@jupyterlab/services:TerminalManager#models",standby:null!==(i=e.standby)&&void 0!==i?i:"when-hidden"});this._ready=(async()=>{await r.start(),await r.tick,this._isReady=!0})()}get isReady(){return this._isReady}get ready(){return this._ready}get runningChanged(){return this._runningChanged}get connectionFailure(){return this._connectionFailure}dispose(){var e;this.isDisposed||(this._names.length=0,this._terminalConnections.forEach((e=>e.dispose())),null===(e=this._pollModels)||void 0===e||e.dispose(),super.dispose())}isAvailable(){return this._terminalAPIClient.isAvailable}connectTo(e){let t=new a.TerminalConnection({...e,serverSettings:this.serverSettings,terminalAPIClient:this._terminalAPIClient});return this._onStarted(t),this._names.includes(e.model.name)||this.refreshRunning().catch((()=>{})),t}running(){return this._models[Symbol.iterator]()}async refreshRunning(){this._pollModels&&(await this._pollModels.refresh(),await this._pollModels.tick)}async startNew(e={}){let{name:t,cwd:n}=e,s=await this._terminalAPIClient.startNew({name:t,cwd:n});return await this.refreshRunning(),this.connectTo({model:s})}async shutdown(e){await this._terminalAPIClient.shutdown(e),await this.refreshRunning()}async shutdownAll(){await this.refreshRunning(),await Promise.all(this._names.map((e=>this._terminalAPIClient.shutdown(e)))),await this.refreshRunning()}async requestRunning(){var e,t;let n;try{n=await this._terminalAPIClient.listRunning()}catch(n){throw(n instanceof i.ServerConnection.NetworkError||503===(null===(e=n.response)||void 0===e?void 0:e.status)||424===(null===(t=n.response)||void 0===t?void 0:t.status))&&this._connectionFailure.emit(n),n}if(this.isDisposed)return;let s=n.map((({name:e})=>e)).sort();s!==this._names&&(this._names=s,this._terminalConnections.forEach((e=>{s.includes(e.name)||e.dispose()})),this._runningChanged.emit(this._models))}_onStarted(e){this._terminalConnections.add(e),e.disposed.connect(this._onDisposed,this)}_onDisposed(e){this._terminalConnections.delete(e),this.refreshRunning().catch((()=>{}))}get _models(){return this._names.map((e=>({name:e})))}};e.TerminalManager=l,(t=l||(e.TerminalManager=l={})).NoopManager=class extends t{constructor(){super(...arguments),this._readyPromise=new Promise((()=>{}))}get isActive(){return!1}get parentReady(){return super.ready}get ready(){return this.parentReady.then((()=>this._readyPromise))}async startNew(e){return Promise.reject(new Error("Not implemented in no-op Terminal Manager"))}connectTo(e){throw Error("Not implemented in no-op Terminal Manager")}async shutdown(e){return Promise.reject(new Error("Not implemented in no-op Terminal Manager"))}async requestRunning(){return Promise.resolve()}}})),Ws=R((e=>{var t=e&&e.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),n=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var s={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&t(s,e,i);return n(s,e),s},i=e&&e.__exportStar||function(e,n){for(var s in e)"default"!==s&&!Object.prototype.hasOwnProperty.call(n,s)&&t(n,e,s)};Object.defineProperty(e,"__esModule",{value:!0}),e.TerminalAPI=e.Terminal=void 0;var r=s(go());e.Terminal=r;var o=s(It());e.TerminalAPI=o,i(yo(),e)})),Co=R((e=>{Object.defineProperty(e,"__esModule",{value:!0})})),Hs=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.UserAPIClient=void 0;var t=he(),n=te();e.UserAPIClient=class{constructor(e={}){var n;this.serverSettings=null!==(n=e.serverSettings)&&void 0!==n?n:t.ServerConnection.makeSettings()}async get(){let{baseUrl:e}=this.serverSettings,{makeRequest:s,ResponseError:i}=t.ServerConnection,r=n.URLExt.join(e,"api/me"),o=await s(r,{},this.serverSettings);if(200!==o.status)throw await i.create(o);return await o.json()}}})),Eo=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.UserManager=void 0;var t,n=Z(),s=He(),i=ee(),r=$e(),o=Hs(),a="@jupyterlab/services:UserManager#user",l=class extends r.BaseManager{constructor(e={}){var t,n;super(e),this._isReady=!1,this._userChanged=new i.Signal(this),this._connectionFailure=new i.Signal(this),this._userApiClient=null!==(t=e.userApiClient)&&void 0!==t?t:new o.UserAPIClient({serverSettings:this.serverSettings}),this._ready=this.requestUser().then((()=>{this.isDisposed||(this._isReady=!0)})).catch((e=>new Promise((()=>{})))),this._pollUser=new s.Poll({auto:!1,factory:()=>this.requestUser(),frequency:{interval:61e3,backoff:!0,max:3e5},name:a,standby:null!==(n=e.standby)&&void 0!==n?n:"when-hidden"}),this.ready.then((()=>{this._pollUser.start()}))}get isReady(){return this._isReady}get ready(){return this._ready}get identity(){return this._identity}get permissions(){return this._permissions}get userChanged(){return this._userChanged}get connectionFailure(){return this._connectionFailure}dispose(){this._pollUser.dispose(),super.dispose()}async refreshUser(){await this._pollUser.refresh(),await this._pollUser.tick}async requestUser(){if(this.isDisposed)return;let e={identity:this._identity,permissions:this._permissions},s=await this._userApiClient.get(),i=s.identity,{localStorage:r}=window,o=r.getItem(a);if(o&&(!i.initials||!i.color)){let e=JSON.parse(o);i.initials=i.initials||e.initials||i.name.substring(0,1),i.color=i.color||e.color||t.getRandomColor()}n.JSONExt.deepEqual(s,e)||(this._identity=i,this._permissions=s.permissions,r.setItem(a,JSON.stringify(i)),this._userChanged.emit(s))}};e.UserManager=l,function(e){let t=["var(--jp-collaborator-color1)","var(--jp-collaborator-color2)","var(--jp-collaborator-color3)","var(--jp-collaborator-color4)","var(--jp-collaborator-color5)","var(--jp-collaborator-color6)","var(--jp-collaborator-color7)"];e.getRandomColor=()=>t[Math.floor(Math.random()*t.length)]}(t||(t={}))})),Ys=R((e=>{var t=e&&e.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),n=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var s={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&t(s,e,i);return n(s,e),s},i=e&&e.__exportStar||function(e,n){for(var s in e)"default"!==s&&!Object.prototype.hasOwnProperty.call(n,s)&&t(n,e,s)};Object.defineProperty(e,"__esModule",{value:!0}),e.UserAPI=e.User=void 0;var r=s(Co());e.User=r;var o=s(Hs());e.UserAPI=o,i(Eo(),e)})),Zs=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WorkspaceManager=void 0;var t,n=te(),s=Ns(),i=he(),r=class extends s.DataConnector{constructor(e={}){var t;super(),this.serverSettings=null!==(t=e.serverSettings)&&void 0!==t?t:i.ServerConnection.makeSettings()}async fetch(e){let{serverSettings:n}=this,{baseUrl:s,appUrl:r}=n,{makeRequest:o,ResponseError:a}=i.ServerConnection,l=s+r,h=t.url(l,e),u=await o(h,{},n);if(200!==u.status)throw await a.create(u);return u.json()}async list(){let{serverSettings:e}=this,{baseUrl:n,appUrl:s}=e,{makeRequest:r,ResponseError:o}=i.ServerConnection,a=n+s,l=t.url(a,""),h=await r(l,{},e);if(200!==h.status)throw await o.create(h);return(await h.json()).workspaces}async remove(e){let{serverSettings:n}=this,{baseUrl:s,appUrl:r}=n,{makeRequest:o,ResponseError:a}=i.ServerConnection,l=s+r,h=t.url(l,e),u=await o(h,{method:"DELETE"},n);if(204!==u.status)throw await a.create(u)}async save(e,n){let{serverSettings:s}=this,{baseUrl:r,appUrl:o}=s,{makeRequest:a,ResponseError:l}=i.ServerConnection,h=r+o,u=t.url(h,e),d={body:JSON.stringify(n),method:"PUT"},c=await a(u,d,s);if(204!==c.status)throw await l.create(c)}};e.WorkspaceManager=r,(t||(t={})).url=function(e,t){let s=n.URLExt.join(e,"api/workspaces"),i=n.URLExt.join(s,t);if(!i.startsWith(s))throw new Error("Can only be used for workspaces requests");return i}})),Do=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ServiceManager=void 0;var t=ee(),n=zi(),s=ds(),i=_s(),r=Cs(),o=Ms(),a=Ds(),l=he(),h=Ts(),u=Fs(),d=Ws(),c=Ys(),p=Zs();e.ServiceManager=class{constructor(e={}){var _,f;this._isDisposed=!1,this._connectionFailure=new t.Signal(this),this._isReady=!1;let m=e.defaultDrive,g=null!==(_=e.serverSettings)&&void 0!==_?_:l.ServerConnection.makeSettings(),v={defaultDrive:m,serverSettings:g,standby:null!==(f=e.standby)&&void 0!==f?f:"when-hidden"};this.serverSettings=g,this.contents=e.contents||new s.ContentsManager(v),this.events=e.events||new i.EventManager(v),this.kernels=e.kernels||new r.KernelManager(v),this.sessions=e.sessions||new h.SessionManager({...v,kernelManager:this.kernels}),this.settings=e.settings||new u.SettingManager(v),this.terminals=e.terminals||new d.TerminalManager(v),this.builder=e.builder||new n.BuildManager(v),this.workspaces=e.workspaces||new p.WorkspaceManager(v),this.nbconvert=e.nbconvert||new a.NbConvertManager(v),this.kernelspecs=e.kernelspecs||new o.KernelSpecManager(v),this.user=e.user||new c.UserManager(v),this.kernelspecs.connectionFailure.connect(this._onConnectionFailure,this),this.sessions.connectionFailure.connect(this._onConnectionFailure,this),this.terminals.connectionFailure.connect(this._onConnectionFailure,this);let y=[this.sessions.ready,this.kernelspecs.ready];this.terminals.isAvailable()&&y.push(this.terminals.ready),this._readyPromise=Promise.all(y).then((()=>{this._isReady=!0}))}get connectionFailure(){return this._connectionFailure}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,t.Signal.clearData(this),this.contents.dispose(),this.events.dispose(),this.sessions.dispose(),this.terminals.dispose())}get isReady(){return this._isReady}get ready(){return this._readyPromise}_onConnectionFailure(e,t){this._connectionFailure.emit(t)}}})),qo=R((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.IWorkspaceManager=e.IUserManager=e.ITerminalManager=e.IServiceManager=e.ISettingManager=e.ISessionManager=e.IServerSettings=e.INbConvertManager=e.IKernelSpecManager=e.IKernelManager=e.IEventManager=e.IDefaultDrive=e.IDefaultContentProvider=e.IContentsManager=e.IConfigSectionManager=e.IConnectionStatus=void 0;var t=Z();e.IConnectionStatus=new t.Token("@jupyterlab/application:IConnectionStatus","A service providing the application connection status."),e.IConfigSectionManager=new t.Token("@jupyterlab/services:IConfigSectionManager","A service providing the config section manager."),e.IContentsManager=new t.Token("@jupyterlab/services:IContentsManager","The contents manager token."),e.IDefaultContentProvider=new t.Token("@jupyterlab/services:IDefaultContentProvider","The default content provider for the contents manager."),e.IDefaultDrive=new t.Token("@jupyterlab/services:IDefaultDrive","The default drive for the contents manager."),e.IEventManager=new t.Token("@jupyterlab/services:IEventManager","The event manager token."),e.IKernelManager=new t.Token("@jupyterlab/services:IKernelManager","The kernel manager token."),e.IKernelSpecManager=new t.Token("@jupyterlab/services:IKernelSpecManager","The kernel spec manager token."),e.INbConvertManager=new t.Token("@jupyterlab/services:INbConvertManager","The nbconvert manager token."),e.IServerSettings=new t.Token("@jupyterlab/services:IServerSettings","The server settings for the application."),e.ISessionManager=new t.Token("@jupyterlab/services:ISessionManager","The session manager token."),e.ISettingManager=new t.Token("@jupyterlab/services:ISettingManager","The setting manager token."),e.IServiceManager=new t.Token("@jupyterlab/services:IServiceManager","The service manager for the application."),e.ITerminalManager=new t.Token("@jupyterlab/services:ITerminalManager","The terminal manager token."),e.IUserManager=new t.Token("@jupyterlab/services:IUserManager","The user manager token."),e.IWorkspaceManager=new t.Token("@jupyterlab/services:IWorkspaceManager","The workspace manager token.")})),Ae=R((e=>{var t=e&&e.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),n=e&&e.__exportStar||function(e,n){for(var s in e)"default"!==s&&!Object.prototype.hasOwnProperty.call(n,s)&&t(n,e,s)};Object.defineProperty(e,"__esModule",{value:!0}),n($e(),e),n(ni(),e),n(si(),e),n(ds(),e),n(_s(),e),n(Cs(),e),n(Ms(),e),n(Do(),e),n(he(),e),n(Ts(),e),n(Fs(),e),n(Ws(),e),n(qo(),e),n(Ys(),e),n(Zs(),e),n(Ds(),e)}));function jo(e){return"node"in e}var To=sr((()=>{})),No={};Qo(No,{BLOCK_SIZE:()=>bu,ContentsAPI:()=>Kn,DRIVE_SEPARATOR:()=>Ao,DriveFS:()=>Dt,DriveFSEmscriptenNodeOps:()=>Fn,DriveFSEmscriptenStreamOps:()=>xn,ServiceWorkerContentsAPI:()=>zn});var Uo,Ao,bu,Cu,Pu,Ln,xn,Fn,Kn,zn,Dt,tr=sr((()=>{Uo=Wn(Z()),To(),Ao=":",bu=4096,Cu=new TextEncoder,Pu=new TextDecoder("utf-8"),Ln={0:!1,1:!0,2:!0,64:!0,65:!0,66:!0,129:!0,193:!0,514:!0,577:!0,578:!0,705:!0,706:!0,1024:!0,1025:!0,1026:!0,1089:!0,1090:!0,1153:!0,1154:!0,1217:!0,1218:!0,4096:!0,4098:!0},xn=class{constructor(e){this.fs=e}open(e){var t;let n=this.fs.realPath(e.node);if(this.fs.FS.isFile(e.node.mode))try{let t=this.fs.API.get(n);e.file=t}catch{let s=null!==(t=e.flags)&&void 0!==t?t:e.shared.flags,i="string"==typeof s?parseInt(s,10):s;i&=8191;let r=!0;if(i in Ln&&(r=Ln[i]),!r)throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.ENOENT);{e.node=this.fs.node_ops.mknod(e.node.parent,e.node.name,e.node.mode,0);let t=this.fs.API.get(n);e.file=t}}}close(e){var t;if(!this.fs.FS.isFile(e.node.mode)||!e.file)return;let n=this.fs.realPath(e.node),s=null!==(t=e.flags)&&void 0!==t?t:e.shared.flags,i="string"==typeof s?parseInt(s,10):s;i&=8191;let r=!0;i in Ln&&(r=Ln[i]),r&&this.fs.API.put(n,e.file),e.file=void 0}read(e,t,n,s,i){if(s<=0||void 0===e.file||i>=(e.file.data.length||0))return 0;let r=Math.min(e.file.data.length-i,s);return t.set(e.file.data.subarray(i,i+r),n),r}write(e,t,n,s,i){var r;if(s<=0||void 0===e.file)return 0;let o=Date.now();if(e.node.timestamp=o,e.node.atime=o,e.node.mtime=o,e.node.ctime=o,i+s>((null===(r=e.file)||void 0===r?void 0:r.data.length)||0)){let t=e.file.data?e.file.data:new Uint8Array;e.file.data=new Uint8Array(i+s),e.file.data.set(t)}return e.file.data.set(t.subarray(n,n+s),i),s}llseek(e,t,n){var s;let i=t;if(1===n)i+=null!==(s=e.position)&&void 0!==s?s:e.shared.position;else if(2===n&&this.fs.FS.isFile(e.node.mode)){if(void 0===e.file)throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EPERM);i+=e.file.data.length}if(i<0)throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EINVAL);return i}},Fn=class{constructor(e){this.node=e=>jo(e)?e.node:e,this.getattr=e=>{let t=this.node(e);return{...this.fs.API.getattr(this.fs.realPath(t)),mode:t.mode,ino:t.id}},this.setattr=(e,t)=>{let n=this.node(e);for(let[e,s]of Object.entries(t))switch(e){case"mode":n.mode=s;break;case"timestamp":n.timestamp=s;break;case"atime":n.atime=s;break;case"mtime":n.mtime=s;break;case"ctime":n.ctime=s;break;case"size":{let e=s,t=this.fs.realPath(n);if(this.fs.FS.isFile(n.mode)&&e>=0){let n;try{n=this.fs.API.get(t)}catch{break}let s=n.data?n.data:new Uint8Array;e!==s.length&&(e<s.length?n.data=n.data.slice(0,e):(n.data=new Uint8Array(e),n.data.set(s)),this.fs.API.put(t,n))}else console.warn("setattr size of",e,"on",n,"not yet implemented");break}case"dontFollow":break;default:console.warn("setattr",e,"of",s,"on",n,"not yet implemented")}},this.lookup=(e,t)=>{let n=this.node(e),s=this.fs.PATH.join2(this.fs.realPath(n),t),i=this.fs.API.lookup(s);if(!i.ok)throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.ENOENT);return this.fs.createNode(n,t,i.mode,0)},this.mknod=(e,t,n,s)=>{let i=this.node(e),r=this.fs.PATH.join2(this.fs.realPath(i),t);return this.fs.API.mknod(r,n),this.fs.createNode(i,t,n,s)},this.rename=(e,t,n)=>{let s=this.node(e),i=this.node(t);this.fs.API.rename(s.parent?this.fs.PATH.join2(this.fs.realPath(s.parent),s.name):s.name,this.fs.PATH.join2(this.fs.realPath(i),n)),s.name=n,s.parent=i},this.unlink=(e,t)=>this.fs.API.rmdir(this.fs.PATH.join2(this.fs.realPath(this.node(e)),t)),this.rmdir=(e,t)=>this.fs.API.rmdir(this.fs.PATH.join2(this.fs.realPath(this.node(e)),t)),this.readdir=e=>this.fs.API.readdir(this.fs.realPath(this.node(e))),this.symlink=(e,t,n)=>{throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EPERM)},this.readlink=e=>{throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EINVAL)},this.fs=e}},Kn=class{constructor(e){this._driveName=e.driveName,this._mountpoint=e.mountpoint,this.FS=e.FS,this.ERRNO_CODES=e.ERRNO_CODES}lookup(e){return this.request({method:"lookup",path:this.normalizePath(e)})}getmode(e){return this.request({method:"getmode",path:this.normalizePath(e)})}mknod(e,t){return this.request({method:"mknod",path:this.normalizePath(e),data:{mode:t}})}rename(e,t){return this.request({method:"rename",path:this.normalizePath(e),data:{newPath:this.normalizePath(t)}})}readdir(e){let t=this.request({method:"readdir",path:this.normalizePath(e)});return t.push("."),t.push(".."),t}rmdir(e){return this.request({method:"rmdir",path:this.normalizePath(e)})}get(e){let t=this.request({method:"get",path:this.normalizePath(e)});if(!t)throw new this.FS.ErrnoError(this.ERRNO_CODES.ENOENT);let n=t.content,s=t.format;switch(s){case"json":case"text":return{data:Cu.encode(n),format:s};case"base64":{let e=atob(n),t=e.length,i=new Uint8Array(t);for(let n=0;n<t;n++)i[n]=e.charCodeAt(n);return{data:i,format:s}}default:throw new this.FS.ErrnoError(this.ERRNO_CODES.ENOENT)}}put(e,t){switch(t.format){case"json":case"text":return this.request({method:"put",path:this.normalizePath(e),data:{format:t.format,data:Pu.decode(t.data)}});case"base64":{let n="";for(let e=0;e<t.data.byteLength;e++)n+=String.fromCharCode(t.data[e]);return this.request({method:"put",path:this.normalizePath(e),data:{format:t.format,data:btoa(n)}})}}}getattr(e){let t=this.request({method:"getattr",path:this.normalizePath(e)}),n=new Date(0);return t.atime=t.atime?new Date(t.atime):n,t.mtime=t.mtime?new Date(t.mtime):n,t.ctime=t.ctime?new Date(t.ctime):n,t.size=t.size||0,t}normalizePath(e){return e.startsWith(this._mountpoint)&&(e=e.slice(this._mountpoint.length)),this._driveName&&(e=`${this._driveName}${Ao}${e}`),e}},zn=class extends Kn{constructor(e){super(e),this._baseUrl=e.baseUrl,this._browsingContextId=e.browsingContextId||""}request(e){let t=new XMLHttpRequest;t.open("POST",encodeURI(this.endpoint),!1);let n=Uo.UUID.uuid4(),s={data:{...e,requestId:n},browsingContextId:this._browsingContextId,requestId:n};try{t.send(JSON.stringify(s))}catch(e){console.error(e)}if(t.status>=400)throw new this.FS.ErrnoError(this.ERRNO_CODES.EINVAL);return JSON.parse(t.responseText)}get endpoint(){return`${this._baseUrl}api/drive`}},Dt=class{constructor(e){this.FS=e.FS,this.PATH=e.PATH,this.ERRNO_CODES=e.ERRNO_CODES,this.API=this.createAPI(e),this.driveName=e.driveName,this.node_ops=new Fn(this),this.stream_ops=new xn(this)}createAPI(e){if(!e.browsingContextId||!e.baseUrl)throw new Error("Cannot create service-worker API without current browsingContextId");return new zn(e)}mount(e){return this.createNode(null,e.mountpoint,16895,0)}createNode(e,t,n,s){let i=this.FS;if(!i.isDir(n)&&!i.isFile(n))throw new i.ErrnoError(this.ERRNO_CODES.EINVAL);let r=i.createNode(e,t,n,s);return r.node_ops=this.node_ops,r.stream_ops=this.stream_ops,r}getMode(e){return this.API.getmode(e)}realPath(e){let t=[],n=e;for(t.push(n.name);n.parent!==n;)n=n.parent,t.push(n.name);return t.reverse(),this.PATH.join.apply(null,t)}}})),ir=Symbol("Comlink.proxy"),ea=Symbol("Comlink.endpoint"),ta=Symbol("Comlink.releaseProxy"),$n=Symbol("Comlink.finalizer"),jt=Symbol("Comlink.thrown"),or=e=>"object"==typeof e&&null!==e||"function"==typeof e,na={canHandle:e=>or(e)&&e[ir],serialize(e){let{port1:t,port2:n}=new MessageChannel;return Nt(e,t),[n,[n]]},deserialize:e=>(e.start(),oa(e))},sa={canHandle:e=>or(e)&&jt in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},ar=new Map([["proxy",na],["throw",sa]]);function ra(e,t){for(let n of e)if(t===n||"*"===n||n instanceof RegExp&&n.test(t))return!0;return!1}function Nt(e,t=globalThis,n=["*"]){t.addEventListener("message",(function s(i){if(!i||!i.data)return;if(!ra(n,i.origin))return void console.warn(`Invalid origin '${i.origin}' for comlink proxy`);let r,{id:o,type:a,path:l}=Object.assign({path:[]},i.data),h=(i.data.argumentList||[]).map(We);try{let t=l.slice(0,-1).reduce(((e,t)=>e[t]),e),n=l.reduce(((e,t)=>e[t]),e);switch(a){case"GET":r=n;break;case"SET":t[l.slice(-1)[0]]=We(i.data.value),r=!0;break;case"APPLY":r=n.apply(t,h);break;case"CONSTRUCT":r=ha(new n(...h));break;case"ENDPOINT":{let{port1:t,port2:n}=new MessageChannel;Nt(e,n),r=ua(t,[t])}break;case"RELEASE":r=void 0;break;default:return}}catch(e){r={value:e,[jt]:0}}Promise.resolve(r).catch((e=>({value:e,[jt]:0}))).then((n=>{let[i,r]=At(n);t.postMessage(Object.assign(Object.assign({},i),{id:o}),r),"RELEASE"===a&&(t.removeEventListener("message",s),lr(t),$n in e&&"function"==typeof e[$n]&&e[$n]())})).catch((e=>{let[n,s]=At({value:new TypeError("Unserializable return value"),[jt]:0});t.postMessage(Object.assign(Object.assign({},n),{id:o}),s)}))})),t.start&&t.start()}function ia(e){return"MessagePort"===e.constructor.name}function lr(e){ia(e)&&e.close()}function oa(e,t){let n=new Map;return e.addEventListener("message",(function(e){let{data:t}=e;if(!t||!t.id)return;let s=n.get(t.id);if(s)try{s(t)}finally{n.delete(t.id)}})),Hn(e,n,[],t)}function qt(e){if(e)throw new Error("Proxy has been released and is not useable")}function cr(e){return Xe(e,new Map,{type:"RELEASE"}).then((()=>{lr(e)}))}var Tt=new WeakMap,Ut="FinalizationRegistry"in globalThis&&new FinalizationRegistry((e=>{let t=(Tt.get(e)||0)-1;Tt.set(e,t),0===t&&cr(e)}));function aa(e,t){let n=(Tt.get(t)||0)+1;Tt.set(t,n),Ut&&Ut.register(e,t,e)}function la(e){Ut&&Ut.unregister(e)}function Hn(e,t,n=[],s=function(){}){let i=!1,r=new Proxy(s,{get(s,o){if(qt(i),o===ta)return()=>{la(r),cr(e),t.clear(),i=!0};if("then"===o){if(0===n.length)return{then:()=>r};let s=Xe(e,t,{type:"GET",path:n.map((e=>e.toString()))}).then(We);return s.then.bind(s)}return Hn(e,t,[...n,o])},set(s,r,o){qt(i);let[a,l]=At(o);return Xe(e,t,{type:"SET",path:[...n,r].map((e=>e.toString())),value:a},l).then(We)},apply(s,r,o){qt(i);let a=n[n.length-1];if(a===ea)return Xe(e,t,{type:"ENDPOINT"}).then(We);if("bind"===a)return Hn(e,t,n.slice(0,-1));let[l,h]=rr(o);return Xe(e,t,{type:"APPLY",path:n.map((e=>e.toString())),argumentList:l},h).then(We)},construct(s,r){qt(i);let[o,a]=rr(r);return Xe(e,t,{type:"CONSTRUCT",path:n.map((e=>e.toString())),argumentList:o},a).then(We)}});return aa(r,e),r}function ca(e){return Array.prototype.concat.apply([],e)}function rr(e){let t=e.map(At);return[t.map((e=>e[0])),ca(t.map((e=>e[1])))]}var ur=new WeakMap;function ua(e,t){return ur.set(e,t),e}function ha(e){return Object.assign(e,{[ir]:!0})}function At(e){for(let[t,n]of ar)if(n.canHandle(e)){let[s,i]=n.serialize(e);return[{type:"HANDLER",name:t,value:s},i]}return[{type:"RAW",value:e},ur.get(e)||[]]}function We(e){switch(e.type){case"HANDLER":return ar.get(e.name).deserialize(e.value);case"RAW":return e.value}}function Xe(e,t,n,s){return new Promise((i=>{let r=da();t.set(r,i),e.start&&e.start(),e.postMessage(Object.assign({id:r},n),s)}))}function da(){return new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-")}var Lo=Wn(te()),xo=Wn(Ae());tr();var Vn=class{constructor(){this._options=null,this._initializer=null,this._pyodide=null,this._localPath="",this._driveName="",this._driveFS=null,this._sendWorkerMessage=()=>{},this._logMessage=()=>{},this._initialized=new Promise(((e,t)=>{this._initializer={resolve:e,reject:t}}))}async initialize(e){var t;if(this._options=e,e.location.includes(":")){let t=e.location.split(":");this._driveName=t[0],this._localPath=t[1]}else this._driveName="",this._localPath=e.location;await this.initRuntime(e),await this.initFilesystem(e),await this.initPackageManager(e),await this.initKernel(e),await this.initGlobals(e),null==(t=this._initializer)||t.resolve()}async initRuntime(e){let t,{pyodideUrl:n,indexUrl:s}=e;n.endsWith(".mjs")?t=(await __webpack_require__(476)(n)).loadPyodide:(importScripts(n),t=self.loadPyodide),this._pyodide=await t({indexURL:s,stdout:e=>{console.log(e),this._logMessage({type:"text",level:"info",data:e})},stderr:e=>{console.error(e),this._logMessage({type:"text",level:"critical",data:e})},...e.loadPyodideOptions}),this._pyodide._api.on_fatal=async e=>{let t="";t="Exit"===e.name?"Pyodide has exited and can no longer be used.":`Pyodide has suffered a fatal error. Please report this to the Pyodide maintainers.\nThe cause of the error was: ${e.name}\n${e.message}\nStack trace:\n${e.stack}`,this._logMessage({type:"text",level:"critical",data:t})}}async initPackageManager(e){if(!this._options)throw new Error("Uninitialized");let{pipliteWheelUrl:t,disablePyPIFallback:n,pipliteUrls:s,loadPyodideOptions:i}=this._options,r=(i||{}).packages||[];r.includes("micropip")||await this._pyodide.loadPackage(["micropip"]),r.includes("piplite")||await this._pyodide.runPythonAsync(`\n      import micropip\n      await micropip.install('${t}', keep_going=True)\n    `),await this._pyodide.runPythonAsync(`\n      import piplite.piplite\n      piplite.piplite._PIPLITE_DISABLE_PYPI = ${n?"True":"False"}\n      piplite.piplite._PIPLITE_URLS = ${JSON.stringify(s)}\n    `)}async initKernel(e){let t=(e.loadPyodideOptions||{}).packages||[],n=["sqlite3","ipykernel","comm","pyodide_kernel","jedi","ipython"],s=[];for(let e of n)t.includes(e)||s.push(`await piplite.install('${e}', keep_going=True)`);s.push("import pyodide_kernel"),e.mountDrive&&this._localPath&&s.push("import os",`os.chdir("${this._localPath}")`),await this._pyodide.runPythonAsync(s.join("\n"))}async initGlobals(e){let{globals:t}=this._pyodide;this._kernel=t.get("pyodide_kernel").kernel_instance.copy(),this._stdout_stream=t.get("pyodide_kernel").stdout_stream.copy(),this._stderr_stream=t.get("pyodide_kernel").stderr_stream.copy(),this._interpreter=this._kernel.interpreter.copy(),this._interpreter.send_comm=this.sendComm.bind(this)}async initFilesystem(e){if(e.mountDrive){let t="/drive",{FS:n,PATH:s,ERRNO_CODES:i}=this._pyodide,{baseUrl:r}=e,{DriveFS:o}=await Promise.resolve().then((()=>(tr(),No))),a=new o({FS:n,PATH:s,ERRNO_CODES:i,baseUrl:r,driveName:this._driveName,mountpoint:t,browsingContextId:this._browsingContextId});n.mkdirTree(t),n.mount(a,{},t),n.chdir(t),this._driveFS=a}}mapToObject(e){let t=e instanceof Array?[]:{},n=e instanceof Map?e.entries():Object.entries(e);for(let[e,s]of n)t[e]=s instanceof Map||s instanceof Array?this.mapToObject(s):s;return t}formatResult(e){if(!(e instanceof this._pyodide.ffi.PyProxy))return e;let t=e.toJs();return this.mapToObject(t)}registerWorkerMessageCallback(e){this._sendWorkerMessage=e}registerLogMessageCallback(e){this._logMessage=e}async setup(e){await this._initialized,this._kernel._parent_header=this._pyodide.toPy(e)}async execute(e,t){await this.setup(t);let n=(e,t)=>{let n={name:this.formatResult(e),text:this.formatResult(t)};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:n,type:"stream"})};this._stdout_stream.publish_stream_callback=n,this._stderr_stream.publish_stream_callback=n,this._interpreter.display_pub.clear_output_callback=e=>{let t={wait:this.formatResult(e)};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:t,type:"clear_output"})},this._interpreter.display_pub.display_data_callback=(e,t,n)=>{let s={data:this.formatResult(e),metadata:this.formatResult(t),transient:this.formatResult(n)};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:s,type:"display_data"})},this._interpreter.display_pub.update_display_data_callback=(e,t,n)=>{let s={data:this.formatResult(e),metadata:this.formatResult(t),transient:this.formatResult(n)};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:s,type:"update_display_data"})},this._interpreter.displayhook.publish_execution_result=(e,t,n)=>{let s={execution_count:e,data:this.formatResult(t),metadata:this.formatResult(n)};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:s,type:"execute_result"})},this._interpreter.input=this.input.bind(this),this._interpreter.getpass=this.getpass.bind(this);let s=await this._kernel.run(e.code),i=this.formatResult(s);return"error"===i.status&&((e,t,n)=>{let s={ename:e,evalue:t,traceback:n};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:s,type:"execute_error"})})(i.ename,i.evalue,i.traceback),i}async complete(e,t){await this.setup(t);let n=this._kernel.complete(e.code,e.cursor_pos);return this.formatResult(n)}async inspect(e,t){await this.setup(t);let n=this._kernel.inspect(e.code,e.cursor_pos,e.detail_level);return this.formatResult(n)}async isComplete(e,t){await this.setup(t);let n=this._kernel.is_complete(e.code);return this.formatResult(n)}async commInfo(e,t){await this.setup(t);let n=this._kernel.comm_info(e.target_name);return{comms:this.formatResult(n),status:"ok"}}async commOpen(e,t){await this.setup(t);let n=this._kernel.comm_manager.comm_open(this._pyodide.toPy(null),this._pyodide.toPy(null),this._pyodide.toPy(e));return this.formatResult(n)}async commMsg(e,t){await this.setup(t);let n=this._kernel.comm_manager.comm_msg(this._pyodide.toPy(null),this._pyodide.toPy(null),this._pyodide.toPy(e));return this.formatResult(n)}async commClose(e,t){await this.setup(t);let n=this._kernel.comm_manager.comm_close(this._pyodide.toPy(null),this._pyodide.toPy(null),this._pyodide.toPy(e));return this.formatResult(n)}async inputReply(e,t){}getpass(e){return e=void 0===e?"":e,this.sendInputRequest(e,!0)}input(e){return e=void 0===e?"":e,this.sendInputRequest(e,!1)}async sendComm(e,t,n,s,i){this._sendWorkerMessage({type:e,content:this.formatResult(t),metadata:this.formatResult(n),ident:this.formatResult(s),buffers:this.formatResult(i),parentHeader:this.formatResult(this._kernel._parent_header).header})}},nr=class extends Vn{constructor(){super(),this._sendWorkerMessage=e=>{postMessage({_kernelMessage:e})},this._logMessage=e=>{postMessage({_logMessage:e})}}async initFilesystem(e){if(e.mountDrive){let t="/drive",{FS:n,PATH:s,ERRNO_CODES:i}=this._pyodide,{baseUrl:r,browsingContextId:o}=e,a=new Dt({FS:n,PATH:s,ERRNO_CODES:i,baseUrl:r,driveName:this._driveName,mountpoint:t,browsingContextId:o});n.mkdirTree(t),n.mount(a,{},t),n.chdir(t),this._driveFS=a}}sendInputRequest(e,t){var n,s;let i=this.formatResult(this._kernel._parent_header).header,r=xo.KernelMessage.createMessage({channel:"stdin",msgType:"input_request",session:null!=(n=null==i?void 0:i.session)?n:"",parentHeader:i,content:{prompt:e,password:t}});try{if(!this._options)throw new Error("Kernel options not set");let{baseUrl:e,browsingContextId:t}=this._options;if(!t)throw new Error("Kernel browsingContextId not set");let n=new XMLHttpRequest,i=Lo.URLExt.join(e,"/api/stdin/kernel");n.open("POST",i,!1);let o=JSON.stringify({browsingContextId:t,data:r});n.send(o);let a=JSON.parse(n.response);if("error"in a)throw new Error(a.error);return null==(s=a.content)?void 0:s.value}catch(e){return void console.warn(`Failed to request stdin via service worker: ${e}`)}}},Mu=new nr;Nt(Mu)},820:(e,t,n)=>{"use strict";n.r(t),n.d(t,{PIPLITE_INDEX_SCHEMA:()=>k,PyodideCoincidentKernel:()=>f.G,PyodideComlinkKernel:()=>m.a,PyodideKernel:()=>S,PyodideRemoteKernel:()=>C,SharedBufferContentsAPI:()=>f.U,allJSONUrl:()=>i,ipykernelWheelUrl:()=>o,pipliteWheelUrl:()=>l,pyodide_kernelWheelUrl:()=>u,widgetsnbextensionWheelUrl:()=>c,widgetsnbextensionWheelUrl1:()=>_});const s=n.p+"pypi/all.json";var i=n.t(s);const r=n.p+"pypi/ipykernel-6.9.2-py3-none-any.whl";var o=n.t(r);const a=n.p+"pypi/piplite-0.7.0-py3-none-any.whl";var l=n.t(a);const h=n.p+"pypi/pyodide_kernel-0.7.0-py3-none-any.whl";var u=n.t(h);const d=n.p+"pypi/widgetsnbextension-3.6.999-py3-none-any.whl";var c=n.t(d);const p=n.p+"pypi/widgetsnbextension-4.0.999-py3-none-any.whl";var _=n.t(p),f=n(620),m=n(352),g=n(32),v=n(83),y=n(464),w=n(872),b=n(452);class S extends b.BaseKernel{constructor(e){super(e),this._ready=new y.PromiseDelegate,this._inputDelegate=new y.PromiseDelegate,this._worker=this.initWorker(e),this._remoteKernel=this.initRemote(e),this._contentsManager=e.contentsManager,this._logger=e.logger||(()=>{})}initWorker(e){return crossOriginIsolated?new Worker(new URL(n.p+n.u(620),n.b),{type:void 0}):new Worker(new URL(n.p+n.u(352),n.b),{type:void 0})}initRemote(e){let t;crossOriginIsolated?(t=(0,g.c)(this._worker),t.processLogMessage=this._processLogMessage.bind(this),t.processWorkerMessage=this._processWorkerMessage.bind(this),t.processDriveRequest=async e=>{if(!b.DriveContentsProcessor)throw new Error("File system calls over Atomics.wait is only supported with jupyterlite>=0.4.0a3");return void 0===this._contentsProcessor&&(this._contentsProcessor=new b.DriveContentsProcessor({contentsManager:this._contentsManager})),await this._contentsProcessor.processDriveRequest(e)},t.processStdinRequest=async e=>{const t={type:"input_request",content:e};return this._processWorkerMessage(t),this._inputDelegate=new y.PromiseDelegate,await this._inputDelegate.promise}):(t=(0,v.em)(this._worker),this._worker.addEventListener("message",(e=>{var t,n;void 0!==(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t._kernelMessage)?this._processWorkerMessage(e.data._kernelMessage):void 0!==(null===(n=null==e?void 0:e.data)||void 0===n?void 0:n._logMessage)&&this._processLogMessage(e.data._logMessage)})));const n=this.initRemoteOptions(e);return t.initialize(n).then(this._ready.resolve.bind(this._ready)).catch((e=>{this._logger({payload:{type:"text",level:"critical",data:e.message},kernelId:this.id}),this._ready.reject(e.message)})),t}initRemoteOptions(e){const{pyodideUrl:t}=e,n=t.slice(0,t.lastIndexOf("/")+1),i=w.PageConfig.getBaseUrl(),r=[...e.pipliteUrls||[],s],o=!!e.disablePyPIFallback;return{baseUrl:i,pyodideUrl:t,indexUrl:n,pipliteWheelUrl:e.pipliteWheelUrl||a,pipliteUrls:r,disablePyPIFallback:o,location:this.location,mountDrive:e.mountDrive,loadPyodideOptions:e.loadPyodideOptions||{},browsingContextId:e.browsingContextId,kernelId:this.id}}dispose(){if(!this.isDisposed){try{this._ready.reject(`${this.id} was disposed`)}catch(e){}this._worker.terminate(),this._worker=null,super.dispose()}}get ready(){return this._ready.promise}_processLogMessage(e){this._logger({payload:e,kernelId:this.id})}_processWorkerMessage(e){var t,n,s,i,r,o,a;if(e.type)switch(e.type){case"stream":{const n=null!==(t=e.bundle)&&void 0!==t?t:{name:"stdout",text:""};this.stream(n,e.parentHeader);break}case"input_request":{const t=null!==(n=e.content)&&void 0!==n?n:{prompt:"",password:!1};this.inputRequest(t,e.parentHeader);break}case"display_data":{const t=null!==(s=e.bundle)&&void 0!==s?s:{data:{},metadata:{},transient:{}};this.displayData(t,e.parentHeader);break}case"update_display_data":{const t=null!==(i=e.bundle)&&void 0!==i?i:{data:{},metadata:{},transient:{}};this.updateDisplayData(t,e.parentHeader);break}case"clear_output":{const t=null!==(r=e.bundle)&&void 0!==r?r:{wait:!1};this.clearOutput(t,e.parentHeader);break}case"execute_result":{const t=null!==(o=e.bundle)&&void 0!==o?o:{execution_count:0,data:{},metadata:{}};this.publishExecuteResult(t,e.parentHeader);break}case"execute_error":{const t=null!==(a=e.bundle)&&void 0!==a?a:{ename:"",evalue:"",traceback:[]};this.publishExecuteError(t,e.parentHeader);break}case"comm_msg":case"comm_open":case"comm_close":this.handleComm(e.type,e.content,e.metadata,e.buffers,e.parentHeader)}}async kernelInfoRequest(){return{implementation:"pyodide",implementation_version:"0.1.0",language_info:{codemirror_mode:{name:"python",version:3},file_extension:".py",mimetype:"text/x-python",name:"python",nbconvert_exporter:"python",pygments_lexer:"ipython3",version:"3.8"},protocol_version:"5.3",status:"ok",banner:"A WebAssembly-powered Python kernel backed by Pyodide",help_links:[{text:"Python (WASM) Kernel",url:"https://pyodide.org"}]}}async executeRequest(e){await this.ready;const t=await this._remoteKernel.execute(e,this.parent);return t.execution_count=this.executionCount,t}async completeRequest(e){return await this._remoteKernel.complete(e,this.parent)}async inspectRequest(e){return await this._remoteKernel.inspect(e,this.parent)}async isCompleteRequest(e){return await this._remoteKernel.isComplete(e,this.parent)}async commInfoRequest(e){return await this._remoteKernel.commInfo(e,this.parent)}async commOpen(e){return await this._remoteKernel.commOpen(e,this.parent)}async commMsg(e){return await this._remoteKernel.commMsg(e,this.parent)}async commClose(e){return await this._remoteKernel.commClose(e,this.parent)}async inputReply(e){const t="value"in e?e.value:void 0;this._inputDelegate.resolve(t)}}const P=n.p+"schema/piplite.v0.schema.json";var k=n.t(P);class C{constructor(){this._options=null,this._initializer=null,this._pyodide=null,this._localPath="",this._driveName="",this._driveFS=null,this._sendWorkerMessage=()=>{},this._logMessage=()=>{},this._initialized=new Promise(((e,t)=>{this._initializer={resolve:e,reject:t}}))}async initialize(e){var t;if(this._options=e,e.location.includes(":")){const t=e.location.split(":");this._driveName=t[0],this._localPath=t[1]}else this._driveName="",this._localPath=e.location;await this.initRuntime(e),await this.initFilesystem(e),await this.initPackageManager(e),await this.initKernel(e),await this.initGlobals(e),null===(t=this._initializer)||void 0===t||t.resolve()}async initRuntime(e){const{pyodideUrl:t,indexUrl:n}=e;let s;t.endsWith(".mjs")?s=(await import(t)).loadPyodide:(importScripts(t),s=self.loadPyodide),this._pyodide=await s({indexURL:n,stdout:e=>{console.log(e),this._logMessage({type:"text",level:"info",data:e})},stderr:e=>{console.error(e),this._logMessage({type:"text",level:"critical",data:e})},...e.loadPyodideOptions}),this._pyodide._api.on_fatal=async e=>{let t="";t="Exit"===e.name?"Pyodide has exited and can no longer be used.":`Pyodide has suffered a fatal error. Please report this to the Pyodide maintainers.\nThe cause of the error was: ${e.name}\n${e.message}\nStack trace:\n${e.stack}`,this._logMessage({type:"text",level:"critical",data:t})}}async initPackageManager(e){if(!this._options)throw new Error("Uninitialized");const{pipliteWheelUrl:t,disablePyPIFallback:n,pipliteUrls:s,loadPyodideOptions:i}=this._options,r=(i||{}).packages||[];r.includes("micropip")||await this._pyodide.loadPackage(["micropip"]),r.includes("piplite")||await this._pyodide.runPythonAsync(`\n      import micropip\n      await micropip.install('${t}', keep_going=True)\n    `),await this._pyodide.runPythonAsync(`\n      import piplite.piplite\n      piplite.piplite._PIPLITE_DISABLE_PYPI = ${n?"True":"False"}\n      piplite.piplite._PIPLITE_URLS = ${JSON.stringify(s)}\n    `)}async initKernel(e){const t=(e.loadPyodideOptions||{}).packages||[],n=["sqlite3","ipykernel","comm","pyodide_kernel","jedi","ipython"],s=[];for(const e of n)t.includes(e)||s.push(`await piplite.install('${e}', keep_going=True)`);s.push("import pyodide_kernel"),e.mountDrive&&this._localPath&&s.push("import os",`os.chdir("${this._localPath}")`),await this._pyodide.runPythonAsync(s.join("\n"))}async initGlobals(e){const{globals:t}=this._pyodide;this._kernel=t.get("pyodide_kernel").kernel_instance.copy(),this._stdout_stream=t.get("pyodide_kernel").stdout_stream.copy(),this._stderr_stream=t.get("pyodide_kernel").stderr_stream.copy(),this._interpreter=this._kernel.interpreter.copy(),this._interpreter.send_comm=this.sendComm.bind(this)}async initFilesystem(e){if(e.mountDrive){const t="/drive",{FS:s,PATH:i,ERRNO_CODES:r}=this._pyodide,{baseUrl:o}=e,{DriveFS:a}=await n.e(476).then(n.bind(n,96)),l=new a({FS:s,PATH:i,ERRNO_CODES:r,baseUrl:o,driveName:this._driveName,mountpoint:t,browsingContextId:this._browsingContextId});s.mkdirTree(t),s.mount(l,{},t),s.chdir(t),this._driveFS=l}}mapToObject(e){const t=e instanceof Array?[]:{},n=e instanceof Map?e.entries():Object.entries(e);for(const[e,s]of n)t[e]=s instanceof Map||s instanceof Array?this.mapToObject(s):s;return t}formatResult(e){if(!(e instanceof this._pyodide.ffi.PyProxy))return e;const t=e.toJs();return this.mapToObject(t)}registerWorkerMessageCallback(e){this._sendWorkerMessage=e}registerLogMessageCallback(e){this._logMessage=e}async setup(e){await this._initialized,this._kernel._parent_header=this._pyodide.toPy(e)}async execute(e,t){await this.setup(t);const n=(e,t)=>{const n={name:this.formatResult(e),text:this.formatResult(t)};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:n,type:"stream"})};this._stdout_stream.publish_stream_callback=n,this._stderr_stream.publish_stream_callback=n,this._interpreter.display_pub.clear_output_callback=e=>{const t={wait:this.formatResult(e)};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:t,type:"clear_output"})},this._interpreter.display_pub.display_data_callback=(e,t,n)=>{const s={data:this.formatResult(e),metadata:this.formatResult(t),transient:this.formatResult(n)};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:s,type:"display_data"})},this._interpreter.display_pub.update_display_data_callback=(e,t,n)=>{const s={data:this.formatResult(e),metadata:this.formatResult(t),transient:this.formatResult(n)};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:s,type:"update_display_data"})},this._interpreter.displayhook.publish_execution_result=(e,t,n)=>{const s={execution_count:e,data:this.formatResult(t),metadata:this.formatResult(n)};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:s,type:"execute_result"})},this._interpreter.input=this.input.bind(this),this._interpreter.getpass=this.getpass.bind(this);const s=await this._kernel.run(e.code),i=this.formatResult(s);return"error"===i.status&&((e,t,n)=>{const s={ename:e,evalue:t,traceback:n};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:s,type:"execute_error"})})(i.ename,i.evalue,i.traceback),i}async complete(e,t){await this.setup(t);const n=this._kernel.complete(e.code,e.cursor_pos);return this.formatResult(n)}async inspect(e,t){await this.setup(t);const n=this._kernel.inspect(e.code,e.cursor_pos,e.detail_level);return this.formatResult(n)}async isComplete(e,t){await this.setup(t);const n=this._kernel.is_complete(e.code);return this.formatResult(n)}async commInfo(e,t){await this.setup(t);const n=this._kernel.comm_info(e.target_name);return{comms:this.formatResult(n),status:"ok"}}async commOpen(e,t){await this.setup(t);const n=this._kernel.comm_manager.comm_open(this._pyodide.toPy(null),this._pyodide.toPy(null),this._pyodide.toPy(e));return this.formatResult(n)}async commMsg(e,t){await this.setup(t);const n=this._kernel.comm_manager.comm_msg(this._pyodide.toPy(null),this._pyodide.toPy(null),this._pyodide.toPy(e));return this.formatResult(n)}async commClose(e,t){await this.setup(t);const n=this._kernel.comm_manager.comm_close(this._pyodide.toPy(null),this._pyodide.toPy(null),this._pyodide.toPy(e));return this.formatResult(n)}async inputReply(e,t){}getpass(e){return e=void 0===e?"":e,this.sendInputRequest(e,!0)}input(e){return e=void 0===e?"":e,this.sendInputRequest(e,!1)}async sendComm(e,t,n,s,i){this._sendWorkerMessage({type:e,content:this.formatResult(t),metadata:this.formatResult(n),ident:this.formatResult(s),buffers:this.formatResult(i),parentHeader:this.formatResult(this._kernel._parent_header).header})}}},476:e=>{function t(e){return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}t.keys=()=>[],t.resolve=t,t.id=476,e.exports=t}}]);
//# sourceMappingURL=872.f17f191475f1bffc07d4.js.map?v=f17f191475f1bffc07d4