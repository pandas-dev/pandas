from collections.abc import Iterable, Iterator
from typing import Any, Generic
from typing_extensions import TypeVar

import numpy as np
import optype as op

# Only the existence of `__hash__` is required. However, in numpy < 2.1 the
# `__hash__` method is missing from numpy stubs on scalar values. Allowing
# `np.generic` fixes this for older numpy versions.
_T = TypeVar("_T", bound=op.CanHash | np.generic, default=Any)

class DisjointSet(Generic[_T]):
    n_subsets: int

    def __init__(self, /, elements: Iterable[_T] | None = None) -> None: ...
    def __iter__(self, /) -> Iterator[_T]: ...
    def __len__(self, /) -> int: ...
    def __contains__(self, x: object, /) -> bool: ...
    def __getitem__(self, x: _T, /) -> _T: ...
    def add(self, /, x: _T) -> None: ...
    def merge(self, /, x: _T, y: _T) -> bool: ...
    def connected(self, /, x: _T, y: _T) -> bool: ...
    def subset(self, /, x: _T) -> set[_T]: ...
    def subset_size(self, /, x: _T) -> int: ...
    def subsets(self, /) -> list[set[_T]]: ...
