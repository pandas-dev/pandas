# TODO: This should replace build_pandas/action.yml once Pixi is used for all environments
name: Build pandas
description: Rebuilds the C extensions and installs pandas
inputs:
  editable:
    description: Whether to build pandas in editable mode (default true)
    default: true
  werror:
    description: Enable werror flag for build
    default: true
runs:
  using: composite
  steps:

    - name: Environment Detail
      run: pixi list
      shell: bash -euox pipefail {0}

    - name: Uninstall existing Pandas installation
      run: |
        if pip show pandas 1>/dev/null; then
          pip uninstall -y pandas
        fi
      shell: pixi run bash -euox pipefail {0}

    - name: Build Pandas
      run: |
        if [[ ${{ inputs.editable }} ]]; then
          INSTALL_TARGET="--editable ."
        else
          INSTALL_TARGET="."
        fi
        if [[ ${{ inputs.werror }} ]]; then
          WERROR='-Csetup-args="--werror"'
        else
          WERROR=""
        fi
        pip install $INSTALL_TARGET --no-build-isolation -v --no-deps $WERROR
      shell: pixi run bash -euox pipefail {0}
