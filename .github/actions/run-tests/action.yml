name: Run tests and report results
description: Run pytest and upload the results to Codecov
runs:
  using: composite
  steps:
    - name: Test
      run: ci/run_tests.sh
      shell: pixi run bash -euox pipefail {0}

    - name: Publish test results
      uses: actions/upload-artifact@v4
      with:
        name: Test results
        path: test-data.xml
      if: failure()

    - name: Upload coverage to Codecov
      uses: codecov/codecov-action@v5
      with:
        flags: unittests
        name: codecov-pandas
        fail_ci_if_error: false
      if: failure()
