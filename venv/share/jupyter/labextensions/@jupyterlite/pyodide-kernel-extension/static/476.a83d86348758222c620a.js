"use strict";(self.webpackChunk_jupyterlite_pyodide_kernel_extension=self.webpackChunk_jupyterlite_pyodide_kernel_extension||[]).push([[476],{96:(t,e,s)=>{s.d(e,{DriveFS:()=>m});var r=s(464);const i=new TextEncoder,n=new TextDecoder("utf-8"),o={0:!1,1:!0,2:!0,64:!0,65:!0,66:!0,129:!0,193:!0,514:!0,577:!0,578:!0,705:!0,706:!0,1024:!0,1025:!0,1026:!0,1089:!0,1090:!0,1153:!0,1154:!0,1217:!0,1218:!0,4096:!0,4098:!0};class a{constructor(t){this.fs=t}open(t){var e;const s=this.fs.realPath(t.node);if(this.fs.FS.isFile(t.node.mode))try{const e=this.fs.API.get(s);t.file=e}catch(r){const i=null!==(e=t.flags)&&void 0!==e?e:t.shared.flags;let n="string"==typeof i?parseInt(i,10):i;n&=8191;let a=!0;if(n in o&&(a=o[n]),!a)throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.ENOENT);{t.node=this.fs.node_ops.mknod(t.node.parent,t.node.name,t.node.mode,0);const e=this.fs.API.get(s);t.file=e}}}close(t){var e;if(!this.fs.FS.isFile(t.node.mode)||!t.file)return;const s=this.fs.realPath(t.node),r=null!==(e=t.flags)&&void 0!==e?e:t.shared.flags;let i="string"==typeof r?parseInt(r,10):r;i&=8191;let n=!0;i in o&&(n=o[i]),n&&this.fs.API.put(s,t.file),t.file=void 0}read(t,e,s,r,i){if(r<=0||void 0===t.file||i>=(t.file.data.length||0))return 0;const n=Math.min(t.file.data.length-i,r);return e.set(t.file.data.subarray(i,i+n),s),n}write(t,e,s,r,i){var n;if(r<=0||void 0===t.file)return 0;const o=Date.now();if(t.node.timestamp=o,t.node.atime=o,t.node.mtime=o,t.node.ctime=o,i+r>((null===(n=t.file)||void 0===n?void 0:n.data.length)||0)){const e=t.file.data?t.file.data:new Uint8Array;t.file.data=new Uint8Array(i+r),t.file.data.set(e)}return t.file.data.set(e.subarray(s,s+r),i),r}llseek(t,e,s){var r;let i=e;if(1===s)i+=null!==(r=t.position)&&void 0!==r?r:t.shared.position;else if(2===s&&this.fs.FS.isFile(t.node.mode)){if(void 0===t.file)throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EPERM);i+=t.file.data.length}if(i<0)throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EINVAL);return i}}class h{constructor(t){this.node=t=>function(t){return"node"in t}(t)?t.node:t,this.getattr=t=>{const e=this.node(t);return{...this.fs.API.getattr(this.fs.realPath(e)),mode:e.mode,ino:e.id}},this.setattr=(t,e)=>{const s=this.node(t);for(const[t,r]of Object.entries(e))switch(t){case"mode":s.mode=r;break;case"timestamp":s.timestamp=r;break;case"atime":s.atime=r;break;case"mtime":s.mtime=r;break;case"ctime":s.ctime=r;break;case"size":{const t=r,e=this.fs.realPath(s);if(this.fs.FS.isFile(s.mode)&&t>=0){let s;try{s=this.fs.API.get(e)}catch(t){break}const r=s.data?s.data:new Uint8Array;t!==r.length&&(t<r.length?s.data=s.data.slice(0,t):(s.data=new Uint8Array(t),s.data.set(r)),this.fs.API.put(e,s))}else console.warn("setattr size of",t,"on",s,"not yet implemented");break}case"dontFollow":break;default:console.warn("setattr",t,"of",r,"on",s,"not yet implemented")}},this.lookup=(t,e)=>{const s=this.node(t),r=this.fs.PATH.join2(this.fs.realPath(s),e),i=this.fs.API.lookup(r);if(!i.ok)throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.ENOENT);return this.fs.createNode(s,e,i.mode,0)},this.mknod=(t,e,s,r)=>{const i=this.node(t),n=this.fs.PATH.join2(this.fs.realPath(i),e);return this.fs.API.mknod(n,s),this.fs.createNode(i,e,s,r)},this.rename=(t,e,s)=>{const r=this.node(t),i=this.node(e);this.fs.API.rename(r.parent?this.fs.PATH.join2(this.fs.realPath(r.parent),r.name):r.name,this.fs.PATH.join2(this.fs.realPath(i),s)),r.name=s,r.parent=i},this.unlink=(t,e)=>this.fs.API.rmdir(this.fs.PATH.join2(this.fs.realPath(this.node(t)),e)),this.rmdir=(t,e)=>this.fs.API.rmdir(this.fs.PATH.join2(this.fs.realPath(this.node(t)),e)),this.readdir=t=>this.fs.API.readdir(this.fs.realPath(this.node(t))),this.symlink=(t,e,s)=>{throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EPERM)},this.readlink=t=>{throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EINVAL)},this.fs=t}}class d{constructor(t){this._driveName=t.driveName,this._mountpoint=t.mountpoint,this.FS=t.FS,this.ERRNO_CODES=t.ERRNO_CODES}lookup(t){return this.request({method:"lookup",path:this.normalizePath(t)})}getmode(t){return this.request({method:"getmode",path:this.normalizePath(t)})}mknod(t,e){return this.request({method:"mknod",path:this.normalizePath(t),data:{mode:e}})}rename(t,e){return this.request({method:"rename",path:this.normalizePath(t),data:{newPath:this.normalizePath(e)}})}readdir(t){const e=this.request({method:"readdir",path:this.normalizePath(t)});return e.push("."),e.push(".."),e}rmdir(t){return this.request({method:"rmdir",path:this.normalizePath(t)})}get(t){const e=this.request({method:"get",path:this.normalizePath(t)});if(!e)throw new this.FS.ErrnoError(this.ERRNO_CODES.ENOENT);const s=e.content,r=e.format;switch(r){case"json":case"text":return{data:i.encode(s),format:r};case"base64":{const t=atob(s),e=t.length,i=new Uint8Array(e);for(let s=0;s<e;s++)i[s]=t.charCodeAt(s);return{data:i,format:r}}default:throw new this.FS.ErrnoError(this.ERRNO_CODES.ENOENT)}}put(t,e){switch(e.format){case"json":case"text":return this.request({method:"put",path:this.normalizePath(t),data:{format:e.format,data:n.decode(e.data)}});case"base64":{let s="";for(let t=0;t<e.data.byteLength;t++)s+=String.fromCharCode(e.data[t]);return this.request({method:"put",path:this.normalizePath(t),data:{format:e.format,data:btoa(s)}})}}}getattr(t){const e=this.request({method:"getattr",path:this.normalizePath(t)}),s=new Date(0);return e.atime=e.atime?new Date(e.atime):s,e.mtime=e.mtime?new Date(e.mtime):s,e.ctime=e.ctime?new Date(e.ctime):s,e.size=e.size||0,e}normalizePath(t){return t.startsWith(this._mountpoint)&&(t=t.slice(this._mountpoint.length)),this._driveName&&(t=`${this._driveName}:${t}`),t}}class l extends d{constructor(t){super(t),this._baseUrl=t.baseUrl,this._browsingContextId=t.browsingContextId||""}request(t){const e=new XMLHttpRequest;e.open("POST",encodeURI(this.endpoint),!1);const s=r.UUID.uuid4(),i={data:{...t,requestId:s},browsingContextId:this._browsingContextId,requestId:s};try{e.send(JSON.stringify(i))}catch(t){console.error(t)}if(e.status>=400)throw new this.FS.ErrnoError(this.ERRNO_CODES.EINVAL);return JSON.parse(e.responseText)}get endpoint(){return`${this._baseUrl}api/drive`}}class m{constructor(t){this.FS=t.FS,this.PATH=t.PATH,this.ERRNO_CODES=t.ERRNO_CODES,this.API=this.createAPI(t),this.driveName=t.driveName,this.node_ops=new h(this),this.stream_ops=new a(this)}createAPI(t){if(!t.browsingContextId||!t.baseUrl)throw new Error("Cannot create service-worker API without current browsingContextId");return new l(t)}mount(t){return this.createNode(null,t.mountpoint,16895,0)}createNode(t,e,s,r){const i=this.FS;if(!i.isDir(s)&&!i.isFile(s))throw new i.ErrnoError(this.ERRNO_CODES.EINVAL);const n=i.createNode(t,e,s,r);return n.node_ops=this.node_ops,n.stream_ops=this.stream_ops,n}getMode(t){return this.API.getmode(t)}realPath(t){const e=[];let s=t;for(e.push(s.name);s.parent!==s;)s=s.parent,e.push(s.name);return e.reverse(),this.PATH.join.apply(null,e)}}}}]);
//# sourceMappingURL=476.a83d86348758222c620a.js.map?v=a83d86348758222c620a