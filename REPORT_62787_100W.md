# GH#62787: CoW replace with dict containing np.nan

Issue: With Copy-on-Write enabled, DataFrame.replace({np.nan: ...}) via dict raised ValueError about a weakref not in list. Root cause was in Block.replace_list CoW cleanup: dead weakrefs (b() is None) were included in the referenced_blocks lookup, leading to invalid pops during multi-step replace.

Fix: In core/internals/blocks.py, build the self_blk_ids map only from live weakrefs:

- Skip entries where b() is None.
- Preserve existing CoW semantics; no API change.

Tests: Added tests covering dict replacements with np.nan/NA/NaT, Series behavior, inplace, mixed dtypes, nested dicts, chaining, and CoW vs non-CoW parity.

Result: Pre-commit clean; CI expected to pass.
